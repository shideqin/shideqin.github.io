<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>K8s无法删除状态为terminating的pod解决方法</title>
    <url>/posts/clvdigkql003lkoom5lvz8xv8.html</url>
    <content><![CDATA[<p>你有没有在使用k8s过程中遇到过这种情况: 通过kubectl delete指令删除一些资源时，一直处于Terminating状态。 这是为什么呢？</p>
<p>本文将介绍当你执行kubectl delete语句时，K8s内部都执行了哪些操作。 以及为何有些资源’删除不掉’(具体表现为一直Terminating，删除namespace时很容易遇到这种情况)</p>
<p>接下来，我们聚焦讨论以下四个方面:</p>
<p>1）资源的哪些属性会对删除操作产生影响？<br>2）finalizers与owner references属性是如何影响删除操作的？<br>3）如何利用Propagation Policy（分发策略）更改删除顺序？<br>4）删除操作的工作原理？</p>
<p><strong>1. 词汇表</strong></p>
<p>1）资源: k8s的资源对象（如configmap, secret, pod…）<br>2）finalizers: 终结器，存放键的列表。列表内的键为空时资源才可被删除<br>3）owner references: 所有者引用（归谁管理/父资源对象是谁）<br>4）kubectl: K8s客户端工具</p>
<p><strong>2. 强制删除pod</strong></p>
<p>每当删除namespace或pod等一些Kubernetes资源时，有时资源状态会卡在terminating，很长时间无法删除，甚至有时增加–force flag(强制删除)之后还是无法正常删除。这时就需要edit该资源，将字段finalizers设置为null，之后Kubernetes资源就正常删除了。</p>
<p>当删除pod时有时会卡住，pod状态变为terminating，无法删除pod</p>
<p>1）强制删除pod</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl delete pod xxx -n xxx --force --grace-period=0</span><br></pre></td></tr></table></figure>

<p>2）如果强制删除还不行，设置finalizers为空<br>如果一个容器已经在运行，这时需要对一些容器属性进行修改，又不想删除容器，或不方便通过replace的方式进行更新。kubernetes还提供了一种在容器运行时，直接对容器进行修改的方式，就是patch命令。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl patch pod xxx -n xxx -p <span class="string">'&#123;"metadata":&#123;"finalizers":null&#125;&#125;'</span></span><br></pre></td></tr></table></figure>

<p>这样pod就可以删除了。</p>
<p><strong>3. k8s删除流程</strong><br><img src="https://upload.phpkoo.com/uploads/2024/state-diagram-delete.png" alt=""></p>
<p>删除操作看似简单，但是有很多因素可能会干扰删除，包括finalizers与owner references属性</p>
<p><strong>4. Finalizers是什么？</strong><br>上面我们提到了两个属性：finalizers与owner references可能会干扰删除操作，导致删除阻塞或失败。 那Finalizers是什么？会对删除有何影响呢？</p>
<p>当要理解Kubernetes中的资源删除原理时，了解finalizers（以下我们称finalizers为终结器）的工作原理是很有帮助的， 可以帮助您理解为什么有些对象无法被删除。</p>
<p>终结器是资源发出预删除操作信号的属性， 控制着资源的垃圾收集，并用于提示控制器在删除资源之前执行哪些清理操作。</p>
<p>finalizers本质是包含键的列表，不具有实际意义。与annotations（注释）类似，finalizers是可以被操作的（增删改）。</p>
<p>以下终结器您可能遇到过：</p>
<ul>
<li>kubernetes.io/pv-protection</li>
<li>kubernetes.io/pvc-protection</li>
</ul>
<p>这两个终结器作用于卷，以防止卷被意外删除。</p>
<blockquote>
<p>类似地，一些终结器可用于防止资源被删除，但不由任何控制器管理。 下面是一个自定义的configmap，它没有具体值，但包含一个终结器:</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ cat &lt;&lt;EOF | kubectl create -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: mymap</span><br><span class="line">  finalizers:</span><br><span class="line">  - kubernetes</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>终结器通常用于名称空间(namespace)，而管理configmap资源的控制器不知道该如何处理finalizers字段。 下面我们尝试删除这个configmap对象:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl delete configmap/mymap &amp;</span><br><span class="line">configmap <span class="string">"mymap"</span> deleted</span><br><span class="line">$ <span class="built_in">jobs</span></span><br><span class="line">[1]+  Running kubectl delete configmap/mymap</span><br></pre></td></tr></table></figure>

<p>Kubernetes返回该对象已被删除，然而它并没有真正意义上被删除，而是在删除的过程中。 当我们试图再次获取该对象时，我们发现该对象多了个deletionTimestamp(删除时间戳)字段。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl get cm mymap -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">"2021-09-29T11:04:40Z"</span></span><br><span class="line">  deletionGracePeriodSeconds: 0</span><br><span class="line">  deletionTimestamp: <span class="string">"2021-09-29T11:04:55Z"</span></span><br><span class="line">  finalizers:</span><br><span class="line">  - kubernetes</span><br><span class="line">  managedFields:</span><br><span class="line">  - apiVersion: v1</span><br><span class="line">    fieldsType: FieldsV1</span><br><span class="line">    fieldsV1:</span><br><span class="line">      f:metadata:</span><br><span class="line">        f:finalizers:</span><br><span class="line">          .: &#123;&#125;</span><br><span class="line">          v:<span class="string">"kubernetes"</span>: &#123;&#125;</span><br><span class="line">    manager: kubectl</span><br><span class="line">    operation: Update</span><br><span class="line">    time: <span class="string">"2021-09-29T11:04:40Z"</span></span><br><span class="line">  name: mymap</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: <span class="string">"1378430"</span></span><br><span class="line">  selfLink: /api/v1/namespaces/default/configmaps/mymap</span><br><span class="line">  uid: 8d6ca0b1-4840-4597-8164-a63b526dbf5f</span><br></pre></td></tr></table></figure>

<blockquote>
<p>简而言之，当我们删除带有finalizers字段的对象时，该对象仅仅是被更新了，而不是被删除了。 这是因为Kubernetes获取到该对象包含终结器，通过添加deletionTimestamp（删除时间戳）字段将其置于只读状态（删除终结器键更新除外）。 换句话说，在删除该对象终结器之前，删除都不会完成。</p>
</blockquote>
<p>接下来我们尝试通过patch命令删除终结器，并观察configmap/mymap是否会被’真正’删除。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl patch configmap/mymap \</span><br><span class="line">    --<span class="built_in">type</span> json \</span><br><span class="line">    --patch=<span class="string">'[ &#123; "op": "remove", "path": "/metadata/finalizers" &#125; ]'</span></span><br></pre></td></tr></table></figure>

<p>再次检索该对象</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl get cm mymap</span><br><span class="line">Error from server (NotFound): configmaps <span class="string">"mymap"</span> not found</span><br></pre></td></tr></table></figure>

<p>发现该对象已被真正删除，下图描述了带有finalizers字段的对象删除流程：<br><img src="https://upload.phpkoo.com/uploads/2024/state-diagram-finalize.png" alt=""></p>
<blockquote>
<p>总结：当您试图删除一个带有终结器的对象，它将一直处于预删除只读状态， 直到控制器删除了终结器键或使用Kubectl删除了终结器。一旦终结器列表为空，Kubernetes就可以回收该对象，并将其放入要从注册表中删除的队列中</p>
</blockquote>
<p>带有finalizers字段的对象无法删除的原因大致如下：</p>
<ul>
<li>对象存在finalizers，关联的控制器故障未能执行或执行finalizer函数hang住: 比如namespace控制器无法删除完空间内所有的对象， 特别是在使用aggregated apiserver时，第三方apiserver服务故障导致无法删除其对象。 此时，需要会恢复第三方apiserver服务或移除该apiserver的聚合，具体选择哪种方案需根据实际情况而定。</li>
<li>集群内安装的控制器给一些对象增加了自定义finalizers，未删除完fianlizers就下线了该控制器，导致这些fianlizers没有控制器来移除他们。 此时，需要恢复该控制器会手动移除finalizers(多出现于自定义operator)，具体选择哪种方案根据实际情况而定。</li>
</ul>
<p><strong>5. Owner References又是什么？</strong><br>上面我们提到了两个属性：finalizers与owner references可能会干扰删除操作，导致删除阻塞或失败。 并介绍了Finalizers，接下来我们聊聊Owner References.</p>
<p>Owner References（所有者引用或所有者归属）描述了对象组之间的关系。 指定了资源彼此关联的属性，因此可以级联删除整个资源树。</p>
<blockquote>
<p>当存在所有者引用时，将处理终结器规则。所有者引用由名称和UID组成</p>
</blockquote>
<p>所有者引用相同名称空间内的链接资源，它还需要UID以使该引用生效(确保唯一)。 Pods通常具有对所属副本集的所有者引用。 因此，当Deloyment或有StatefulSet被删除时，子ReplicaSet和Pod将在流程中被删除。</p>
<p>我们通过下面的例子，来理解Owner References（所有者引用）的工作原理：</p>
<p>1.创建cm/mymap-parent对象</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ cat &lt;&lt;EOF | kubectl create -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">name: mymap-parent</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>2.获取cm/mymap-parent的UID</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ CM_UID=$(kubectl get configmap mymap-parent -o jsonpath=<span class="string">"&#123;.metadata.uid&#125;"</span>)</span><br></pre></td></tr></table></figure>
<p>3.创建cm/mymap-child对象，并设置ownerReferences字段声明所有者引用（通过kind、name、uid字段确保选择器可以匹配到）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ cat &lt;&lt;EOF | kubectl create -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">name: mymap-child</span><br><span class="line">ownerReferences:</span><br><span class="line">- apiVersion: v1</span><br><span class="line"> kind: ConfigMap</span><br><span class="line"> name: mymap-parent</span><br><span class="line"> uid: <span class="variable">$CM_UID</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>即cm/mymap-parent为cm/mymap-child的父对象，此时我们删除cm/mymap-parent对象并观察cm/mymap-child对象状态</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl get cm</span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">mymap-child    0      2m44s</span><br><span class="line">mymap-parent   0      3m</span><br><span class="line"></span><br><span class="line">$ kubectl delete cm mymap-parent</span><br><span class="line">configmap <span class="string">"mymap-parent"</span> deleted</span><br><span class="line"></span><br><span class="line">$ kubectl get cm</span><br><span class="line">No resources found <span class="keyword">in</span> default namespace.</span><br></pre></td></tr></table></figure>

<p>即我们通过删除父对象，间接删除了父对象下的所有子对象。 这种删除k8s中被称为级联删除。我们可不可以只删除父对象，而不删除子对象呢？</p>
<blockquote>
<p>答案是: 可以的，删除时通过添加–cascade=false参数实现，我们通过下面的例子来验证：</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ cat &lt;&lt;EOF | kubectl create -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: mymap-parent</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ CM_UID=$(kubectl get configmap mymap-parent -o jsonpath=<span class="string">"&#123;.metadata.uid&#125;"</span>)</span><br><span class="line"></span><br><span class="line">$ cat &lt;&lt;EOF | kubectl create -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: mymap-child</span><br><span class="line">  ownerReferences:</span><br><span class="line">  - apiVersion: v1</span><br><span class="line">    kind: ConfigMap</span><br><span class="line">    name: mymap-parent</span><br><span class="line">    uid: <span class="variable">$CM_UID</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ kubectl delete --cascade=<span class="literal">false</span> configmap/mymap-parent</span><br><span class="line">configmap <span class="string">"mymap-parent"</span> deleted</span><br><span class="line"></span><br><span class="line">$ kubectl get cm</span><br><span class="line">NAME          DATA   AGE</span><br><span class="line">mymap-child   0      107s</span><br></pre></td></tr></table></figure>

<blockquote>
<p>–cascade=false参数实际改变了父-子资源的删除顺序，k8s中关于父-子资源删除策略有以下三种：</p>
</blockquote>
<ul>
<li>Foreground: 子资源在父资源之前被删除(post-order)</li>
<li>Background: 父资源在子资源之前被删除 (pre-order)</li>
<li>Orphan: 忽略所有者引用进行删除</li>
</ul>
<p><strong>6. 强制删除命名空间</strong><br>有一种情况可能需要强制删除命名空间：</p>
<p>如果您已经删除了一个命名空间，并删除了它下面的所有对象，但名称空间仍然存在，一般为Terminating状态。 则可以通过更新名称空间的finalize属性来强制删除该名称空间。</p>
<ol>
<li><p>会话1</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ kubectl proxy</span><br></pre></td></tr></table></figure>
</li>
<li><p>会话2</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ NAMESPACE_NAME=<span class="built_in">test</span></span><br><span class="line">cat &lt;&lt;EOF | curl -X PUT \</span><br><span class="line">  127.0.0.1:8001/api/v1/namespaces/<span class="variable">$NAMESPACE_NAME</span>/finalize \</span><br><span class="line">  -H <span class="string">"Content-Type: application/json"</span> \</span><br><span class="line">  --data-binary @-</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"kind"</span>: <span class="string">"Namespace"</span>,</span><br><span class="line">  <span class="string">"apiVersion"</span>: <span class="string">"v1"</span>,</span><br><span class="line">  <span class="string">"metadata"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"<span class="variable">$NAMESPACE_NAME</span>"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"spec"</span>: &#123;</span><br><span class="line">    <span class="string">"finalizers"</span>: null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>我们应该谨慎思考是否强制删除命名空间，因为这样做可能只删除名称空间，命名空间下的其他资源删不完全，最终导致留下孤儿对象。 比如资源对象A存在于ddd命名空间，此时若强制删除ddd命名空间, 且对象A又未被删除，那么对象A便成了孤儿对象。</p>
<p>当出现孤儿对象时，可以手动重新创建名称空间，随后可以手动清理和恢复该对象。</p>
]]></content>
      <categories>
        <category>k8s</category>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>pod</tag>
        <tag>delete</tag>
      </tags>
  </entry>
  <entry>
    <title>lua利用metatable实现类的继承和多态</title>
    <url>/posts/clvdigksh008jkoomcr2oep62.html</url>
    <content><![CDATA[<p>在lua原生语法特性中是不具备面向对象设计的特性。因此，要想在lua上像其他高级语言一样使用面向对象的设计方法，就需要使用原生的元表(metatable)来模拟面向对象设计。</p>
<p><strong>一、元表setmetatable</strong><br>对指定 table 设置元表(metatable)，如果元表(metatable)中存在__metatable键值，setmetatable会失败。</p>
<p>以下实例演示了如何对指定的表设置元表：</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">mytable = &#123;&#125;                          <span class="comment">-- 普通表</span></span><br><span class="line">mymetatable = &#123;&#125;                      <span class="comment">-- 元表</span></span><br><span class="line"><span class="built_in">setmetatable</span>(mytable,mymetatable)     <span class="comment">-- 把 mymetatable 设为 mytable 的元表</span></span><br></pre></td></tr></table></figure>

<p><strong>二、元表__index 元方法</strong><br>这是 metatable 最常用的键。<br>当你通过键来访问 table 的时候，如果这个键没有值，那么Lua就会寻找该table的metatable（假定有metatable）中的＿index 键。如果＿index包含一个表格，Lua会在表格中查找相应的键。</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">other = &#123; foo = <span class="number">3</span> &#125;</span><br><span class="line">t = <span class="built_in">setmetatable</span>(&#123;&#125;, &#123; <span class="built_in">__index</span> = other &#125;)</span><br><span class="line"><span class="built_in">print</span>(t.foo)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(t.bar)</span><br><span class="line"><span class="literal">nil</span></span><br></pre></td></tr></table></figure>

<p><strong>三、使用metatable实现继承</strong></p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> _M = &#123;</span><br><span class="line">        version = <span class="string">'lua 1.0'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> parent = &#123;</span><br><span class="line">        <span class="built_in">__index</span> = _M</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parent.new</span><span class="params">()</span></span></span><br><span class="line">        <span class="comment">-- 初始化new，如果没有这句，那么类所建立的对象如果有一个改变，其他对象都会改变</span></span><br><span class="line">        <span class="keyword">local</span> new = &#123;&#125;</span><br><span class="line">        <span class="comment">-- 使用setmetatable来实现继承</span></span><br><span class="line">        <span class="built_in">setmetatable</span>(new, parent)</span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_M:echo</span><span class="params">()</span></span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"M:echo "</span>..self.version)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p><strong>四、使用metatable实现重载和多态</strong></p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> _M = &#123;</span><br><span class="line">        version = <span class="string">'lua 1.0'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> parent = &#123;</span><br><span class="line">        <span class="built_in">__index</span> = _M</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parent.new</span><span class="params">()</span></span></span><br><span class="line">        <span class="comment">-- 初始化new，如果没有这句，那么类所建立的对象如果有一个改变，其他对象都会改变</span></span><br><span class="line">        <span class="keyword">local</span> new = &#123;&#125;</span><br><span class="line">        <span class="comment">-- 使用setmetatable来实现继承</span></span><br><span class="line">        <span class="built_in">setmetatable</span>(new, parent)</span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_M:echo</span><span class="params">()</span></span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"M:echo "</span>..self.version)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> _M2 = parent.new()</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> child = &#123;</span><br><span class="line">        <span class="built_in">__index</span> = _M2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">child.new</span><span class="params">()</span></span></span><br><span class="line">        <span class="comment">-- 初始化new，如果没有这句，那么类所建立的对象如果有一个改变，其他对象都会改变</span></span><br><span class="line">        <span class="keyword">local</span> new = &#123;&#125;</span><br><span class="line">        <span class="comment">-- 使用setmetatable来实现继承</span></span><br><span class="line">        <span class="built_in">setmetatable</span>(new, child)</span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重载echo方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_M2:echo</span><span class="params">()</span></span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"M2:echo "</span>..self.version)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test = parent.new()</span><br><span class="line">test:echo()</span><br><span class="line"></span><br><span class="line">test = child.new()</span><br><span class="line">test:echo()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>LUA</category>
        <category>OOP</category>
      </categories>
      <tags>
        <tag>lua</tag>
        <tag>面向对象</tag>
        <tag>metatable</tag>
      </tags>
  </entry>
  <entry>
    <title>openssl模块安装luaossl（luacrypto）</title>
    <url>/posts/clvdigksu009dkoomf6ed9xf1.html</url>
    <content><![CDATA[<p><a href="https://luarocks.org/modules/daurnimator/luaossl" target="_blank" rel="noopener">luaossl</a> 是<a href="https://luarocks.org/modules/starius/luacrypto" target="_blank" rel="noopener">luacrypto</a>的代替版本，是针对 Lua 5.1、5.2、5.3 和 LuaJIT 的 OpenSSL 综合绑定。是 Lua 世界中最全面的 OpenSSL 绑定。luaosll安装依赖OpenSSL库，所以需要先安装OpenSSL。</p>
<p><strong>一、安装OpenSSL</strong><br>下载好的OpenSSL源码目录下，编译安装OpenSSL（以下均使用默认路径“/usr/local”进行安装）</p>
<p>1）生成Makefile文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 根据编译平台及环境自动生成Makefile文件，可以通过./config --prefix指定安装路径，-Wl,-rpath参数指定OpenSSL运行时依赖libcrypto、libssl库的路径。</span></span><br><span class="line">./config -Wl,-rpath,/usr/<span class="built_in">local</span>/lib</span><br></pre></td></tr></table></figure>

<p>2）安装OpenSSL</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>3）查看OpenSSL版本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示如下格式内容说明安装成功（本文以安装OpenSSL 1.1.1q为例）</span></span><br><span class="line">OpenSSL 1.1.1q  5 Jul 2022 (Library: OpenSSL 1.1.1k  FIPS 25 Mar 2021)</span><br></pre></td></tr></table></figure>

<p><strong>二、安装luaosll</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">luarocks install luaossl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示如下格式内容说明安装成功</span></span><br><span class="line">Installing https://luarocks.org/luaossl-20220711-0.src.rock</span><br><span class="line"></span><br><span class="line">luaossl 20220711-0 depends on lua (5.1-1 provided by VM)</span><br><span class="line">Applying patch config.h.diff...</span><br><span class="line">Hunk 1 found at offset 2...</span><br><span class="line">gcc -O2 -fPIC -I/usr/<span class="built_in">local</span>/include -c src/openssl.c -o src/openssl.o -D_REENTRANT -D_THREAD_SAFE -DCOMPAT53_PREFIX=luaossl -D_GNU_SOURCE -I/usr/<span class="built_in">local</span>/include -I/usr/<span class="built_in">local</span>/include</span><br><span class="line">gcc -O2 -fPIC -I/usr/<span class="built_in">local</span>/include -c vendor/compat53/c-api/compat-5.3.c -o vendor/compat53/c-api/compat-5.3.o -D_REENTRANT -D_THREAD_SAFE -DCOMPAT53_PREFIX=luaossl -D_GNU_SOURCE -I/usr/<span class="built_in">local</span>/include -I/usr/<span class="built_in">local</span>/include</span><br><span class="line">gcc  -shared -o _openssl.so src/openssl.o vendor/compat53/c-api/compat-5.3.o -L/usr/<span class="built_in">local</span>/lib64 -L/usr/<span class="built_in">local</span>/lib64 -Wl,-rpath,/usr/<span class="built_in">local</span>/lib64 -Wl,-rpath,/usr/<span class="built_in">local</span>/lib64 -lssl -lcrypto -lpthread -lm -ldl</span><br><span class="line">luaossl 20220711-0 is now installed <span class="keyword">in</span> /usr/<span class="built_in">local</span> (license: MIT/X11)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>LUA</category>
        <category>OpenSSL</category>
      </categories>
      <tags>
        <tag>lua</tag>
        <tag>luaossl</tag>
        <tag>luacrypto</tag>
        <tag>luarocks</tag>
        <tag>OpenSSL</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes使用KEDA通过Prometheus触发HPA</title>
    <url>/posts/clvdigkqm003okoomcm2xdc8u.html</url>
    <content><![CDATA[<p><a href="https://keda.sh/" target="_blank" rel="noopener">KEDA</a> 是一个基于 Kubernetes 的事件驱动自动缩放器。使用 KEDA，您可以根据需要处理的事件数量来驱动 Kubernetes 中任何容器的扩展。KEDA可以支持很多自定义事件源，如：Mysql、MongoDB、Redis、ActiveMQ、Kafka、Prometheus、Metrics API等。本文使用nginx中的stub_status数据 + Prometheus为事件源进行KEDA HPA配置。</p>
<p><strong>一、开启nginx(stub_status)</strong><br>nginx中的stub_status模块主要用于查看Nginx的一些状态信息。</p>
<p>1）查看nginx时候有安装该模块。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx -V</span><br></pre></td></tr></table></figure>

<p>2）安装stub_status模块<br>（注意：有的话可以忽略此步骤，就不用安装了）<br>在nginx编译安装的时候加上参数 “–with-http_stub_status_module”,就安装了这个模块。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure --with-http_stub_status_module</span><br></pre></td></tr></table></figure>

<p>3）开启stub_status</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> /nginx_status &#123;</span><br><span class="line">    <span class="attribute">stub_status</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">allow</span> <span class="number">127.0.0.1</span>;  <span class="comment">#only allow requests from localhost</span></span><br><span class="line">    <span class="attribute">deny</span> all;   <span class="comment">#deny all other hosts</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>二、在kubernetes中运行nginx-prometheus-exporter</strong><br>nginx-prometheus-exporter 是将 stub_status 指标转换为 Prometheus 指标类型，最终可以由 Prometheus 进行收集。</p>
<p>在Kubernetes里运行</p>
<p>1）创建一个无状态服务（Deployment）</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-prometheus</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">workload.user.cattle.io/workloadselector:</span> <span class="string">apps.deployment-default-nginx-prometheus</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">workload.user.cattle.io/workloadselector:</span> <span class="string">apps.deployment-default-nginx-prometheus</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">workload.user.cattle.io/workloadselector:</span> <span class="string">apps.deployment-default-nginx-prometheus</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">nginx-prometheus</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx/nginx-prometheus-exporter:0.10.0</span></span><br><span class="line">          <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">nginx-prometheus-exporter</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">'-nginx.scrape-uri=http://127.0.0.1/nginx_status'</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>

<p>2）创建一个Service服务</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-prometheus</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">metrics-prometheus-discovery:</span> <span class="string">'true'</span> <span class="comment"># for monitoring discovery</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">9113</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">9113</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure>

<p><strong>三、配置kubernetes中的Monitor服务</strong></p>
<p>1）创建一个ServiceMonitor</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">monitoring.coreos.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceMonitor</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-monitor</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">metrics-prometheus-discovery:</span> <span class="string">'true'</span> <span class="comment"># for monitoring discovery</span></span><br><span class="line">  <span class="attr">namespaceSelector:</span></span><br><span class="line">    <span class="attr">matchNames:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="string">5s</span></span><br></pre></td></tr></table></figure>

<p>2）创建KEDA（ScaledObject）缩放规则</p>
<p>Prometheus的集群内访问地址是：<a href="http://prometheus-operated.cattle-prometheus.svc:9090" target="_blank" rel="noopener">http://prometheus-operated.cattle-prometheus.svc:9090</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">keda.sh/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ScaledObject</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-prometheus-scaledobject</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scaleTargetRef:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">pollingInterval:</span> <span class="number">5</span>   <span class="comment"># Optional. Default: 30 seconds</span></span><br><span class="line">  <span class="attr">cooldownPeriod:</span>  <span class="number">60</span>  <span class="comment"># Optional. Default: 300 seconds</span></span><br><span class="line">  <span class="attr">minReplicaCount:</span> <span class="number">1</span>   <span class="comment"># Optional. Default: 0</span></span><br><span class="line">  <span class="attr">maxReplicaCount:</span> <span class="number">3</span>   <span class="comment"># Optional. Default: 100</span></span><br><span class="line">  <span class="attr">triggers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">serverAddress:</span> <span class="string">http://prometheus-operated.cattle-monitoring-system.svc.cluster.local:9090</span> </span><br><span class="line">      <span class="attr">metricName:</span> <span class="string">nginx_http_requests_total</span></span><br><span class="line">      <span class="attr">threshold:</span> <span class="string">'100'</span></span><br><span class="line">      <span class="attr">query:</span> <span class="string">sum(rate(nginx_http_requests_total[10s]))</span></span><br></pre></td></tr></table></figure>

<p><strong>ps:</strong></p>
<p>在Docker中运行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -p 9113:9113 nginx/nginx-prometheus-exporter:0.10.0 -nginx.scrape-uri=http://127.0.0.1/nginx_status</span><br></pre></td></tr></table></figure>

<p>运行后，可以通过9113 端口来访问 Prometheus 收集的数据，可以配合Grafana来实现数据可视化。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://localhost:9113/metrics</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>KEDA</tag>
        <tag>HPA</tag>
        <tag>Prometheus</tag>
      </tags>
  </entry>
  <entry>
    <title>使用openssl创建多泛域名及IP的自签名证书</title>
    <url>/posts/clvdigktc00a9koom659j1b1f.html</url>
    <content><![CDATA[<p>在开发环境及私有环境下需要使用SSL，于是使用openssl创建自签发证书，支持多域名、泛域名、直接IP访问。</p>
<p><strong>一、使用openssl生成证书自签名</strong></p>
<p>openssl在centos中是标配，所以直接在centos中操作，因为要多个域名和IP，故而需要编辑一个配置文件，如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim req.cnf</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定义输入用户信息选项的"特征名称"字段名，该扩展字段定义了多项用户信息。</span></span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line"><span class="comment"># 生成自签名证书时要使用的证书扩展项字段名，该扩展字段定义了要加入到证书中的一系列扩展项。</span></span><br><span class="line">x509_extensions = v3_req</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果设为no，那么 req 指令将直接从配置文件中读取证书字段的信息，而不提示用户输入。</span></span><br><span class="line">prompt = no</span><br><span class="line"></span><br><span class="line">[req_distinguished_name]</span><br><span class="line"><span class="comment">#国家代码，一般都是CN(大写)</span></span><br><span class="line">C = CN</span><br><span class="line"><span class="comment">#省份</span></span><br><span class="line">ST = Beijing</span><br><span class="line"><span class="comment">#城市</span></span><br><span class="line">L = Beijing</span><br><span class="line"><span class="comment">#企业/单位名称</span></span><br><span class="line">O = phpkoo</span><br><span class="line"><span class="comment">#企业部门</span></span><br><span class="line">OU = phpkoo</span><br><span class="line"><span class="comment">#证书的主域名</span></span><br><span class="line">CN = phpkoo.com</span><br><span class="line"></span><br><span class="line"><span class="comment">##### 要加入到证书请求中的一系列扩展项 #####</span></span><br><span class="line">[v3_req]</span><br><span class="line">keyUsage = critical, digitalSignature, keyAgreement</span><br><span class="line">extendedKeyUsage = serverAuth</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[ alt_names ]</span><br><span class="line">DNS.1=第一个域名</span><br><span class="line">DNS.2=第二个域名</span><br><span class="line">DNS.N=第N个域名</span><br><span class="line">IP.1=第一个IP</span><br><span class="line">IP.2=第二个IP</span><br><span class="line">IP.N=第N个IP</span><br></pre></td></tr></table></figure>
<p>其中IP配置项，可有可无。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mkdir -p ssl/</span><br><span class="line">$ openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout ./ssl/private.key -out ./ssl/ssl.crt -config ./req.cnf -sha256</span><br></pre></td></tr></table></figure>
<p>至此证书生成完成</p>
<p>可以下载ssl目录下的private.key和ssl.crt文件</p>
<p>openssl 命令参数说明：</p>
<p>req         大致有3个功能：生成证书请求文件、验证证书请求文件和创建根CA。<br>  -x509     说明生成自签名证书。<br>  -nodes    openssl req在自动创建私钥时，将总是加密该私钥文件，并提示输入加密的密码。可以使用”-nodes”选项禁止加密私钥文件。<br>  -days     指定所颁发的证书有效期。<br>  -key      指定输入的密钥，如果不指定此选项会根据 <code>-newkey</code> 选项的参数生成密钥对。<br>  -newkey   指定生成一个新的密钥对，只有在没有 <code>-key</code> 选项的时候才生效，参数形式为<code>rsa:numbits</code>或者<code>dsa:file</code>，例如：<code>rsa:2048</code> rsa表示创建rsa私钥，2048表示私钥的长度。<br>  -keyout   指定私钥保存位置。<br>  -out      新的证书请求文件位置。<br>  -config   指定req的配置文件，指定后将忽略所有的其他配置文件。如果不指定则默认使用/etc/pki/tls/openssl.cnf中req段落的值。</p>
<p><strong>二、证书如何使用</strong></p>
<p><strong>此时访问会出现如下问题</strong><br><img src="https://upload.phpkoo.com/uploads/2021/12/ssl-0.png" alt=""></p>
<p><strong>你还得在系统上安装一下证书，安装步骤如下</strong><br>1、在Windows中导入证书</p>
<ul>
<li>第一步：双击ssl.crt文件打开证书文件，出现如下界面</li>
</ul>
<p><img src="https://upload.phpkoo.com/uploads/2021/12/ssl-1.png" alt=""></p>
<ul>
<li>第二步：</li>
</ul>
<p><img src="https://upload.phpkoo.com/uploads/2021/12/ssl-2.png" alt=""></p>
<ul>
<li>第三步：</li>
</ul>
<p><img src="https://upload.phpkoo.com/uploads/2021/12/ssl-3.png" alt=""></p>
<ul>
<li>第四步：</li>
</ul>
<p><img src="https://upload.phpkoo.com/uploads/2021/12/ssl-4.png" alt=""></p>
<ul>
<li>第五步：</li>
</ul>
<p><img src="https://upload.phpkoo.com/uploads/2021/12/ssl-5.png" alt=""></p>
<p><strong>证书安装，完成</strong></p>
<p><strong>重启浏览器，才能生效</strong></p>
<p>2、测试效果<br><img src="https://upload.phpkoo.com/uploads/2021/12/ssl-6.png" alt=""></p>
<p>3、火狐浏览器处理</p>
<p>Firefox默认情况不，还是不信任自签名证书</p>
<p>打开火狐浏览器输入<code>about:config</code>进行设置界面</p>
<ul>
<li>第一步：</li>
</ul>
<p><img src="https://upload.phpkoo.com/uploads/2021/12/firefox-1.png" alt=""></p>
<ul>
<li>第二步：</li>
</ul>
<p>输入<code>security.enterprise_roots.enabled</code>修改为<code>true</code></p>
<p><img src="https://upload.phpkoo.com/uploads/2021/12/firefox-2.png" alt=""></p>
<ul>
<li>第三步：</li>
</ul>
<p><img src="https://upload.phpkoo.com/uploads/2021/12/firefox-3.png" alt=""></p>
<p><strong>设置完成</strong></p>
<p><strong>重启浏览器，才能生效</strong></p>
]]></content>
      <categories>
        <category>OpenSSL</category>
        <category>HTTPS</category>
        <category>SSL</category>
      </categories>
      <tags>
        <tag>OpenSSL</tag>
        <tag>HTTPS证书</tag>
        <tag>SSL证书</tag>
      </tags>
  </entry>
  <entry>
    <title>golang中net.http请求时header中的Content-Length无效坑</title>
    <url>/posts/clvdigks7007ykoombheg9ung.html</url>
    <content><![CDATA[<p>在一次和国内某云厂商对接对象存储时，因为他们对象存储服务，是直接使用的是第三方开源服务，开源服务默认并不支持<strong>chunked</strong>编码（而国内其它大厂一般都是支持chunked编码）。导致上传文件一直报<strong>HTTP/1.1 411 Length Required</strong>错误，出现问题的原因是说，我没有传Content-Length。</p>
<p>而明明我在header里设置了Content-Length，但是抓包发现，实际却变成了chunked<br><img src="https://upload.phpkoo.com/uploads/2021/12/net.http-02.png" alt=""></p>
<p>经过反复的测试情况都依旧，直到在github上找到了这个<a href="https://github.com/golang/go/issues/16264" target="_blank" rel="noopener">https://github.com/golang/go/issues/16264</a></p>
<p>然后查看了golang源码</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRequest</span><span class="params">(method, url <span class="keyword">string</span>, body io.Reader)</span> <span class="params">(*Request, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> method == <span class="string">""</span> &#123;</span><br><span class="line">        <span class="comment">// We document that "" means "GET" for Request.Method, and people have</span></span><br><span class="line">        <span class="comment">// relied on that from NewRequest, so keep that working.</span></span><br><span class="line">        <span class="comment">// We still enforce validMethod for non-empty methods.</span></span><br><span class="line">        method = <span class="string">"GET"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !validMethod(method) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"net/http: invalid method %q"</span>, method)</span><br><span class="line">    &#125;</span><br><span class="line">    u, err := parseURL(url) <span class="comment">// Just url.Parse (url is shadowed for godoc).</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    rc, ok := body.(io.ReadCloser)</span><br><span class="line">    <span class="keyword">if</span> !ok &amp;&amp; body != <span class="literal">nil</span> &#123;</span><br><span class="line">        rc = ioutil.NopCloser(body)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// The host's colon:port should be normalized. See Issue 14836.</span></span><br><span class="line">    u.Host = removeEmptyPort(u.Host)</span><br><span class="line">    req := &amp;Request&#123;</span><br><span class="line">        Method:     method,</span><br><span class="line">        URL:        u,</span><br><span class="line">        Proto:      <span class="string">"HTTP/1.1"</span>,</span><br><span class="line">        ProtoMajor: <span class="number">1</span>,</span><br><span class="line">        ProtoMinor: <span class="number">1</span>,</span><br><span class="line">        Header:     <span class="built_in">make</span>(Header),</span><br><span class="line">        Body:       rc,</span><br><span class="line">        Host:       u.Host,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> body != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> v := body.(<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> *bytes.Buffer:</span><br><span class="line">            req.ContentLength = <span class="keyword">int64</span>(v.Len())</span><br><span class="line">            buf := v.Bytes()</span><br><span class="line">            req.GetBody = <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(io.ReadCloser, error)</span></span> &#123;</span><br><span class="line">                r := bytes.NewReader(buf)</span><br><span class="line">                <span class="keyword">return</span> ioutil.NopCloser(r), <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> *bytes.Reader:</span><br><span class="line">            req.ContentLength = <span class="keyword">int64</span>(v.Len())</span><br><span class="line">            snapshot := *v</span><br><span class="line">            req.GetBody = <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(io.ReadCloser, error)</span></span> &#123;</span><br><span class="line">                r := snapshot</span><br><span class="line">                <span class="keyword">return</span> ioutil.NopCloser(&amp;r), <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> *strings.Reader:</span><br><span class="line">            req.ContentLength = <span class="keyword">int64</span>(v.Len())</span><br><span class="line">            snapshot := *v</span><br><span class="line">            req.GetBody = <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(io.ReadCloser, error)</span></span> &#123;</span><br><span class="line">                r := snapshot</span><br><span class="line">                <span class="keyword">return</span> ioutil.NopCloser(&amp;r), <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">// This is where we'd set it to -1 (at least</span></span><br><span class="line">            <span class="comment">// if body != NoBody) to mean unknown, but</span></span><br><span class="line">            <span class="comment">// that broke people during the Go 1.8 testing</span></span><br><span class="line">            <span class="comment">// period. People depend on it being 0 I</span></span><br><span class="line">            <span class="comment">// guess. Maybe retry later. See Issue 18117.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// For client requests, Request.ContentLength of 0</span></span><br><span class="line">        <span class="comment">// means either actually 0, or unknown. The only way</span></span><br><span class="line">        <span class="comment">// to explicitly say that the ContentLength is zero is</span></span><br><span class="line">        <span class="comment">// to set the Body to nil. But turns out too much code</span></span><br><span class="line">        <span class="comment">// depends on NewRequest returning a non-nil Body,</span></span><br><span class="line">        <span class="comment">// so we use a well-known ReadCloser variable instead</span></span><br><span class="line">        <span class="comment">// and have the http package also treat that sentinel</span></span><br><span class="line">        <span class="comment">// variable to mean explicitly zero.</span></span><br><span class="line">        <span class="keyword">if</span> req.GetBody != <span class="literal">nil</span> &amp;&amp; req.ContentLength == <span class="number">0</span> &#123;</span><br><span class="line">            req.Body = NoBody</span><br><span class="line">            req.GetBody = <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(io.ReadCloser, error)</span></span> &#123; <span class="keyword">return</span> NoBody, <span class="literal">nil</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> req, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，这里面居然有个switch，当你使用bytes.Buffer,bytes.Reader或者strings.Reader作为Body的时候，它会自动给你设置req.ContentLength…</p>
<p>所以，问题不是当你Post一个ReadCloser的时候，就会变成chunked，而是你Post非这三种类型的body进来的时候都没有Content-Length，需要自己显式设置。代码如下：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">req, _ := http.NewRequest(method, url, bodyReader)</span><br><span class="line">req.ContentLength = req.Header.Get(<span class="string">"Content-Length"</span>)</span><br></pre></td></tr></table></figure>
<p>设置了req.ContentLength之后，抓包如下确实不再是chunked编码了，抓包如下<br><img src="https://upload.phpkoo.com/uploads/2021/12/net.http-01.png" alt=""><br>至此问题解决。</p>
]]></content>
      <categories>
        <category>GoLang</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>http</tag>
        <tag>Content-Length</tag>
      </tags>
  </entry>
  <entry>
    <title>luarocks安装lua-mongo模块</title>
    <url>/posts/clvdigksh008hkoom5jrufl8b.html</url>
    <content><![CDATA[<p>lua-mongo 是对 MongoDB C Driver 1.16 或更高版本的 Lua 的绑定，githup仓库：<a href="https://github.com/neoxic/lua-mongo" target="_blank" rel="noopener">https://github.com/neoxic/lua-mongo</a></p>
<p>通过luarocks方式安装lua模块</p>
<p>一、安装luarocks工具，官网:<a href="https://luarocks.org/" target="_blank" rel="noopener">https://luarocks.org/</a><br>二、安装lua-mongo模块</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">luarocks install lua-mongo</span><br></pre></td></tr></table></figure>
<p>安装时，报以下错误信息</p>
<p>Error: Could not find expected file libmongoc-1.0/mongoc.h, or libmongoc-1.0/mongoc.h for LIBMONGOC – you may have to install LIBMONGOC in your system and/or pass LIBMONGOC_DIR or LIBMONGOC_INCDIR to the luarocks command. Example: luarocks install mongorover LIBMONGOC_DIR=/usr/local</p>
<p>三、安装cmake</p>
<p>因为mongo-c-driver需要使用cmake进行编译</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install gcc gcc-c++ ncurses-devel</span><br><span class="line">wget wget https://cmake.org/files/v3.3/cmake-3.3.2.tar.gz</span><br><span class="line">tar -xzf cmake-3.3.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> cmake-3.3.2/</span><br><span class="line">./bootstrap</span><br><span class="line">gmake</span><br><span class="line">gmake install</span><br></pre></td></tr></table></figure>

<p>四、安装libmongoc库</p>
<p>官方安装参照：<a href="http://mongoc.org/" target="_blank" rel="noopener">http://mongoc.org/</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://github.com/mongodb/mongo-c-driver/releases/download/1.17.6/mongo-c-driver-1.17.6.tar.gz</span><br><span class="line">tar -xzf mongo-c-driver-1.17.6.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mongo-c-driver-1.17.6/</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>再执行,安装lua-mongo模块</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">luarocks install lua-mongo</span><br></pre></td></tr></table></figure>
<p>安装成功</p>
]]></content>
      <categories>
        <category>LUA</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>linux</tag>
        <tag>nginx</tag>
        <tag>openresty</tag>
        <tag>lua</tag>
        <tag>lua-mongo模块</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下原生nginx支持openresty功能</title>
    <url>/posts/clvdigkro006ckoom0a8gen8s.html</url>
    <content><![CDATA[<p>nginx想支持openresty的功能，需要安装以下模块及依赖<code>luajit2</code>、<code>lua-resty-core</code>、<code>lua-resty-lrucache</code>、<code>lua-nginx-module</code>、<code>ngx_devel_kit</code>以下5个依赖包必须先下载，另外如果需要同时支持SSL的话，还需要下载<code>openssl</code>依赖包（ssl只需要下载nginx编译时使用）。</p>
<p>一、安装openresty依赖包<br>1、安装luajit2（下载最新版本）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://github.com/openresty/luajit2/archive/v2.1-20201229.tar.gz</span><br><span class="line">tar -zxvf luajit2-2.1-20201229.tar.gz</span><br><span class="line"><span class="built_in">cd</span> luajit2-2.1-20201229</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#导入环境变量（编译nginx时需要）</span></span><br><span class="line"><span class="built_in">export</span> LUAJIT_LIB=/usr/<span class="built_in">local</span>/lib</span><br><span class="line"><span class="built_in">export</span> LUAJIT_INC=/usr/<span class="built_in">local</span>/include/luajit-2.1</span><br></pre></td></tr></table></figure>
<p>2、安装lua-resty-core</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://github.com/openresty/lua-resty-core/archive/v0.1.21.tar.gz</span><br><span class="line">tar -zxvf lua-resty-core-0.1.21.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lua-resty-core-0.1.21</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>3、安装lua-resty-lrucache</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://github.com/openresty/lua-resty-lrucache/archive/v0.10.tar.gz</span><br><span class="line">tar -zxvf lua-resty-lrucache-0.10.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lua-resty-lrucache-0.10</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>4、解压lua-nginx-module</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.19.tar.gz</span><br><span class="line">tar -zxvf lua-nginx-module-0.10.19.tar.gz</span><br></pre></td></tr></table></figure>
<p>5、解压ngx_devel_kit</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://github.com/vision5/ngx_devel_kit/archive/v0.3.1.tar.gz</span><br><span class="line">tar -zxvf ngx_devel_kit-0.3.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>6、解压openssl</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.1.1k.tar.gz</span><br><span class="line">tar -zxvf openssl-1.1.1k.tar.gz</span><br></pre></td></tr></table></figure>

<p>二、编译及安装nginx</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.18.0.tar.gz</span><br><span class="line">tar -zxvf nginx-1.18.0.tar.gz</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx \</span><br><span class="line">--with-openssl=/usr/<span class="built_in">local</span>/src/openssl-1.1.1k \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_auth_request_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-threads \</span><br><span class="line">--with-stream \</span><br><span class="line">--with-stream_ssl_module \</span><br><span class="line">--with-stream_ssl_preread_module \</span><br><span class="line">--with-http_slice_module \</span><br><span class="line">--with-compat \</span><br><span class="line">--with-file-aio \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-ld-opt=<span class="string">"-Wl,-rpath,/usr/local/lib"</span> \</span><br><span class="line">--add-module=/usr/<span class="built_in">local</span>/src/ngx_devel_kit-0.3.1 \</span><br><span class="line">--add-module=/usr/<span class="built_in">local</span>/src/lua-nginx-module-0.10.19</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>三、nginx配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设置openresty模块目录</span></span><br><span class="line">lua_package_path <span class="string">"/usr/local/lib/lua/?.lua;/usr/local/nginx/conf/lua/?.lua;;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定dns解析服务器,实现动态upstream</span></span><br><span class="line">resolver 114.114.114.114 223.5.5.5 1.1.1.1 8.8.8.8 valid=30;</span><br><span class="line">resolver_timeout 5;</span><br></pre></td></tr></table></figure>

<p>四、hello openresty(/usr/local/nginx/conf/lua/hello.lua)</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">ngx.<span class="built_in">print</span>(<span class="string">"hello openresty!"</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>linux</tag>
        <tag>nginx</tag>
        <tag>openresty</tag>
      </tags>
  </entry>
  <entry>
    <title>使用watch实时查看进程的文件句柄信息</title>
    <url>/posts/clvdigktd00adkoomf39qgo6z.html</url>
    <content><![CDATA[<p>一、lsof相关使用<br>1、系统所有进程打开对应的句柄数</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lsof -n|awk <span class="string">'&#123;print $2&#125;'</span>|sort|uniq -c |sort -nr|more</span><br></pre></td></tr></table></figure>

<p>2、查看当前进程实时打开的文件数</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lsof -p 进程ID |wc -l</span><br></pre></td></tr></table></figure>

<p>3、查看被打开某一文件的相关进程信息</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lsof /proc</span><br></pre></td></tr></table></figure>

<p>4、查看监听端口25的进程</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lsof -i:25</span><br></pre></td></tr></table></figure>

<p>5、查看活动的连接</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lsof -i @192.168.1.2</span><br></pre></td></tr></table></figure>

<p>二、查看当前进程持有文件句柄数量和文件句柄最大限制</p>
<p>1、查看这个PID持有的句柄数</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ls /proc/进程ID/fd | wc -l</span><br></pre></td></tr></table></figure>

<p>2、查看当前进程句柄数量限制</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat /proc/进程ID/limits | grep <span class="string">"files"</span></span><br></pre></td></tr></table></figure>

<p>三、查看系统总限制</p>
<p>1、查看系统总限制打开文件的最大数量</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat /proc/sys/fs/file-max</span><br></pre></td></tr></table></figure>

<p>四、watch命令<br>watch是一个非常实用的命令，基本所有的Linux发行版都带有这个小工具，如同名字一样，watch可以帮你监测一个命令的运行结果，省得你一遍遍的手动运行。在Linux下，watch是周期性的执行下个程序，并全屏显示执行结果。</p>
<p>1、每隔一秒高亮显示网络链接数的变化情况</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">watch -n 1 -d netstat -ant</span><br></pre></td></tr></table></figure>

<p>2、每隔一秒高亮显示http链接数的变化情况</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">watch -n 1 -d <span class="string">'pstree|grep http'</span></span><br></pre></td></tr></table></figure>

<p>3、实时查看模拟攻击客户机建立起来的连接数</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">watch <span class="string">'netstat -an | grep:21 | \ grep&lt;模拟攻击客户机的IP&gt;| wc -l'</span></span><br></pre></td></tr></table></figure>

<p>4、10秒一次输出系统的平均负载</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">watch -n 10 <span class="string">'cat /proc/loadavg'</span></span><br></pre></td></tr></table></figure>

<p>5、监测磁盘inode和block数目变化情况</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">watch -n 1 <span class="string">'df -i;df'</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>linux</tag>
        <tag>ulimits</tag>
      </tags>
  </entry>
  <entry>
    <title>Composer 使用记录</title>
    <url>/posts/635.html</url>
    <content><![CDATA[<p>Composer 是 PHP 的一个依赖管理工具。它允许你申明项目所依赖的代码库，它会在你的项目中为你安装他们。</p>
<p>运行 Composer 需要 PHP 5.3.2+ 以上版本。一些敏感的 PHP 设置和编译标志也是必须的，但对于任何不兼容项安装程序都会抛出警告。</p>
<p><strong>全局安装</strong> <strong>（推荐）</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -sS https://getcomposer.org/installer | php</span><br><span class="line"></span><br><span class="line">mv composer.phar /usr/<span class="built_in">local</span>/bin/composer</span><br></pre></td></tr></table></figure>
<p>局部安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -sS https://getcomposer.org/installer | php</span><br></pre></td></tr></table></figure>
<p><strong>全局配置（推荐）</strong></p>
<p>阿里 Composer 全量镜像</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/</span><br></pre></td></tr></table></figure>
<p>取消配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">composer config -g --<span class="built_in">unset</span> repos.packagist</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>composer</tag>
      </tags>
  </entry>
  <entry>
    <title>Xshell6 &amp; Xftp6 和谐大法</title>
    <url>/posts/602.html</url>
    <content><![CDATA[<p>Xshell 是一个强大的安全终端模拟软件，它支持SSH1, SSH2, 以及Microsoft Windows 平台的TELNET 协议。Xshell 通过互联网到远程主机的安全连接以及它创新性的设计和特色帮助用户在复杂的网络环境中享受他们的工作。<br>　　Xftp是一种灵活且轻量级的SFTP/FTP客户端，用于需要安全地通过网络传输文件的用户。文件传输被简化，使用拖拽、直接编辑和增强的同步，这些特性在直观的标签界面中被封装。</p>
<h4 id="Xshell-amp-Xftp-显示评估期已过，怎么解决？"><a href="#Xshell-amp-Xftp-显示评估期已过，怎么解决？" class="headerlink" title="Xshell &amp; Xftp 显示评估期已过，怎么解决？"></a>Xshell &amp; Xftp 显示评估期已过，怎么解决？</h4><p><strong>一、 卸载所有版本的Xshell，Xmanager，Xftp，Xldp和Netsarang产品</strong>，并从注册表中删除 NetSarang 目录 (HKEY_CURRENT_USER\Software\NetSarang)。</p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-c7b4ea247f6f3968-1024x645-1.jpg" alt=""></p>
<p><strong>二、下载 Xshell 6 &amp; Xftp 6</strong></p>
<p>下载方式</p>
<blockquote>
<p>在 <a href="http://www.netsarang.com/download/main.html" target="_blank" rel="noopener">http://www.netsarang.com/download/main.html</a> 选择下载评估版，收到下载地址后将下载地址加上r。<br>例如 <a href="https://cdn.netsarang.net/f8a8d224/XmanagerPowerSuite-6.0.0009.exe" target="_blank" rel="noopener">https://cdn.netsarang.net/f8a8d224/XmanagerPowerSuite-6.0.0009.exe</a> ，<br>改为 <a href="https://cdn.netsarang.net/f8a8d224/XmanagerPowerSuite-6.0.0009r.exe" target="_blank" rel="noopener">https://cdn.netsarang.net/f8a8d224/XmanagerPowerSuite-6.0.0009r.exe</a> 。<br>如果下载不带r的版本，无法输入序列号，注意不要下载到“思杰马克丁”特供版，下载完毕后，对安装包右键，属性，数字签名，如果是官方版则是“NetSarang Computer, Inc.”。</p>
</blockquote>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/20191227085840.png" alt=""></p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-a9351873fd98543a-1024x1014-1.jpg" alt=""></p>
<p><strong>三、 添加路由到 C:\Windows\System32\drivers\etc\hosts</strong></p>
<blockquote>
<p>127.0.0.1 transact.netsarang.com<br>127.0.0.1 update.netsarang.com<br>127.0.0.1 <a href="http://www.netsarang.com" target="_blank" rel="noopener">www.netsarang.com</a><br>127.0.0.1 <a href="http://www.netsarang.co.kr" target="_blank" rel="noopener">www.netsarang.co.kr</a><br>127.0.0.1 sales.netsarang.com</p>
</blockquote>
<p><strong>四、一定要在前三步骤做完之后再安装带r版本的 Xshell6 &amp; Xftp6</strong></p>
<blockquote>
<p>注册码<br>Xshell Plus 6 : 180505-117501-020791<br>Xmanager Power Suite 6 :180429-116253-999126</p>
</blockquote>
<p><strong>五、安装完成后，将对应的程序运行一次后，打开注册表，将下列字段设置为当前用户拒绝全部权限，否则会反弹</strong></p>
<blockquote>
<p>HKEY_CURRENT_USER\Software\NetSarang\Xftp\6\LiveUpdate<br>HKEY_CURRENT_USER\Software\NetSarang\Xlpd\6\LiveUpdate<br>HKEY_CURRENT_USER\Software\NetSarang\Xmanager\6\LiveUpdate<br>HKEY_CURRENT_USER\Software\NetSarang\Xshell\6\LiveUpdate</p>
</blockquote>
<p><strong>打开注册表程序（开始 -&gt; 运行 -&gt; regedit 或 win + R 打开运行输入 regedit 回车进入注册表编辑器）</strong></p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-6a0ab99e9fc7aadd-1024x912-1.jpg" alt=""></p>
<p><strong>点击 “高级”</strong></p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-ac71a019b4cf2ded-1024x874-1.jpg" alt=""></p>
<p><strong>禁用继承</strong></p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-c3496cbe0ebbb745-1024x729-1.jpg" alt=""></p>
<p><strong>权限转换</strong></p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-e3db2968581322d3-1024x874-1.jpg" alt=""></p>
<p><strong>编辑并取消各用户的所有权限</strong></p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-dceed98e752920b2-1024x750-1.jpg" alt=""></p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-0ea7149d506ac2dd-1024x674-1.jpg" alt=""></p>
<p><strong>已注册的Xshell6</strong></p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-9a9919fa6d3464a2-1024x716-1.jpg" alt=""></p>
<p>Xftp同样按照以上步骤操作，把权限去掉即可。</p>
<p><strong>六、彻底禁用 Xshell &amp; Xftp 更新</strong></p>
<p>xshell菜单—-工具—选项<br>在选项设置里面，点击更新选项卡，去掉实时更新的勾选</p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-254056398bdbc76d-1024x371-1.jpg" alt=""></p>
<p>删除更新程序</p>
<p><img src="https://upload.phpkoo.com/uploads/2019/12/1926763-4f42e18be6398dc7-1024x733-1.jpg" alt=""></p>
<p>也可以把 LiveUpdate.exe 换成别的一个空文件来替换</p>
<blockquote>
<p>注册码可以用这个生成<br><a href="https://github.com/DoubleLabyrinth/Xmanager-keygen" target="_blank" rel="noopener">https://github.com/DoubleLabyrinth/Xmanager-keygen</a><br>需要用Python3.6 执行</p>
</blockquote>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>xshell</tag>
      </tags>
  </entry>
  <entry>
    <title>怎样增大 Linux 系统的 open file(s) 上限</title>
    <url>/posts/596.html</url>
    <content><![CDATA[<p>最近在工作中遇到一个问题，尝试直接将服务运行在高配（40core, 192GB；相比虚拟机来说） 的物理机上，但是发现服务打开的文件句柄达到 80 万左右就不能再开更多了。</p>
<p>80 万已经是一个不小的值了，通常情况下，Linux 默认的值都很小，例如：Debian 8(jessie) 给普通用户设置的 open file(s) 限制为 65536， 可以通过下面的命令查看当前限制。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -n</span><br><span class="line">$ <span class="built_in">ulimit</span> -Sn</span><br><span class="line">$ <span class="built_in">ulimit</span> -Hn</span><br></pre></td></tr></table></figure>
<p><code>ulimit</code> 是一个 shell（这里使用的是 bash） 内置命令，可以通过 <code>type ulimit</code> 验证。</p>
<p><code>-n</code> 即表示查看或者设置 open file(s) 的限制，在 ulimit 中，每个限制都有两种类型：</p>
<ul>
<li><code>-S</code>, soft limit, 软限制，用户可以上调软限制到硬限制</li>
<li><code>-H</code>, hard limit, 硬限制，非 root 用户不能修改</li>
</ul>
<p>如果没有指明，则同时修改软限制和硬限制。</p>
<h2 id="修改-ulimit"><a href="#修改-ulimit" class="headerlink" title="修改 ulimit"></a>修改 ulimit</h2><p>修改分为临时修改和永久修改，临时修改只对当前 session 有效，登出和重启后都恢复系统设置。</p>
<p>临时修改使用 <code>ulimit</code> 命令，以修改 open file(s) 为例。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -n 1024000</span><br><span class="line">$ <span class="built_in">ulimit</span> -n</span><br><span class="line">1024000</span><br></pre></td></tr></table></figure>
<p>永久修改需要修改 <code>/etc/security/limits.conf</code> 或者在 <code>/etc/security/limits.d/</code> 目录下添加一个文件。具体格式参考 <code>/etc/security/limits.conf</code>，里面有详细说明。</p>
<h2 id="open-file-s-上限"><a href="#open-file-s-上限" class="headerlink" title="open file(s) 上限"></a>open file(s) 上限</h2><p>回到遇到的问题中来：服务打开 80 万个左右的文件句柄就不能再打开了。所以， 尝试将 ulimit 设置为 1000 万，结果提示出错：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -n 10000000</span><br><span class="line">-bash: <span class="built_in">ulimit</span>: open files: cannot modify <span class="built_in">limit</span>: Operation not permitted</span><br></pre></td></tr></table></figure>
<p>注意，使用的可以 root 用户，居然没有权限，然后尝试降低到：</p>
<ul>
<li>500 万，依然错误</li>
<li>300 万，依然错误</li>
<li>200 万，依然错误</li>
<li>100 万，成功了</li>
</ul>
<p>显然，这里有一个上限，大概在 100-200 万之间。</p>
<p>所以，解决问题的办法，在于怎样提高这个上限！</p>
<p>通过一番搜索，发现 open file(s) kernel 级别有 2 个配置，分别是：</p>
<p>fs.nr_open，进程级别<br>fs.file-max，系统级别</p>
<p><code>fs.nr_open</code> 默认设置的上限是 1048576，所以用户的 open file(s) 不可能超过这个上限。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sysctl -w fs.nr_open=10000000</span><br><span class="line">$ <span class="built_in">ulimit</span> -n 10000000</span><br><span class="line">$ <span class="built_in">ulimit</span> -n</span><br><span class="line">10000000</span><br></pre></td></tr></table></figure>
<p>修改后即可设置更大的 open file(s) 了。</p>
<p>同样，对于 kernel 参数的修改，<code>sysctl</code> 命令修改的是当前运行时，如果需要永久修改， 则将配置添加到 <code>/etc/sysctl.conf</code> 中，例如：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"fs.nr_open = 10000000"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"fs.file-max = 11000000"</span> &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p>注意：<code>fs.nr_open</code> 总是应该小于等于 <code>fs.file-max</code>。</p>
<p>如果要查看当前打开的文件数，使用下面的命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sysctl fs.file-nr</span><br><span class="line">$ fs.file-nr = 1760       0       11000000</span><br></pre></td></tr></table></figure>
<p>不过，增大这些值意味着能够打开更多的文件（在 Linux 中，everything is file，包括 socket），但是同时也意味着消耗更多的资源，所以基本上在物理机上才会遇到这种问题。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ulimit</tag>
      </tags>
  </entry>
  <entry>
    <title>golang mod使用私有仓库相关事项</title>
    <url>/posts/580.html</url>
    <content><![CDATA[<p>一、Go get命令出现terminal prompts disabled解决</p>
<p>原因go get disable “terminal prompt” by default（Go get 命令默认禁用terminal prompt，即终端提示）</p>
<p>解决方案</p>
<p>设置环境变量：<code>GIT_TERMINAL_PROMPT=1</code>， 可以把上面的命令写到 <code>.bashrc</code> 或 <code>.bash_profile</code> 文件当中。</p>
<p>二、一键解决 go get golang.org/x 包失败</p>
<p>当我们使用 <code>go get</code>、<code>go install</code>、<code>go mod</code> 等命令时，会自动下载相应的包或依赖包。但由于众所周知的原因，类似于 <code>golang.org/x/...</code> 的包会出现下载失败的情况。如下所示：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ go get -u golang.org/x/sys  </span><br><span class="line">  </span><br><span class="line">go get golang.org/x/sys: unrecognized import path <span class="string">"golang.org/x/sys"</span> (https fetch: Get https://golang.org/x/sys?go-get=1: dial tcp 216.239.37.1:443: i/o timeout)</span><br></pre></td></tr></table></figure>
<p>我们可以通过设置GOPROXY 环境变量来解决，我们知道从 <code>Go 1.11</code> 版本开始，官方支持了 <code>go module</code> 包依赖管理工具。其实还新增了 <code>GOPROXY</code> 环境变量。</p>
<p>解决方案</p>
<p>设置环境变量：<code>GOPROXY=https://goproxy.io</code>， 可以把上面的命令写到 <code>.bashrc</code> 或 <code>.bash_profile</code> 文件当中。</p>
<p>三、总结</p>
<p>解决 terminal prompts disabled</p>
<p><code>export GIT_TERMINAL_PROMPT=1</code></p>
<p>解决 go get golang.org/x 包失败</p>
<p><code>export GOPROXY=https://goproxy.io</code></p>
<p>启用 Go Modules 功能</p>
<p><code>export GO111MODULE=on</code></p>
]]></content>
      <categories>
        <category>GoLang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>mod</tag>
      </tags>
  </entry>
  <entry>
    <title>git报错 SSL connect error</title>
    <url>/posts/564.html</url>
    <content><![CDATA[<p>报错信息：  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">fatal: unable to access <span class="string">'https://github.com/***/***'</span>: SSL connect error</span><br></pre></td></tr></table></figure>
<p>解决办法：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git config --global http.sslversion tlsv1</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git config --global http.sslVerify <span class="literal">false</span>   <span class="comment">#设置跳过SSL证书验证</span></span><br></pre></td></tr></table></figure>

<p>如果还不行，可能是ssh版本过低需要升级ssh。执行命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum update nss     <span class="comment">#redhat  centos</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
  </entry>
  <entry>
    <title>centos下php7安装gmagick扩展</title>
    <url>/posts/511.html</url>
    <content><![CDATA[<p>GraphicsMagick 是 ImageMagick 的另一个分支功能和 ImageMagick 类似。下面我们介绍一下在PHP7下如何安装扩展。</p>
<p>一、安装 GraphicsMagick 依赖</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install GraphicsMagick-devel</span><br></pre></td></tr></table></figure>
<p>二、选择手动方式安装gmagick（php扩展）<br>我们这里选择最新稳定版（gmagick-2.0.5RC1）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://pecl.php.net/get/gmagick-2.0.5RC1.tgz  </span><br><span class="line">tar -zxvf gmagick-2.0.5RC1.tgz  </span><br><span class="line"><span class="built_in">cd</span> gmagick-2.0.5RC1  </span><br><span class="line">/usr/<span class="built_in">local</span>/php/bin/phpize  </span><br><span class="line">./configure --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config  </span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>三、选择pecl方式安装gmagick（php扩展）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pecl install gmagick</span><br></pre></td></tr></table></figure>
<p>四、修改php.ini 增加 extension，同时reload php-fpm 完成。</p>
<p>ps：<br>安装过程中可能出现以下问题<br>linux ‘….’:is not a valid libtool object”错误<br>解决方法</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>
<p>然后在重新执行命令，原因是编译的时候有问题重新编译一下文件就解决了</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>GMAGICK</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS下yum安装libmcrypt错误：No package libmcrypt available</title>
    <url>/posts/507.html</url>
    <content><![CDATA[<p>错误描述：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install libmcrypt libmcrypt-devel</span><br><span class="line"></span><br><span class="line">Setting up Install Process</span><br><span class="line">No package libmcrypt available.</span><br><span class="line">No package libmcrypt-devel available.</span><br><span class="line">Error: Nothing to <span class="keyword">do</span></span><br></pre></td></tr></table></figure>
<p>我们会看到centos yum从仓库中根本找不到这几个包。但我不想使用源码编译就想使用yum安装，怎么办？<br>解决方法：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install epel-release  <span class="comment">#扩展包更新包</span></span><br><span class="line">yum update <span class="comment">#更新yum源</span></span><br></pre></td></tr></table></figure>
<p>然后再重新</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install libmcrypt libmcrypt-devel</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>centos7</tag>
        <tag>yum</tag>
      </tags>
  </entry>
  <entry>
    <title>.gitignore 不起作用的解决办法</title>
    <url>/posts/504.html</url>
    <content><![CDATA[<p>把某些目录或文件加入.gitignore规则，发现并未生效，原因是.gitignore只能忽略那些原来没有被追踪的文件，如果某些文件已经被纳入了版本管理中，则修改.gitignore是无效的。那么解决方法就是先把本地缓存删除（改变成未被追踪状态），然后再提交：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git rm -r --cached .</span><br><span class="line">git add .</span><br><span class="line">git commit -m 'update .gitignore'</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>gitignore</tag>
      </tags>
  </entry>
  <entry>
    <title>centos 7 下安装openvpn</title>
    <url>/posts/490.html</url>
    <content><![CDATA[<p>一、环境版本<br>1、CentOS 7.4<br>2、OpenVPN 2.4.6<br>3、easy-rsa 3.0</p>
<p>二、安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">yum install -y openssl openssl-devel lzo lzo-devel pam pam-devel automake pkgconfig makecache</span><br><span class="line">yum install -y openvpn</span><br><span class="line">yum install -y easy-rsa</span><br></pre></td></tr></table></figure>
<p>三、添加openvpn配置用户</p>
<p>#启动openvpn的用户</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">groupadd openvpn</span><br><span class="line">useradd -g openvpn -M -s /sbin/nologin openvpn</span><br></pre></td></tr></table></figure>
<p>四、创建配置文件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mkdir /etc/openvpn/</span><br><span class="line">cp -r /usr/share/easy-rsa/ /etc/openvpn/</span><br><span class="line">cp -r /usr/share/doc/easy-rsa-3.0.3/vars.example /etc/openvpn/easy-rsa/3.0/vars</span><br><span class="line">cp -r /usr/share/doc/openvpn-2.4.6/sample/sample-config-files/server.conf /etc/openvpn/server.conf</span><br></pre></td></tr></table></figure>
<p>五、修改easy-rsa密钥生成配置（修改第45、65、76、84-89、97、105、113、117、134、139、171、180、192行）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim /etc/openvpn/easy-rsa/3.0/vars</span><br><span class="line"></span><br><span class="line">set_var EASYRSA <span class="string">"<span class="variable">$PWD</span>"</span></span><br><span class="line">set_var EASYRSA_PKI <span class="string">"<span class="variable">$EASYRSA</span>/pki"</span></span><br><span class="line">set_var EASYRSA_DN <span class="string">"cn_only"</span></span><br><span class="line">set_var EASYRSA_REQ_COUNTRY <span class="string">"CN"</span></span><br><span class="line">set_var EASYRSA_REQ_PROVINCE <span class="string">"BEIJING"</span></span><br><span class="line">set_var EASYRSA_REQ_CITY <span class="string">"BEIJING"</span></span><br><span class="line">set_var EASYRSA_REQ_ORG <span class="string">"OpenVPN CERTIFICATE AUTHORITY"</span></span><br><span class="line">set_var EASYRSA_REQ_EMAIL <span class="string">"110@qq.com"</span></span><br><span class="line">set_var EASYRSA_REQ_OU <span class="string">"OpenVPN EASY CA"</span></span><br><span class="line">set_var EASYRSA_KEY_SIZE 2048</span><br><span class="line">set_var EASYRSA_ALGO rsa</span><br><span class="line">set_var EASYRSA_CA_EXPIRE 7000</span><br><span class="line">set_var EASYRSA_CERT_EXPIRE 3650</span><br><span class="line">set_var EASYRSA_NS_SUPPORT <span class="string">"no"</span></span><br><span class="line">set_var EASYRSA_NS_COMMENT <span class="string">"OpenVPN CERTIFICATE AUTHORITY"</span></span><br><span class="line">set_var EASYRSA_EXT_DIR <span class="string">"<span class="variable">$EASYRSA</span>/x509-types"</span></span><br><span class="line">set_var EASYRSA_SSL_CONF <span class="string">"<span class="variable">$EASYRSA</span>/openssl-1.0.cnf"</span></span><br><span class="line">set_var EASYRSA_DIGEST <span class="string">"sha256"</span></span><br></pre></td></tr></table></figure>
<p>六、生成ca证书</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/openvpn/easy-rsa/3.0</span><br><span class="line">./easyrsa init-pki</span><br><span class="line">./easyrsa build-ca</span><br><span class="line"><span class="comment">#设置ca密码（输入两次）：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成Diffie Hellman key exchange文件</span></span><br><span class="line">./easyrsa gen-dh</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成tls-auth key文件</span></span><br><span class="line"><span class="built_in">cd</span> /etc/openvpn</span><br><span class="line">openvpn --genkey --secret ta.key</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用gen-req来生成req</span></span><br><span class="line"><span class="built_in">cd</span> /etc/openvpn/easy-rsa/3.0</span><br><span class="line">./easyrsa  gen-req wwwserver</span><br><span class="line"></span><br><span class="line"><span class="comment">#签发服务端证书</span></span><br><span class="line">./easyrsa sign-req server wwwserver</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成客户端用户</span></span><br><span class="line">./easyrsa build-client-full www001</span><br></pre></td></tr></table></figure>
<p>七、修改openvpn服务端配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim /etc/openvpn/server.conf</span><br><span class="line"></span><br><span class="line">port 1194</span><br><span class="line">proto udp</span><br><span class="line">dev tun</span><br><span class="line">ca /etc/openvpn/easy-rsa/3.0/pki/ca.crt</span><br><span class="line">cert /etc/openvpn/easy-rsa/3.0/pki/issued/wwwserver.crt</span><br><span class="line">key /etc/openvpn/easy-rsa/3.0/pki/private/wwwserver.key</span><br><span class="line">dh /etc/openvpn/easy-rsa/3.0.3/pki/dh.pem</span><br><span class="line">tls-auth /etc/openvpn/ta.key 0</span><br><span class="line">server 10.8.0.0 255.255.255.0</span><br><span class="line">ifconfig-pool-persist ipp.txt</span><br><span class="line">push <span class="string">"redirect-gateway def1 bypass-dhcp"</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 223.5.5.5"</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 114.114.114.114"</span></span><br><span class="line">keepalive 10 120</span><br><span class="line">cipher AES-256-CBC</span><br><span class="line">comp-lzo</span><br><span class="line">max-clients 50</span><br><span class="line">user openvpn</span><br><span class="line">group openvpn</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">status openvpn-status.log</span><br><span class="line"><span class="built_in">log</span>-append openvpn.log</span><br><span class="line">verb 3</span><br><span class="line">mute 20</span><br></pre></td></tr></table></figure>
<p>八、服务器防火墙和路由配置</p>
<p>在iptables中添加一条路由转发规则, 并保存:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -j MASQUERADE</span><br><span class="line">iptables-save</span><br></pre></td></tr></table></figure>
<p>同时, 我们必须在sysctl中启用ip forward.<br>打开文件vi /etc/sysctl.conf, 并添加以下内容:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure>
<p>然后重启网络:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl restart network.service</span><br></pre></td></tr></table></figure>
<p>九、启动服务器</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl start openvpn@server</span><br><span class="line"><span class="comment">#启动时输入服务端证书密码：</span></span><br></pre></td></tr></table></figure>
<p>十、客户端配置（下载客户端证书）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mkdir -p /etc/openvpn/client</span><br><span class="line">cp -r /etc/openvpn/easy-rsa/3.0/pki/issued/www001.crt /etc/openvpn/client/</span><br><span class="line">cp -r /etc/openvpn/easy-rsa/3.0/pki/private/www001.key /etc/openvpn/client/</span><br><span class="line">cp -r /etc/openvpn/easy-rsa/3.0/pki/ca.crt /etc/openvpn/client/</span><br><span class="line">cp -r /etc/openvpn/ta.key /etc/openvpn/client/</span><br></pre></td></tr></table></figure>
<p>十一、修改客户端ovpn文件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">client</span><br><span class="line">dev tun</span><br><span class="line">proto udp</span><br><span class="line">remote xxx.xxx.xxx.xxx 1194 <span class="comment">#改成外网IP</span></span><br><span class="line">resolv-retry infinite</span><br><span class="line">nobind</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">comp-lzo</span><br><span class="line">ca ca.crt</span><br><span class="line">cert www001.crt</span><br><span class="line">key www001.key</span><br><span class="line">remote-cert-tls server</span><br><span class="line">tls-auth ta.key 1</span><br><span class="line">cipher AES-256-CBC</span><br><span class="line">keepalive 10 120</span><br><span class="line">verb 5</span><br></pre></td></tr></table></figure>
<p>ps<br>1、如果是阿里云的专用网络，需要配置放行1194端口udp<br>2、如生成证书时输错密码（删除以下文件即可）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">rm -rf /etc/openvpn/easy-rsa/3.0/pki/reqs/www001.req</span><br><span class="line">rm -rf /etc/openvpn/easy-rsa/3.0/pki/private/www001.key</span><br></pre></td></tr></table></figure>
<p>3、撤销证书</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/openvpn/easy-rsa/3.0</span><br><span class="line">./easyrsa revoke www001</span><br></pre></td></tr></table></figure>
<p>4、解决服务器每次都要输入Enter PEM pass phrase</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">openssl rsa -<span class="keyword">in</span> server.key -out server.key.unsecure</span><br></pre></td></tr></table></figure>
<p>服务器改用这个server.key.unsecure就不会每次提示了</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos7</tag>
        <tag>openvpn</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下php7安装imagick扩展</title>
    <url>/posts/477.html</url>
    <content><![CDATA[<p>ImageMagick是一个用于查看、编辑位图文件以及进行图像格式转换的开放源代码软件套装。ImageMagick官方提供了多种开发语言的扩展或者类库。下面我们介绍一下在PHP7下如何安装扩展。</p>
<p>一、安装ImageMagick依赖</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install ImageMagick-devel</span><br></pre></td></tr></table></figure>
<p>二、选择手动方式安装imagick（php扩展）<br>我们这里选择最新稳定版（imagick-3.4.0）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://pecl.php.net/get/imagick-3.4.0.tgz</span><br><span class="line">tar -zxvf imagick-3.4.0.tgz</span><br><span class="line"><span class="built_in">cd</span> imagick-3.4.0</span><br><span class="line">/usr/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>三、选择pecl方式安装imagick（php扩展）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pecl install imagick</span><br></pre></td></tr></table></figure>
<p>四、修改php.ini 增加 extension，同时reload php-fpm 完成。</p>
<p>ps：<br>安装过程中可能出现以下问题<br>linux ‘….’:is not a valid libtool object”错误<br>解决方法</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">make clean</span><br></pre></td></tr></table></figure>
<p>然后在重新执行命令，原因是编译的时候有问题重新编译一下文件就解决了</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>imagick</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 安装 Docker CE</title>
    <url>/posts/468.html</url>
    <content><![CDATA[<p><strong>准备工作</strong></p>
<p><strong>一、系统要求</strong><br>Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10。 CentOS 7 满足最低内核的要求，但由于内核版本比较低，部分功能（如 overlay2 存储层驱动）无法使用，并且部分功能可能不太稳定。</p>
<p><strong>二、卸载旧版本</strong><br>旧版本的 Docker 称为 docker 或者 docker-engine，使用以下命令卸载旧版本：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">           docker-client \</span><br><span class="line">           docker-client-latest \</span><br><span class="line">           docker-common \</span><br><span class="line">           docker-latest \</span><br><span class="line">           docker-latest-logrotate \</span><br><span class="line">           docker-logrotate \</span><br><span class="line">           docker-selinux \</span><br><span class="line">           docker-engine-selinux \</span><br><span class="line">           docker-engine</span><br></pre></td></tr></table></figure>
<p><strong>三、使用 yum 安装</strong><br>执行以下命令安装依赖包：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2</span><br></pre></td></tr></table></figure>
<p>鉴于国内网络问题，强烈建议使用国内源，官方源请在注释中查看。<br>执行下面的命令添加 yum 软件源：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方源</span></span><br><span class="line">$ yum-config-manager \</span><br><span class="line">     --add-repo \</span><br><span class="line">     https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
<p>如果需要最新版本的 Docker CE 请使用以下命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum-config-manager --<span class="built_in">enable</span> docker-ce</span><br></pre></td></tr></table></figure>
<p>如果需要测试版本的 Docker CE 请使用以下命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum-config-manager --<span class="built_in">enable</span> docker-ce-test</span><br></pre></td></tr></table></figure>
<p><strong>安装 Docker CE</strong><br>更新 yum 软件源缓存，并安装 docker-ce。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum makecache fast</span><br><span class="line">yum install docker-ce</span><br></pre></td></tr></table></figure>
<p>或者</p>
<p><strong>使用脚本自动安装</strong><br>在测试或开发环境中 Docker 官方为了简化安装流程，提供了一套便捷的安装脚本，CentOS 系统上可以使用这套脚本安装：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -fsSL get.docker.com -o get-docker.sh</span><br><span class="line">sh get-docker.sh --mirror Aliyun</span><br></pre></td></tr></table></figure>
<p>执行这个命令后，脚本就会自动的将一切准备工作做好，并且把 Docker CE 的 Edge 版本安装在系统中。</p>
<p><strong>启动 Docker CE</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>
<p><strong>建立 docker 用户组（如果使用root用户操作 可忽略）</strong><br>默认情况下，docker 命令会使用 Unix socket 与 Docker 引擎通讯。而只有 root 用户和 docker 组的用户才可以访问 Docker 引擎的 Unix socket。出于安全考虑，一般 Linux 系统上不会直接使用 root 用户。因此，更好地做法是将需要使用 docker 的用户加入 docker 用户组。</p>
<p>建立 docker 组：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">groupadd docker</span><br></pre></td></tr></table></figure>
<p>将当前用户加入 docker 组：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>
<p>退出当前终端并重新登录，进行如下测试。</p>
<p><strong>测试 Docker 是否安装正确</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>
<p><strong>添加内核参数</strong><br>默认配置下，如果在 CentOS 使用 Docker CE 看到下面的这些警告信息：</p>
<p>WARNING: bridge-nf-call-iptables is disabled<br>WARNING: bridge-nf-call-ip6tables is disabled</p>
<p>请添加内核配置参数以启用这些功能。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tee -a /etc/sysctl.conf &lt;&lt;-EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>然后重新加载 sysctl.conf 即可</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>centos7</tag>
        <tag>docker-ce</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTPS中证书链不完整的解决方案</title>
    <url>/posts/458.html</url>
    <content><![CDATA[<p><a href="https://upload.phpkoo.com/uploads/2018/06/httpsCertificateChain1.png" target="_blank" rel="noopener"><img src="https://upload.phpkoo.com/uploads/2018/06/httpsCertificateChain1.png" alt=""></a></p>
<p><a href="https://upload.phpkoo.com/uploads/2018/06/httpsCertificateChain2.png" target="_blank" rel="noopener"><img src="https://upload.phpkoo.com/uploads/2018/06/httpsCertificateChain2.png" alt=""></a></p>
<p><a href="https://upload.phpkoo.com/uploads/2018/06/httpsCertificateChain3.png" target="_blank" rel="noopener"><img src="https://upload.phpkoo.com/uploads/2018/06/httpsCertificateChain3.png" alt=""></a></p>
<p>由于我们的部分业务场景是在微信（WebView）中打开https的web页面，在测试过程中却发现了一个问题，在Chrome中测试完全正常的https页面，在iOS的微信（WebView）中表现正常，但在Android中，不论是哪个版本的安卓系统，都不能正常打开页面，要么就是一片白，要么就是直接无法打开，解决这个问题，需要在服务器上配置完整的SSL证书链。<br>之后在Android自带的浏览器中测试，几乎所有的手机都出现下面这样的情况</p>
<p><strong>证书链</strong><br>看来Andorid的WebView不能打开页面应该是与这有关，造成这个问题的主要原因是我们服务器配置证书的证书链不全造成的。</p>
<p>证书链其实就是描述证书的签名环节，就比如是 A 颁发证书给 B ，B颁发证书给C，然后我们手里的就是证书C。当证书链不完整的情况下，也就是没有描述我们手中的证书C是由谁办法的，所以导致的浏览器不认为你这个证书是可信的授权证书。</p>
<p>每个设备中都会存有一些默认的可信的根证书，但很多CA是不使用根证书进行签名的，而是使用中间层证书进行签名，因为这样做能更快的进行替换（这句可能不对，原文是 because these can be rotated more frequently）。</p>
<p>如果你的服务器上没有中间件证书，这样的结果就是你的服务器上只有你的网站的证书，客户端的浏览器里只有CA的根证书，这样就会导致证书信任链不全，才导致了上面那两个截图中的问题。这种中间层证书不全的问题多出现在移动端的浏览器上（就我目前看，iOS8 iOS9 都没有出现问题，Andorid各个版本都有这个问题）。</p>
<p>当你服务器上的证书中的信任链不全的情况下，浏览器会认为当前的链接是一个不安全的，会阻止页面的打开。</p>
<p><strong>解决方案</strong><br>说清楚了原因，解决问题就很简单了，只要把我们的证书链补全就可以了。<br>从SSL证书服务商那里，你获得的crt证书文件大概是这个样子的：</p>
<p>—–BEGIN CERTIFICATE—–<br>    # 证书内容<br>—–END CERTIFICATE—–</p>
<p>在你补全中间层证书和根证书后，新的crt证书文件看起来是这样的：</p>
<p>—–BEGIN CERTIFICATE—–<br>    # 证书内容 1<br>—–END CERTIFICATE—–</p>
<p>—–BEGIN CERTIFICATE—–<br>    # 证书内容 2<br>—–END CERTIFICATE—–</p>
<p>—–BEGIN CERTIFICATE—–<br>    # 证书内容 3<br>—–END CERTIFICATE—–</p>
<p>这里包含了你的证书，以及从你的证书向上递归直至根证书的全部证书，这样就可以向浏览器证明你的链接是安全的。</p>
<p><strong>补全证书链</strong><br>比较方便的是使用这个在线的工具：<br><a href="https://certificatechain.io" target="_blank" rel="noopener">https://certificatechain.io</a><br>进入这个网站，粘贴进你的证书（只包含你的用户证书），或者上传你的证书，他就会给出补全后的证书文件，你只需要粘贴回你的文件或者下载覆盖就可以了，然后在服务器上重新部署就可以解决问题。<br>由于这里只需要上传证书，所以是安全的，不需要担心不安全的问题。<br>如果不喜欢用在线的工具，可以使用下面这个本地的工具，PHP写的，在命令行中运行：<br><a href="https://github.com/spatie/ssl-certificate-chain-resolver" target="_blank" rel="noopener">Github ssl-certificate-chain-resolver</a></p>
<p><strong>PS:</strong><br>一般情况下<br>cert.pem 是证书<br>chain.pem 是证书链编码<br>fullchain.pem 是cert.pem和chain.pem的证书集合<br>privkey.pem 是私钥文件</p>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>https</tag>
        <tag>证书链</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL: libmysqlclient.so.20: cannot open shared object file解决方法</title>
    <url>/posts/454.html</url>
    <content><![CDATA[<p>import MySQLdb的时候报错“ImportError: libmysqlclient.so.20: cannot open shared object file: No such file or directory”</p>
<p>解决方法：<br>找到libmysqlclient.so.20,一般都在mysql安装目录/lib库里，做个软链接即可。</p>
<p>######64为系统</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ln -s /usr/<span class="built_in">local</span>/mysql/lib/libmysqlclient.so.20 /usr/lib64/libmysqlclient.so.20</span><br></pre></td></tr></table></figure>
<p>######32位系统</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ln -s /usr/<span class="built_in">local</span>/mysql/lib/libmysqlclient.so.20 /usr/lib/libmysqlclient.so.20</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>libmysqlclient</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx配置ssl及优化</title>
    <url>/posts/425.html</url>
    <content><![CDATA[<p>https是一种超文本传输安全协议，主要是用SSL/TLS来加密数据包，以达到数据加密传输的作用，同时也能一定程度达到防劫持的效果。</p>
<p><strong>隐藏不必要的信息</strong><br>细心的朋友会发现，请求响应头，有这么一行 server: nginx，说明我用的是 Nginx 服务器，但并没有具体的版本号。由于某些 Nginx 漏洞只存在于特定的版本，隐藏版本号可以提高安全性。这只需要在配置里加上这个就可以了：</p>
<p><code>server_tokens  off;</code></p>
<p>另外，一些 WEB 语言或框架默认输出的 x-powered-by 也会泄露网站信息，他们一般都提供了修改或移除的方法，可以自行查看手册。如果部署上用到了 Nginx 的反向代理，也可以通过 proxy_hide_header 指令隐藏它：</p>
<p><code>proxy_hide_header  X-Powered-By;</code></p>
<p><strong>禁用非必要的方法</strong><br>一般情况下，只需要处理 GET、POST 两种请求方法，而 HTTP/1 协议还规定了 TRACE 这样的方法用于网络诊断，这也可能会暴露一些信息。所以我针对 GET、POST 以及 HEAD 之外的请求，直接返回了 444 状态码（444 是 Nginx 定义的响应状态码，会立即断开连接，没有响应正文）。具体配置是这样的：</p>
<p>if ($request_method !~ ^(GET|HEAD|POST)$ ) {<br>    return    444;<br>}</p>
<p><strong>合理配置响应头</strong></p>
<p>#####减少点击劫持<br>add_header X-Frame-Options DENY;</p>
<p>#####禁止服务器自动解析资源类型<br>add_header X-Content-Type-Options nosniff;</p>
<p>#####防XSS攻击<br>add_header X-XSS-Protection “1; mode=block”;</p>
<p>#####HSTS策略<br>add_header Strict-Transport-Security “max-age=31536000; includeSubDomains; preload” always;</p>
<p><code>X-Frame-Options</code> 用来指定此网页是否允许被 iframe 嵌套，deny 就是不允许任何嵌套发生。<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options" target="_blank" rel="noopener">这部分内容更多信息</a>。<br><code>X-Content-Type-Options</code> 用来指定浏览器对未指定或错误指定 Content-Type 资源真正类型的猜测行为，nosniff 表示不允许任何猜测。<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Content-Type-Options" target="_blank" rel="noopener">这部分内容更多信息</a>。<br><code>X-XSS-Protection</code> 这个响应头是用来防范XSS的。最早我是在介绍IE8的文章里看到这个，现在主流浏览器都支持，并且默认都开启了XSS保护，用这个header可以关闭它。它有几种配置：<br>0：禁用XSS保护；<br>1：启用XSS保护；<br>1; mode=block：启用XSS保护，并在检查到XSS攻击时，停止渲染页面（例如IE8中，检查到攻击时，整个页面会被一个#替换）；<br>浏览器提供的XSS保护机制并不完美，但是开启后仍然可以提升攻击难度，总之没有特别的理由，不要关闭它。<br><code>Strict-Transport-Security</code>（简称为 HSTS）可以告诉浏览器，在指定的 max-age 内，始终通过 HTTPS 访问我的博客。即使用户自己输入 HTTP 的地址，或者点击了 HTTP 链接，浏览器也会在本地替换为 HTTPS 再发送请求。另外由于我的证书不支持多域名，我没有加上 includeSubDomains。关于 <a href="https://www.nginx.com/blog/http-strict-transport-security-hsts-and-nginx/" target="_blank" rel="noopener">HSTS</a> 更多信息。</p>
<p><strong>HTTPS 安全配置</strong><br>启用 HTTPS 并正确配置了证书，意味着数据传输过程中无法被第三者解密或修改。有了 HTTPS，也得合理配置好 Web Server，才能发挥最大价值。关于 HTTPS 这一块有以下配置：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">worker_processes auto;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#配置会话超时时间</span></span><br><span class="line">    ssl_session_timeout  10m;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#配置共享会话缓存大小，视站点访问情况设定</span></span><br><span class="line">    ssl_session_cache shared:SSL:10m;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen      443 ssl;</span><br><span class="line">        server_name www.example.com;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#设置长连接</span></span><br><span class="line">        keepalive_timeout 70;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#开启HTTPS协议（推荐使用listen指令的ssl参数来代替这个指令）</span></span><br><span class="line">        <span class="comment">#ssl on;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#证书文件</span></span><br><span class="line">        ssl_certificate www.example.com.crt;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#私钥文件</span></span><br><span class="line">        ssl_certificate_key www.example.com.key;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#使用DH文件</span></span><br><span class="line">        ssl_dhparam /etc/ssl/certs/dhparam.pem;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#版本选择</span></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#定义算法</span></span><br><span class="line">        ssl_ciphers EECDH+ECDSA+AES128:EECDH+aRSA+AES128:RSA+AES128:EECDH+ECDSA+AES256:EECDH+aRSA+AES256:RSA+AES256:EECDH+ECDSA+3DES:EECDH+aRSA+3DES:RSA+3DES:!MD5;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#优先采取服务器算法</span></span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#减少点击劫持</span></span><br><span class="line">        add_header X-Frame-Options DENY;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#禁止服务器自动解析资源类型</span></span><br><span class="line">        add_header X-Content-Type-Options nosniff;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#防XSS攻击</span></span><br><span class="line">        add_header X-XSS-Protection <span class="string">"1; mode=block"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#HSTS策略</span></span><br><span class="line">        add_header Strict-Transport-Security <span class="string">"max-age=31536000;"</span> always;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://upload.phpkoo.com/uploads/2018/04/ssllabs_20180422092149-1.png" target="_blank" rel="noopener"><img src="https://upload.phpkoo.com/uploads/2018/04/ssllabs_20180422092149-1.png" alt=""></a></p>
<p>最终效果在 <a href="https://www.ssllabs.com/ssltest/index.html" target="_blank" rel="noopener">ssllabs</a> 中测试结果如下。  </p>
<p>如何配置 ssl_ciphers 可以参考<a href="https://cipherli.st/" target="_blank" rel="noopener">这个网站</a>。需要注意的是，这个网站默认提供的加密方式安全性较高，一些低版本客户端并不支持，例如 IE9-、Android2.2- 和 Java6-。如果需要支持这些老旧的客户端，需要点一下网站上的「Yes, give me a ciphersuite that works with legacy / old software」链接，同时也可以使用 <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/" target="_blank" rel="noopener">Mozilla 基金会</a> 来生成配置。</p>
<p><img src="https://upload.phpkoo.com/uploads/2018/04/chacha.png.webp_.jpg" alt=""></p>
<p>另外 ssl_ciphers 还支持 CHACHA20 加密套件，只要 Nginx 编译时增加了 CHACHA20_POLY1305 加密算法即可，这是由 Google 开发的新一代加密方式，它有两方面优势：更好的安全性和更好的性能（尤其是在移动和可穿戴设备上）。下面有一张移动平台上它与 AES-GCM 的加密速度对比图（via）：  </p>
<p>启用 CHACHA20_POLY1305 最简单的方法是在编译 Nginx 时，使用 LibreSSL 代替 OpenSSL。用 Chrome 访问网站时，点击地址栏小锁显示的信息，可以看到加密方式使用的是不是 CHACHA20_POLY1305。<br>关于 CHACHA20_POLY1305 安全性和性能的详细介绍可以<a href="https://blog.cloudflare.com/do-the-chacha-better-mobile-performance-with-cryptography/" target="_blank" rel="noopener">查看本文</a>。</p>
<p>补充：<br>1.使用 CHACHA20_POLY1305 的最佳实践是「仅针对不支持 AES-NI 的终端使用 CHACHA20 算法，否则使用 AES-GCM」。</p>
<p>2.我们通过 openssl 工具看一下 ssl_ciphers 具体包含哪些 Cipher Suites 例如：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">openssl ciphers -V <span class="string">'EECDH+AES128'</span> | column -t</span><br><span class="line"></span><br><span class="line">0xC0,0x2F  -  ECDHE-RSA-AES128-GCM-SHA256    TLSv1.2  Kx=ECDH  Au=RSA    Enc=AESGCM(128)  Mac=AEAD</span><br><span class="line">0xC0,0x2B  -  ECDHE-ECDSA-AES128-GCM-SHA256  TLSv1.2  Kx=ECDH  Au=ECDSA  Enc=AESGCM(128)  Mac=AEAD</span><br><span class="line">0xC0,0x27  -  ECDHE-RSA-AES128-SHA256        TLSv1.2  Kx=ECDH  Au=RSA    Enc=AES(128)     Mac=SHA256</span><br><span class="line">0xC0,0x23  -  ECDHE-ECDSA-AES128-SHA256      TLSv1.2  Kx=ECDH  Au=ECDSA  Enc=AES(128)     Mac=SHA256</span><br><span class="line">0xC0,0x13  -  ECDHE-RSA-AES128-SHA           SSLv3    Kx=ECDH  Au=RSA    Enc=AES(128)     Mac=SHA1</span><br><span class="line">0xC0,0x09  -  ECDHE-ECDSA-AES128-SHA         SSLv3    Kx=ECDH  Au=ECDSA  Enc=AES(128)     Mac=SHA1</span><br></pre></td></tr></table></figure>
<p><strong>加强 HTTPS 安全性</strong><br>HTTPS 基础配置采取的默认加密算法是 SHA-1，这个算法非常脆弱，安全性在逐年降低，在 2014 年的时候， Google 官方博客就宣布在 Chrome 浏览器中逐渐降低 SHA-1 证书的安全指示，会从 2015 年起使用 SHA-2 签名的证书，可参阅 <a href="http://www.freebuf.com/author/rabbit_run" target="_blank" rel="noopener">Rabbit_Run</a> 在 2014 年发表的文章：<a href="http://www.freebuf.com/news/topnews/44288.html" target="_blank" rel="noopener">《为什么Google急着杀死加密算法SHA-1》</a></p>
<p>为此，主流的 HTTPS 配置方案应该避免 SHA-1，可以使用 <a href="https://zh.wikipedia.org/wiki/%E8%BF%AA%E8%8F%B2-%E8%B5%AB%E7%88%BE%E6%9B%BC%E5%AF%86%E9%91%B0%E4%BA%A4%E6%8F%9B" target="_blank" rel="noopener">迪菲-赫尔曼密钥交换（D-H，Diffie–Hellman key exchange）</a>方案。</p>
<p>首先在目录 /etc/ssl/certs 运行以下代码生成 dhparam.pem 文件：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">openssl dhparam -out dhparam.pem 2048</span><br></pre></td></tr></table></figure>
<p>关于 ssl_dhparam 的配置，可以参考这篇文章：<a href="https://weakdh.org/sysadmin.html" target="_blank" rel="noopener">Guide to Deploying Diffie-Hellman for TLS</a>。</p>
<p>SSLv3 已被证实不安全，所以在 ssl_protocols 指令中，我并没有包含它。<br>将 ssl_prefer_server_ciphers 配置为 on，可以确保在 TLSv1 握手时，使用服务端的配置项，以增强安全性。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>https</tag>
        <tag>ssl</tag>
      </tags>
  </entry>
  <entry>
    <title>golang 100行代码实现区块链原型</title>
    <url>/posts/414.html</url>
    <content><![CDATA[<p>有人说今年（2018年）是区块链技术元年，作为一种新兴的技术，它不仅弯道超车盖过了人工智能、大数据的风头，而且发展速度更是一日千里。各大厂商都相继推出区块链服务，你可能觉得难以置信。不管你信不信，当你还在熟睡时，有一群人还在挑灯夜战。</p>
<p>在周未闲来无事，虽然之前网上也有各版本的区块链代码，还是动手用golang写了一下，简单实现了区块链的原型。代码如下：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">"crypto/sha256"</span></span><br><span class="line"> <span class="string">"encoding/json"</span></span><br><span class="line"> <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Block 结构</span></span><br><span class="line"><span class="keyword">type</span> Block <span class="keyword">struct</span> &#123;</span><br><span class="line"> Index        <span class="keyword">int</span></span><br><span class="line"> Timestamp    <span class="keyword">string</span></span><br><span class="line"> Data         <span class="keyword">string</span></span><br><span class="line"> PreviousHash <span class="keyword">string</span></span><br><span class="line"> Hash         <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//CalculateHash 计算HASH</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Block)</span> <span class="title">CalculateHash</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"> s := fmt.Sprintf(<span class="string">"%d%s%s%s"</span>, b.Index, b.PreviousHash, b.Timestamp, b.Data)</span><br><span class="line"> sum := sha256.Sum256([]<span class="keyword">byte</span>(s))</span><br><span class="line"> <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%x"</span>, sum)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//BlockChain 结构</span></span><br><span class="line"><span class="keyword">type</span> BlockChain <span class="keyword">struct</span> &#123;</span><br><span class="line"> Chain []*Block</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//NewBlockChain 创建区块链</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBlockChain</span><span class="params">()</span> *<span class="title">BlockChain</span></span> &#123;</span><br><span class="line"> bc := &amp;BlockChain&#123;&#125;</span><br><span class="line"> bc.Chain = <span class="built_in">append</span>(bc.Chain, bc.CreateGenesisBlock())</span><br><span class="line"> <span class="keyword">return</span> bc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//CreateGenesisBlock 创建创世块</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BlockChain)</span> <span class="title">CreateGenesisBlock</span><span class="params">()</span> *<span class="title">Block</span></span> &#123;</span><br><span class="line"> b := &amp;Block&#123;</span><br><span class="line"> Index:        <span class="number">0</span>,</span><br><span class="line"> Timestamp:    <span class="string">"2018-01-01"</span>,</span><br><span class="line"> Data:         <span class="string">"Genesis Block"</span>,</span><br><span class="line"> PreviousHash: <span class="string">"0"</span>,</span><br><span class="line"> &#125;</span><br><span class="line"> b.Hash = b.CalculateHash()</span><br><span class="line"> <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//GetLatestBlock 最新区块</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BlockChain)</span> <span class="title">GetLatestBlock</span><span class="params">()</span> *<span class="title">Block</span></span> &#123;</span><br><span class="line"> <span class="keyword">return</span> bc.Chain[<span class="built_in">len</span>(bc.Chain)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//AddBlock 增加区块</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BlockChain)</span> <span class="title">AddBlock</span><span class="params">(newBlock *Block)</span></span> &#123;</span><br><span class="line"> newBlock.Index = bc.GetLatestBlock().Index + <span class="number">1</span></span><br><span class="line"> newBlock.PreviousHash = bc.GetLatestBlock().Hash</span><br><span class="line"> newBlock.Hash = newBlock.CalculateHash()</span><br><span class="line"> bc.Chain = <span class="built_in">append</span>(bc.Chain, newBlock)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IsChainValid 区块是否有效</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BlockChain)</span> <span class="title">IsChainValid</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"> <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(bc.Chain); i++ &#123;</span><br><span class="line"> currentBlock := bc.Chain[i]</span><br><span class="line"> previousBlock := bc.Chain[i<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> currentBlock.Hash != currentBlock.CalculateHash() &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> currentBlock.PreviousHash != previousBlock.Hash &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"> bc := NewBlockChain()</span><br><span class="line"> bc.AddBlock(&amp;Block&#123;Timestamp: <span class="string">"2018-02-01"</span>, Data: <span class="string">`&#123;"amout":10&#125;`</span>&#125;)</span><br><span class="line"> bc.AddBlock(&amp;Block&#123;Timestamp: <span class="string">"2018-03-01"</span>, Data: <span class="string">`&#123;"amout":20&#125;`</span>&#125;)</span><br><span class="line"> bc.AddBlock(&amp;Block&#123;Timestamp: <span class="string">"2018-04-01"</span>, Data: <span class="string">`&#123;"amout":30&#125;`</span>&#125;)</span><br><span class="line"></span><br><span class="line"> blockchain, _ := json.MarshalIndent(bc, <span class="string">""</span>, <span class="string">"\t"</span>)</span><br><span class="line"> fmt.Println(<span class="keyword">string</span>(blockchain))</span><br><span class="line"></span><br><span class="line"> fmt.Println(<span class="string">"is BlockChain valid "</span>, bc.IsChainValid())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>GoLang</category>
      </categories>
      <tags>
        <tag>blockchain</tag>
        <tag>golang</tag>
        <tag>区块链</tag>
      </tags>
  </entry>
  <entry>
    <title>rust-lang环境安装</title>
    <url>/posts/396.html</url>
    <content><![CDATA[<p>一、安装Rust<br>1、如果你之前使用了一个有Windows下GUI安装向导的.msi文件安装了Rust，请到控制面板-&gt;程序与功能(添加/删除程序)里卸载。</p>
<p>2、设置安装路径。默认它会把Rust装到你的<del>/.rustup 里，依赖库下载到</del>/.cargo 里。需要修改的话，设置环境变量RUSTUP_HOME 和 CARGO_HOME 分别修改这两个值（例如D:.rustup和D:.cargo）。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">RUSTUP_HOME&#x3D;D:\.rustup</span><br><span class="line">CARGO_HOME&#x3D;D:\.cargo</span><br></pre></td></tr></table></figure>
<p>4、配置代理#1：国内有些地区访问Rustup的服务器不太顺畅，可以配置中科大的Rustup镜像：设置环境变量</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">RUSTUP_DIST_SERVER&#x3D;http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;rust-static</span><br><span class="line">RUSTUP_UPDATE_ROOT&#x3D;http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;rust-static&#x2F;rustup</span><br></pre></td></tr></table></figure>
<p>安装过程中出现以下选项<br>Proceed with installation (default)<br>Customize installation<br>Cancel installation<br>选（Customize installation）进行自定义安装 会一步一步问你<br>1）个问你是否用 default host tripe 我选的是 x86_64-pc-windows-gnu（<a href="https://github.com/rust-lang-nursery/rustup.rs/#other-installation-methods）" target="_blank" rel="noopener">https://github.com/rust-lang-nursery/rustup.rs/#other-installation-methods）</a> 下面有一大堆版本可以选。<br>假设你是Windows环境，打算编译64位程序，你应该用的是：</p>
<p>x86_64-pc-windows-msvc</p>
<p>或</p>
<p>x86_64-pc-windows-gnu</p>
<p>这两个各有优缺点：<br>x86_64-pc-windows-msvc是基于微软的链接器的，稳定性比较好，缺点是依赖的第三方库比较难弄，而且安装时你还需要再装一个微软的Visual C++ Build Tools(含Windows SDK；如果你机器上有Visual Studio就不用装Build Tools了)；到这里去下载 <a href="http://landinghub.visualstudio.com/visual-cpp-build-tools" target="_blank" rel="noopener">http://landinghub.visualstudio.com/visual-cpp-build-tools</a> ，装2015的。（2017的用起来会有点麻烦，Rust团队会在2017年8月解决。如果你看到这篇文章晚于那个时候了，装2017也可以）<br>x86_64-pc-windows-gnu是基于gnu开发工具的windows移植版本的，潜在的bug会多一些，但是第三方库反而容易弄(MSYS2的问题回头再说)<br>如果需要的话，可以两个都装的，这里你选一个版本就好。<br>2）个会问你 用哪个版本（stable/beta/nightly/none）我输入 stable<br>3）个会问你是否 默认修改环境变量 (这个无所谓了可以后期改) 我选是</p>
<p>5、在. cargo 文件夹根目录下创建一个 config 文件 没有任何文件后缀, 内容为:</p>
<p>[registry]<br>index = “<a href="https://mirrors.ustc.edu.cn/crates.io-index/&quot;" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/crates.io-index/&quot;</a><br>[source.crates-io]<br>registry = “<a href="https://github.com/rust-lang/crates.io-index&quot;" target="_blank" rel="noopener">https://github.com/rust-lang/crates.io-index&quot;</a><br>replace-with = ‘ustc’<br>[source.ustc]<br>registry = “<a href="https://mirrors.ustc.edu.cn/crates.io-index/&quot;" target="_blank" rel="noopener">https://mirrors.ustc.edu.cn/crates.io-index/&quot;</a></p>
<p>6、将 cargo 加入 path 环境变量:</p>
<p><code>%CARGO_HOME%\bin</code></p>
<p>前期工作就可以了 那么打开 cmd 输入<br>检查 rustup 有无安装成功</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rustup -v</span><br><span class="line">cargo -v</span><br></pre></td></tr></table></figure>
<p>二、安装工具链<br>因为RLS必须使用nightly版本，所以需要同时安装以下两个工具链</p>
<p>stable-x86_64-pc-windows-gnu<br>nightly-x86_64-pc-windows-gnu</p>
<p>三、安装相关工具</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cargo install rustfmt</span><br><span class="line">cargo install rustsym</span><br><span class="line">cargo install racer</span><br></pre></td></tr></table></figure>
<p>四、项目管理<br>Rust中一般使用cargo管理项目，比如：<br>创建项目</p>
<p><code>cargo new hellorust --bin</code></p>
<p>编译项目</p>
<p><code>cargo build --release</code></p>
<p>运行项目</p>
<p><code>cargo run --release</code></p>
<p>清理项目</p>
<p><code>cargo clean</code></p>
<p>五、给vscode安装rust插件<br>1、打开vscode，然后按CRTL+P打开面板，然后安装以下两个插件</p>
<p><code>ext install vscode-rust</code><br><code>ext install rust</code></p>
<p>然后按提示进行安装即可</p>
<p>2、vscode-rust安装过程中，提示如下错误（没有报错略过）<br>toolchain ‘nightly-x86_64-pc-windows-gnu’ does not contain component ‘rls’ for target ‘x86_64-pc-windows-gnu’<br>需要添加rustup的工具链如下，打开cmd工具输入以下命令</p>
<p>rustup component add rls-preview –toolchain nightly</p>
<p>3、设置vscode其中toolchain必须为nightly版本</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"rust.mode": "rls",</span><br><span class="line">"rust.rls": &#123;</span><br><span class="line">    "useRustfmt": true</span><br><span class="line">&#125;,</span><br><span class="line">"rust.rustup": &#123;</span><br><span class="line">    "toolchain": "nightly-x86_64-pc-windows-gnu",</span><br><span class="line">    "nightlyToolchain": "nightly-x86_64-pc-windows-gnu"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Rust-lang</category>
      </categories>
      <tags>
        <tag>rust</tag>
        <tag>rust-lang</tag>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>go build 常见编译优化</title>
    <url>/posts/393.html</url>
    <content><![CDATA[<p>一般情况下，go build 可以直接编译程序，无需额外的参数设定。<br>但在编译生产环境下使用的可执行程序时候，go build 的一些参数还是很有用的。</p>
<p>减小编译后可执行程序的大小</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go build -ldflags <span class="string">'-w -s'</span></span><br></pre></td></tr></table></figure>
<p>说明：<br>-w 禁止生成debug信息,注意使用该选项后，无法使用 gdb 进行调试<br>-s 禁用符号表<br>可以使用 go tool link –help 查看 ldflags 各参数含义</p>
<p>禁止gc优化和内联</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go build -gcflags <span class="string">'-N -l'</span></span><br></pre></td></tr></table></figure>
<p>说明:<br>-N 禁止编译优化<br>-l 禁止内联,禁止内联也可以一定程度上减小可执行程序大小<br>可以使用 go tool compile –help 查看 gcflags 各参数含义</p>
]]></content>
      <categories>
        <category>GoLang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>go</tag>
        <tag>build</tag>
      </tags>
  </entry>
  <entry>
    <title>Go Get安装一些第三方库-网络问题</title>
    <url>/posts/391.html</url>
    <content><![CDATA[<p>由于限制问题，国内使用 go get 安装 golang 官方包可能会失败，如我自己在安装golint时，出现了以下报错：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ go get -u -v golang.org/x/lint/golint</span><br><span class="line">Fetching https://golang.org/x/lint/golint?go-get=1</span><br><span class="line">https fetch failed: Get https://golang.org/x/lint/golint?go-get=1: dial tcp 216.239.37.1:443: connectex: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</span><br></pre></td></tr></table></figure>
<p>不翻墙的情况下怎么解决这个问题？其实 golang 在 github 上建立了一个镜像库，如 <a href="https://github.com/golang/lint" target="_blank" rel="noopener">https://github.com/golang/lint</a> 即是 <a href="https://golang.org/x/lint" target="_blank" rel="noopener">https://golang.org/x/lint</a> 的镜像库<br>获取 golang.org/x/lint 包，其实只需要以下步骤：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mkdir -p <span class="variable">$GOPATH</span>/src/golang.org/x</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/golang.org/x</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/golang/lint.git</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行go install</span></span><br><span class="line">go install golang.org/x/lint/golint</span><br></pre></td></tr></table></figure>
<p>ps<br>go get实际是从互联网上下载或更新指定的代码包及其依赖包，并对它们进行编译和安装。所以上面的步骤需要手动go install一下代码包。<br>go get常用的辅助参数。</p>
<p>-insecure 允许非安全下载，主要是针对没有HTTPS的HTTP路径。<br>-u 这个很常见，有更新的话会覆盖本地的package，默认不会覆盖的。<br>-v 显示Log，即verbose.<br>-t 同时下载需要运行测试的package.<br>-d 只下载，但不安装package.</p>
]]></content>
      <categories>
        <category>GoLang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>go</tag>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode for win10下安装phpcs</title>
    <url>/posts/378.html</url>
    <content><![CDATA[<ol>
<li><p>下载并安装 Visual Studio Code<br>微软官网：<a href="https://code.visualstudio.com/" target="_blank" rel="noopener">https://code.visualstudio.com/</a><br>插件库：<a href="https://marketplace.visualstudio.com/#VSCode" target="_blank" rel="noopener">https://marketplace.visualstudio.com/#VSCode</a></p>
</li>
<li><p>在Windows 10环境下安装PHP  </p>
</li>
<li><p>1 下载自己中意的PHP版本（我选的是php-7.2.0-Win32-VC15-x64）：<br>PHP官网：<a href="http://windows.php.net/download" target="_blank" rel="noopener">http://windows.php.net/download</a></p>
</li>
</ol>
<p>2.2 将php-7.2.0-Win32-VC15-x64.zip 解压到D盘根目录（注：也可以解压到C盘），并将php-7.2.0-Win32-VC15-x64文件夹重命名为php，最终php路径如下（注意这个很关键，会影响到后面PHP_CodeSniffer组件的安装）：</p>
<p><code>D:\php\</code></p>
<p>2.3 设置环境变量，允许执行PHP<br>打开高级系统设置（Win+R，然后输入sysdm.cpl打开即可进入，找到Path环境变量，把”D:\php”这个路径加到里面）</p>
<p>2.4 检查PHP环境是否正常（Win+R，然后输入CMD运行，然后执行php -h命令）如下</p>
<p><code>php -h</code></p>
<p>2.5 重命名 php.ini ，在php根目录会找到以下两个文件：<br>php.ini-development 开发测试用<br>php.ini-production 安全性高，适合线上</p>
<p>这里我选择将php.ini-production重命名为php.ini</p>
<ol start="3">
<li>安装pear库（您也可以另外用composer库，直接看第4步）  </li>
<li>1 下载<a href="http://pear.php.net/go-pear.phar" target="_blank" rel="noopener">http://pear.php.net/go-pear.phar</a>  </li>
<li>2 复制go-pear.phar文件到C:\php目录  </li>
<li>3 继续运行CMD然后确保已经cd到了C:\php&gt;，执行以下命令</li>
</ol>
<p><code>D:\php&gt;php go-pear.phar</code></p>
<p>遇到：<br>Are you installing a system-wide PEAR or a local copy?<br>(system|local) [system] :<br>输入local继续（什么都不输直接回车，那么表示默认选择system，但这可能存在权限问题而终止）<br>后面就是yes，Y，回车，一步步按提示进行下去。</p>
<p>3.4 检查php.ini里面已经配置好，结尾会看到：</p>
<p><code>include_path=&quot;.;D:\php\pear&quot;</code></p>
<p>（如果是PHP7可能默认已经做了路径指向，因此pear装完后不会有这句代码）</p>
<p>3.5 CMD里面执行pear，如果返回相应内容即表示pear安装成功：</p>
<ol start="4">
<li>安装PHPcs<br>以下是最关键一步，运行CMD，执行以下命令：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">D:\php&gt;pear install PHP_CodeSniffer</span><br><span class="line">WARNING: channel &quot;pear.php.net&quot; has updated its protocols, use &quot;pear channel-upd</span><br><span class="line">ate pear.php.net&quot; to update</span><br><span class="line">downloading PHP_CodeSniffer-2.0.0.tgz ...</span><br><span class="line">Starting to download PHP_CodeSniffer-2.0.0.tgz (448,559 bytes)</span><br><span class="line">................................................................................</span><br><span class="line">..........done: 448,559 bytes</span><br><span class="line">ERROR: failed to mkdir C:\php\pear\tests\PHP_CodeSniffer\CodeSniffer\Core\File</span><br></pre></td></tr></table></figure>
如果出现以下错误：<br>ERROR: failed to mkdir C:\php\pear\tests\PHP_CodeSniffer\CodeSniffer\Core\File</li>
</ol>
<p>需要设置如下配置，以管理员身份支行cmd分别输入以下命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">D:\php&gt;pear config-set php_dir D:\php\pear</span><br><span class="line">config-set succeeded</span><br><span class="line"></span><br><span class="line">D:\php&gt;pear config-set doc_dir D:\php\pear</span><br><span class="line">config-set succeeded</span><br><span class="line"></span><br><span class="line">D:\php&gt;pear config-set cfg_dir D:\php\pear</span><br><span class="line">config-set succeeded</span><br><span class="line"></span><br><span class="line">D:\php&gt;pear config-set data_dir D:\php\pear</span><br><span class="line">config-set succeeded</span><br><span class="line"></span><br><span class="line">D:\php&gt;pear config-set test_dir D:\php\pear</span><br><span class="line">config-set succeeded</span><br><span class="line"></span><br><span class="line">D:\php&gt;pear config-set www_dir D:\php\pear</span><br><span class="line">config-set succeeded</span><br><span class="line"></span><br><span class="line">D:\php&gt;pear install PHP_CodeSniffer</span><br><span class="line">WARNING: channel &quot;pear.php.net&quot; has updated its protocols, use &quot;pear channel-upd</span><br><span class="line">ate pear.php.net&quot; to update</span><br><span class="line">downloading PHP_CodeSniffer-2.0.0.tgz ...</span><br><span class="line">Starting to download PHP_CodeSniffer-2.0.0.tgz (448,559 bytes)</span><br><span class="line">.............................done: 448,559 bytes</span><br><span class="line">install ok: channel:&#x2F;&#x2F;pear.php.net&#x2F;PHP_CodeSniffer-2.0.0</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>安装PHP CodeSniffer for Visual Studio Code插件（英文介绍）  </li>
<li>1 打开 Visual Studio Code；  </li>
<li>2 在Windows下面按快捷键 Ctrl+P 或者 Mac下面 Cmd+P 来快捷打开对话框；  </li>
<li>3 键入 ext install phpcs 找到插件：  </li>
<li>4 直接回车或者点那个云图标来下载和安装此插件；  </li>
<li>5 重启 Visual Studio Code 就可以享用此强大IDE了。</li>
</ol>
]]></content>
      <categories>
        <category>开发工具</category>
      </categories>
      <tags>
        <tag>vscode</tag>
        <tag>win10</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx（openresty）升级ssl模块 以支持 HTTP/2</title>
    <url>/posts/375.html</url>
    <content><![CDATA[<p>我们并不需要升级系统自带的 openssl，因为随便升级 openssl 会带来安全风险。我们只下载 openssl 1.0.2 源码包，借助它来重新编译（相当于重新安装）服务器上的 NginX 即可。一旦成了 built with OpenSSL 1.0.2，就意味着能够支持 http/2 了。</p>
<p>1、下载并解压 OpenSSL</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.0.2-latest.tar.gz</span><br><span class="line">tar -zxf openssl-1.0.2-latest.tar.gz</span><br></pre></td></tr></table></figure>
<p>2、修改编译参数</p>
<p>#####指定opensll包位置<br><code>--with-openssl=/usr/local/src/openssl-1.0.2m</code></p>
<p>#####开启ssl模块<br><code>--with-http_ssl_module</code></p>
<p>#####开启http/2模块<br><code>--with-http_v2_module</code></p>
<p>#####编译报错是“collect2: ld returned 1 exit status”需要指定pcre8.36及以上版本<br><code>--with-pcre=/usr/local/src/pcre-8.40</code></p>
<p>3、开启ssl 修改配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、开启http/2 修改配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl http2;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>附：<br>pcre下载：<a href="ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/">ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/</a></p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>openresty</tag>
        <tag>ssl</tag>
        <tag>http/2</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS 安装(升级) OpenSSL</title>
    <url>/posts/373.html</url>
    <content><![CDATA[<p>CentOS 6.x（7.x） 的 OpenSSL 软件版本实在是低，2017 年了还在用人家 2013 年的版本，而且 1.0.1 版本对 ALPN 不支持，已经没法跟上大环境的节奏了<br>可以看一下默认自带的版本</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ openssl version</span><br><span class="line">OpenSSL 1.0.1e-fips 11 Feb 2013</span><br></pre></td></tr></table></figure>
<p>所以我们有必要升级 OpenSSL 到 1.0.2 版本<br>以下所有操作均需在 root 用户下进行<br>1、安装必要软件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install gcc gcc-c++ autoconf automake zlib zlib-devel pcre-devel</span><br></pre></td></tr></table></figure>
<p>2、下载并解压 OpenSSL</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.0.2-latest.tar.gz</span><br><span class="line">tar -zxf openssl-1.0.2-latest.tar.gz</span><br></pre></td></tr></table></figure>
<p>3、编译安装 OpenSSL</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> openssl-1.0.2*</span><br><span class="line">./config</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>4、移除旧版本 OpenSSL</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mv /usr/bin/openssl /tmp/</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/ssl/bin/openssl /usr/bin/openssl</span><br></pre></td></tr></table></figure>
<p>好了，大功告成，查看一下现在的版本</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ openssl version</span><br><span class="line">OpenSSL 1.0.2m  26 Jan 2017</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>openssl</tag>
      </tags>
  </entry>
  <entry>
    <title>一个git的使用错误unable to read askpass</title>
    <url>/posts/369.html</url>
    <content><![CDATA[<p>今天在git push origin master时，竟然出现了错误 (gnome-ssh-askpass:32737): Gtk-WARNING : cannot open display: error: unable to read askpass response from ‘/usr/libexec/openssh/gnome-ssh-askpass’根本原因是执行了该脚本</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ cat /etc/profile.d/gnome-ssh-askpass.sh</span><br><span class="line">SSH_ASKPASS=/usr/libexec/openssh/gnome-ssh-askpass</span><br></pre></td></tr></table></figure>
<p>解决方式</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">unset</span> SSH_ASKPASS</span><br></pre></td></tr></table></figure>
<p>再次执行git</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<p>不再提示错误。</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>centos一键安装最新内核并开启BBR脚本</title>
    <url>/posts/365.html</url>
    <content><![CDATA[<p>最近，Google 开源了其 TCP BBR 拥塞控制算法，并提交到了 Linux 内核，最新的 4.11 版内核已经用上了该算法。根据以往的传统，Google 总是先在自家的生产环境上线运用后，才会将代码开源，此次也不例外。<br>根据实地测试，在部署了最新版内核并开启了 TCP BBR 的机器上，网速甚至可以提升好几个数量级。<br>于是我根据目前三大发行版的最新内核，开发了一键安装最新内核并开启 TCP BBR 脚本。</p>
<p>本脚本适用环境</p>
<p>系统支持：CentOS 6+，Debian 7+，Ubuntu 12+<br>虚拟技术：OpenVZ 以外的，比如 KVM、Xen、VMware 等<br>内存要求：≥128M</p>
<p>一、关于BBR脚本</p>
<p>1、本脚本已在 Vultr 上的 VPS 全部测试通过。<br>2、当脚本检测到 VPS 的虚拟方式为 OpenVZ 时，会提示错误，并自动退出安装。<br>3、脚本运行完重启发现开不了机的，打开 VPS 后台控制面板的 VNC, 开机卡在 grub 引导, 手动选择内核即可。<br>4、由于是使用最新版系统内核，最好请勿在生产环境安装，以免产生不可预测之后果。</p>
<p>二、BBR脚本使用方法<br>使用root用户登录，运行以下命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh</span><br><span class="line">$ chmod +x bbr.sh</span><br><span class="line">$ ./bbr.sh</span><br></pre></td></tr></table></figure>
<p>安装完成后，脚本会提示需要重启 VPS，输入 y 并回车后重启。<br>重启完成后，进入 VPS，验证一下是否成功安装最新内核并开启 TCP BBR，输入以下命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ uname -r</span><br><span class="line">4.13.5-1.el6.elrepo.x86_64</span><br><span class="line"></span><br><span class="line">$ sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line">net.ipv4.tcp_available_congestion_control = bbr cubic reno</span><br><span class="line"></span><br><span class="line">$ sysctl net.ipv4.tcp_congestion_control</span><br><span class="line">net.ipv4.tcp_congestion_control = bbr</span><br><span class="line"></span><br><span class="line">$ sysctl net.core.default_qdisc</span><br><span class="line">net.core.default_qdisc = fq</span><br><span class="line"></span><br><span class="line">$ lsmod | grep bbr</span><br><span class="line">tcp_bbr                16384  10</span><br></pre></td></tr></table></figure>
<p>三、内核升级方法<br>如果是 CentOS 系统，执行如下命令即可升级内核：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">$ rpm -Uvh http://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpm</span><br><span class="line">$ yum --enablerepo=elrepo-kernel -y install kernel-ml kernel-ml-devel</span><br></pre></td></tr></table></figure>
<p>CentOS 6 的话，执行命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sed -i <span class="string">'s/^default=.*/default=0/g'</span> /boot/grub/grub.conf</span><br></pre></td></tr></table></figure>
<p>CentOS 7 的话，执行命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ grub2-set-default 0</span><br></pre></td></tr></table></figure>
<p>特别说明<br>1、如果你使用的是 Google Cloud Platform （GCP）更换内核，有时会遇到重启后，整个磁盘变为只读的情况。只需执行以下命令即可恢复：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ mount -o remount rw /</span><br></pre></td></tr></table></figure>
<p>2、如果你使用的是 Linode ，那么无需更换内核，只需修改配置即可开启 BBR：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sed -i <span class="string">'/net.core.default_qdisc/d'</span> /etc/sysctl.conf</span><br><span class="line">$ sed -i <span class="string">'/net.ipv4.tcp_congestion_control/d'</span> /etc/sysctl.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"net.core.default_qdisc = fq"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"net.ipv4.tcp_congestion_control = bbr"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">$ sysctl -p</span><br></pre></td></tr></table></figure>
<p>参考博文<br><a href="https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AFTCP-BBR%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95" target="_blank" rel="noopener">https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AFTCP-BBR%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95</a></p>
<p><a href="https://teddysun.com/489.html" target="_blank" rel="noopener">https://teddysun.com/489.html</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>bbr</tag>
      </tags>
  </entry>
  <entry>
    <title>linux下使用yum安装gcc的几点心得</title>
    <url>/posts/360.html</url>
    <content><![CDATA[<p>1、安装gcc和gcc-c++</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum -y install gcc</span><br><span class="line">$ yum -y install gcc-c++</span><br></pre></td></tr></table></figure>
<p>#或者</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum groupinstall <span class="string">"Development Tools"</span></span><br></pre></td></tr></table></figure>
<p>#或者</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install gcc gcc-c++ kernel-devel</span><br></pre></td></tr></table></figure>
<p>2、yum安装包时提示libstdc++版本冲突</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum downgrade libgomp</span><br><span class="line">$ yum downgrade libstdc++</span><br><span class="line">$ yum downgrade libgcc</span><br><span class="line">$ yum downgrade cpp</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>yum</tag>
        <tag>gcc</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下安装git</title>
    <url>/posts/353.html</url>
    <content><![CDATA[<p>git是当下比较流行的代码版本管理工具，开源并且免费使用。下面介绍一下安装过程。</p>
<p>1、下载安装包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget https://www.kernel.org/pub/software/scm/git/git-2.13.2.tar.gz</span><br></pre></td></tr></table></figure>
<p>2、卸载系统自带的git</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum remove git</span><br></pre></td></tr></table></figure>
<p>3、安装必要的依赖包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum -y install gcc perl-devel perl-CPAN tcl tk gettext gettext-devel zlib-devel curl-devel</span><br></pre></td></tr></table></figure>
<p>4、编译安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar -zxvf git-2.13.2.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> git-2.13.2</span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p>5、创建链接文件（默认情况下安装到/usr/local/bin/git）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ ln -s /usr/<span class="built_in">local</span>/bin/git /usr/bin/git</span><br><span class="line">$ git --version</span><br><span class="line">git version 2.13.2</span><br></pre></td></tr></table></figure>
<p>到此安装完成</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下安装lua-imagick插件实现图片缩放等处理</title>
    <url>/posts/344.html</url>
    <content><![CDATA[<p>lua-imagick基于imagemagick图片处理接口，使用lua语言实现的一个模块，以下是模块编译及依赖安装。<br>一、imagemagick安装（lua-imagick只支持6.9.x版本）<br>1、安装依赖包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum -y install libjpeg-devel freetype-devel</span><br></pre></td></tr></table></figure>
<p>2、下载安装包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget https://www.imagemagick.org/download/ImageMagick-6.9.8-6.zip</span><br></pre></td></tr></table></figure>
<p>3、编译安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ unzip ImageMagick-6.9.8-6.zip</span><br><span class="line">$ <span class="built_in">cd</span> ImageMagick-6.9.8-6</span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p>二、安装libluajit<br>1、下载安装包<br>推荐</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget -O luajit2-2.1-20200102.tar.gz https://github.com/openresty/luajit2/archive/v2.1-20200102.tar.gz</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget http://luajit.org/download/LuaJIT-2.0.4.tar.gz</span><br></pre></td></tr></table></figure>
<p>2、编译安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar zxvf LuaJIT-2.0.4.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> LuaJIT-2.0.4</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p>3、下面配置luajit的环境变量(nginx编译时才需要)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">export</span> LUAJIT_LIB=/usr/<span class="built_in">local</span>/lib</span><br><span class="line">$ <span class="built_in">export</span> LUAJIT_INC=/usr/<span class="built_in">local</span>/include/luajit-2.0</span><br></pre></td></tr></table></figure>
<p>三、lua-imagick模块安装<br>1、下载模块安装包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget -O lua-imagick.zip https://github.com/isage/lua-imagick/archive/master.zip</span><br></pre></td></tr></table></figure>
<p>2、编译安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ unzip lua-imagick.zip</span><br><span class="line">$ <span class="built_in">cd</span> lua-imagick-master</span><br><span class="line">$ <span class="built_in">cd</span> ./src</span><br><span class="line">$ cmake ..</span><br><span class="line">-bash: cmake: <span class="built_in">command</span> not found</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line">Scanning dependencies of target imagick</span><br><span class="line">[100%] Building C object CMakeFiles/imagick.dir/imagick.c.o</span><br><span class="line">Linking C shared module imagick.so</span><br><span class="line"></span><br><span class="line">$ make install</span><br><span class="line">[100%] Built target imagick</span><br><span class="line">Install the project...</span><br><span class="line">-- Install configuration: <span class="string">""</span></span><br><span class="line">-- Installing: /usr/<span class="built_in">local</span>/lib/lua/5.1/imagick.so</span><br><span class="line">-- Removed runtime path from <span class="string">"/usr/local/lib/lua/5.1/imagick.so"</span></span><br></pre></td></tr></table></figure>
<p>3、安装cmake工具（如果已经存在，请跳过）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install -y cmake</span><br></pre></td></tr></table></figure>
<p>完成</p>
]]></content>
      <categories>
        <category>LUA</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>LUA</tag>
        <tag>imagick</tag>
      </tags>
  </entry>
  <entry>
    <title>启动docker报错docker: relocation error:symbol dm_task_get_info_with_deferred_remove</title>
    <url>/posts/338.html</url>
    <content><![CDATA[<p>今天从公司一个闲置电脑上装个docker，不料安装没有那么顺利，启动docker有如下报错：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker -d</span><br><span class="line">WARN[0000] You are running linux kernel version 2.6.32-431.23.3.el6.x86_64, <span class="built_in">which</span> might be unstable running docker. Please upgrade your kernel to 3.10.0.</span><br><span class="line">INFO[0000] Listening <span class="keyword">for</span> HTTP on unix (/var/run/docker.sock)</span><br><span class="line">docker: relocation error: docker: symbol dm_task_get_info_with_deferred_remove, version Base not defined <span class="keyword">in</span> file libdevmapper.so.1.02 with link time reference</span><br></pre></td></tr></table></figure>
<p>其中警告了kernel升级，这个可以忽略，但还是建议升一下内核，最主要的问题是symbol dm_task_get_info_with_deferred_remove问题</p>
<p>网友提供的解决方案如下：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum -y  upgrade device-mapper-libs</span><br></pre></td></tr></table></figure>
<p>瞬间解决了。</p>
<p>ps 系统环境如下：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ cat /etc/issue</span><br><span class="line">CentOS release 6.5 (Final)</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line">$ uname -r</span><br><span class="line">2.6.32-431.23.3.el6.x86_64</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下安装sshd服务</title>
    <url>/posts/328.html</url>
    <content><![CDATA[<p>sshd是linux下远程管理的一个服务。<br>1、安装sshd</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install openssh-server -y</span><br></pre></td></tr></table></figure>
<p>2、修改配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ vi /etc/ssh/sshd_config</span><br><span class="line">PermitRootLogin yes</span><br><span class="line"><span class="comment"># 是否允许 root 登入！预设是允许的，但是建议设定成 no。</span></span><br><span class="line">UsePAM no</span><br><span class="line"><span class="comment"># 利用 PAM 管理使用者认证有很多好处，可以记录与管理。</span></span><br></pre></td></tr></table></figure>
<p>修改root密码</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure>
<p>重启sshd</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">service sshd start</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>sshd</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker 容器命令速查表</title>
    <url>/posts/323.html</url>
    <content><![CDATA[<p>1.查看容器日志<br>$ docker logs -ft &lt;容器名 or ID&gt;<br>-f 跟踪日志输出<br>-t 显示时间</p>
<p>2.查看容器<br>$ docker ps<br>查看正在运行的容器  </p>
<p>$ docker ps -a<br>查看所有容器</p>
<p>3.查看docker镜像列表<br>$ docker images</p>
<p>4.删除某个容器<br>$ docker rm &lt;容器名 or ID&gt;<br>-f 强制性删除<br>-v 删除与容器关联的卷</p>
<p>5.删除某个镜像<br>$ docker rmi ID<br>-f 强制性删除</p>
<p>6.停止、启动、杀死一个容器<br>$ docker stop &lt;容器名 or ID&gt;<br>$ docker start &lt;容器名 or ID&gt;<br>$ docker kill &lt;容器名 or ID&gt;</p>
<p>7.运行一个容器<br>$ docker run -it temp bash</p>
<p>8.一个容器连接到另一个容器<br>$ docker run -i -t –name sonar -d -link mmysql:db tpires/sonar-server sonar</p>
<p>9.拉取镜像<br>$ docker pull</p>
<p>10.把一台机器上的镜像迁移到另一台机器的时候，需要保存镜像与加载镜像<br>镜像转成文件：<br>$ docker save</p>
<blockquote>
<p>/home/save.tar</p>
</blockquote>
<p>使用scp将save.tar拷到机器b上，然后：<br>$ docker load &lt; /home/save.tar</p>
<p>把容器转成文件：<br>$ docker export &gt; /home/export.tar</p>
<p>使用scp将save.tar拷到机器b上，然后：<br>$ cat /home/export.tar | docker import - export:latest<br>注意：<br>一般情况下，save.tar比export.tar大一点点而已，export比较小，因为它丢失了历史和数据元metadata</p>
<p>11.构建自己的镜像<br>$ docker build -t &lt;镜像名&gt;<br>如Dockerfile在当前路径<br>$ docker build -t Diudiu/gitlab .</p>
<p>12.从Container中拷贝文件出来<br>$ docker cp 7bb0e258aefe:/var/www/laravel/.env .</p>
<p>13.查看docker 存储层的变化<br>$ docker diff &lt; 容器名 or ID &gt;</p>
<p>14.将容器的状态保存为镜像<br>$ docker commit &lt;容器名 or ID&gt;</p>
<p>15.查询可用镜像<br>$ docker search 镜像名称</p>
<p>16.查看一个镜像的历史记录<br>$ docker history ID</p>
<p>17.执行一个容器<br>$ docker exec -it 容器 bash</p>
<p>18.停止所有的container，这样才能够删除其中的images：<br>$ docker stop $(docker ps -a -q)</p>
<p>要kill所有正在运行的容器<br>docker kill $(docker ps -a -q)</p>
<p>要删除所有容器的话再加一个指令：<br>$ docker rm $(docker ps -a -q)</p>
<p>删除所有未打 dangling 标签的镜像<br>$ docker rmi $(docker images -q -f dangling=true)</p>
<p>19.查看当前有些什么images<br>$ docker images</p>
<p>20.删除images，通过image的id来指定删除谁<br>$ docker rmi</p>
<p>想要删除untagged images，也就是那些id为的image的话可以用<br>$ docker rmi $(docker images | grep “^” | awk “{print $3}”)</p>
<p>要删除全部image的话<br>$ docker rmi $(docker images -q)</p>
<p>直接删除带none的镜像<br>$ docker rmi $(docker images | grep “none” | awk ‘{print $3}’)</p>
<p>21.登录镜像仓库<br>$ docker login -u [你的仓库帐号] -p [你的仓库密码] -e Email 仓库地址<br>Login Succeded</p>
<p>22.标记本地镜像<br>$ docker tag [镜像名或ID] 仓库地址/[你的用户名]/[标签名]</p>
<p>23.推送至镜像仓库<br>$ docker push 仓库地址/[你的用户名]/[标签名]</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker常用命令及用法整理</title>
    <url>/posts/321.html</url>
    <content><![CDATA[<p><strong>一、docker配置文件</strong><br>docker启动的配置参数文件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ vim /etc/sysconfig/docker</span><br><span class="line">other_args=<span class="string">""</span></span><br></pre></td></tr></table></figure>
<p><strong>二、docker参数说明</strong><br>1、指定docker镜像和容器存储路径</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">--graph=/data/docker</span><br></pre></td></tr></table></figure>
<p>2、指定默认的系统ulimit值  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">--default-ulimit nproc=65535</span><br></pre></td></tr></table></figure>
<p><strong>三、docker命令说明</strong>  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker search centos  <span class="comment">#搜索</span></span><br><span class="line">docker pull daocloud.io/centos:6 <span class="comment">#下载，这里使用daocloud提供的centOs6的镜像，系统版本是6.8</span></span><br><span class="line">docker images <span class="comment">#查看，下载好就会出现在镜像列表里</span></span><br><span class="line">docker run -it -p 22:22 <span class="comment">#运行</span></span><br><span class="line">docker run -it daocloud.io/centos:6 /bin/bash  </span><br><span class="line">-i <span class="comment">#允许我们对容器内的STDIN进行交互  </span></span><br><span class="line">-t <span class="comment">#在新容器内指定一个伪终端或终端  </span></span><br><span class="line">-d <span class="comment">#是后台运行，特别注意，后台运行而不是守护方式运行  </span></span><br><span class="line">--name <span class="comment">#指定容器的名称，可用于管理  </span></span><br><span class="line">-P <span class="comment">#大写，将所有公开的端口随机与宿主主机的端口进行绑定  </span></span><br><span class="line">-p <span class="comment">#小写，将宿主机的端口和容器的端口进行绑定。例如：将容器的22端口绑定到宿主机的10022端口上-p 10022:22，也可以同时指定IP绑定-p 127.0.0.1:10022:22  </span></span><br><span class="line">-v <span class="comment">#指定该容器挂载宿主机的目录，这样可以通过该目录来实现宿主主机与容器之间数据共享</span></span><br><span class="line"></span><br><span class="line">docker <span class="built_in">exec</span> -it 容器ID /bin/bash <span class="comment">#执行</span></span><br><span class="line"></span><br><span class="line">docker ps -l <span class="comment">#列出最近一次启动的，且正在运行的container  </span></span><br><span class="line">docker ps -a <span class="comment">#列出所有的container  </span></span><br><span class="line">docker commit -m <span class="string">"备注"</span> 容器id 镜像名:tag版本 <span class="comment">#执行完就生成了带sshd的镜像了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意：先删容器再删镜像  </span></span><br><span class="line">docker rm 容器id <span class="comment">#删除单个容器  </span></span><br><span class="line">docker rmi 镜像id <span class="comment">#删除单个镜像  </span></span><br><span class="line">docker rm `docker ps -a -q` <span class="comment">#删除所有容器  </span></span><br><span class="line">docker rm 容器id <span class="comment">#删除容器id为CONTAINER_ID的容器</span></span><br><span class="line"></span><br><span class="line">docker images <span class="comment">#查看本地镜像  </span></span><br><span class="line">docker attach 容器id <span class="comment">#启动一个已存在的docker实例  </span></span><br><span class="line">docker stop 容器id <span class="comment">#停止docker实例（或者直接退出容器登陆；不然这个命令执行后也会强制退出容器的登陆）  </span></span><br><span class="line">docker logs 容器id <span class="comment">#查看docker实例运行日志，确保正常运行  </span></span><br><span class="line">docker inspect 容器id <span class="comment">#查看container的实例属性，比如ip等等</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos6.8下mysql启动时出现mysqld_safe line 707 ulimit open files cannot modify limit Operation not permitted错误</title>
    <url>/posts/319.html</url>
    <content><![CDATA[<p>mysql启动时出现mysqld_safe: line 707: ulimit: open files: cannot modify limit: Operation not permitted错误<br>解决方法：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br></pre></td></tr></table></figure>
<p>普通用户ssh连接linux服务器是总是提示：  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ulimit</span>: open files: cannot modify <span class="built_in">limit</span>: Operation not permitted</span><br></pre></td></tr></table></figure>
<p>解决方法：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ vi /etc/security/limits.conf</span><br><span class="line"><span class="comment"># End of file</span></span><br><span class="line"><span class="comment">#添加以下内容：</span></span><br><span class="line">root soft nofile 65535</span><br><span class="line">root hard nofile 65535</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">#优化内核时：</span></span><br><span class="line">* soft nproc 65535</span><br><span class="line">* hard nproc 65535</span><br></pre></td></tr></table></figure>
<p>重启系统</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>ulimit</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos6.8下出现bash: scp: command not found lost connection问题解决</title>
    <url>/posts/316.html</url>
    <content><![CDATA[<p>在内网，从一台服务器传mysql的源码安装包到另外一台服务器时，发生如下的错误：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ scp mysql-5.1.55.tar.gz root@192.168.3.22:.</span><br><span class="line">root@192.168.3.22<span class="string">'s password:</span></span><br><span class="line"><span class="string">bash: scp: command not found</span></span><br><span class="line"><span class="string">lost connection</span></span><br></pre></td></tr></table></figure>
<p>提示scp的命令找不到，但是查找发现命令是存在的</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ whereis scp</span><br><span class="line">scp: /usr/bin/scp /usr/share/man/man1/scp.1.gz</span><br></pre></td></tr></table></figure>
<p>如果本地都没有问题，那是另一端服务器上没有安装scp的命令？</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ whereis scp</span><br><span class="line">scp:</span><br></pre></td></tr></table></figure>

<p>果真是如此，所以是server端没有找到scp的命令，而不是本地<br>安装上scp的依赖包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install openssh-clients</span><br></pre></td></tr></table></figure>
<p>安装好之后，重新传输文件OK。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>scp</tag>
      </tags>
  </entry>
  <entry>
    <title>安装mysql5.7社区版二进制软件包出现 error while loading shared libraries: libaio.so.1:</title>
    <url>/posts/314.html</url>
    <content><![CDATA[<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/mysql/bin/mysql_install_db --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/usr/<span class="built_in">local</span>/mysql/data --user=mysql</span><br></pre></td></tr></table></figure>
<p>在安装二进制mysql的软件包时（版本mysql5.7社区版），初始化中出现 error while loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory的错误：</p>
<p>解决方法：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install -y libaio  <span class="comment">#安装后在初始化就OK了</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>libaio</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS下yum安装mcrypt错误：No package php-mcrypt available.解决方法</title>
    <url>/posts/311.html</url>
    <content><![CDATA[<p>错误描述</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install libmcrypt libmcrypt-devel</span><br><span class="line">Setting up Install Process</span><br><span class="line">No package libmcrypt-devel available.</span><br><span class="line">Error: Nothing to <span class="keyword">do</span></span><br></pre></td></tr></table></figure>
<p>我们会看到centos yum从仓库中根本找不到这几个包。但我不想使用源码编译就想使用yum安装，怎么办？</p>
<p>解决方法：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install epel-release  <span class="comment">#扩展包更新包</span></span><br><span class="line">$ yum update <span class="comment">#更新yum源</span></span><br><span class="line">$ yum install libmcrypt libmcrypt-devel <span class="comment">#就ok了</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>libmcrypt</tag>
      </tags>
  </entry>
  <entry>
    <title>设置centos的YUM源为国内阿里云源</title>
    <url>/posts/308.html</url>
    <content><![CDATA[<p><strong>1、备份</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure>
<p><strong>2、下载新的CentOS-Base.repo 到/etc/yum.repos.d/</strong><br>CentOS 5</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo</span><br></pre></td></tr></table></figure>
<p>CentOS 6</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br></pre></td></tr></table></figure>
<p>CentOS 7</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure>
<p><strong>3、之后运行yum makecache生成缓存</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum clean all</span><br><span class="line">$ yum makecache</span><br></pre></td></tr></table></figure>
<p>完成</p>
<p>ps:<br>1、同步频率为每天一次，每天凌晨2：00-4：00为镜像的同步时间<br>2、若使用阿里云服务器，将源的域名从mirrors.aliyun.com改为mirrors.aliyuncs.com,不占用公网流量。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>yum</tag>
        <tag>aliyun</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker升级至1.9.1版本-Centos6.8</title>
    <url>/posts/305.html</url>
    <content><![CDATA[<p>官方建议使用centos7部署docker1.9.1。<br>目前，很多系统仍为centos6.8，本文用于测试将centos6.8升级至1.9.1.</p>
<p><strong>查看系统版本</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ more /etc/issue</span><br><span class="line">CentOS release 6.8 (Final)</span><br><span class="line">Kernel \r on an \m</span><br></pre></td></tr></table></figure>
<p><strong>查看内核版本</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ uname -r</span><br><span class="line">2.6.32-573.22.1.el6.x86_64</span><br></pre></td></tr></table></figure>
<p><strong>升级内核至3.10</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">$ <span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">$ rpm -ivh http://www.elrepo.org/elrepo-release-6-5.el6.elrepo.noarch.rpm</span><br><span class="line">$ yum --enablerepo=elrepo-kernel install kernel<span class="_">-lt</span> -y</span><br></pre></td></tr></table></figure>
<p>升级完毕，修改grup并进行重启。</p>
<p><strong>修改grub.conf文件default值为0</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ vim /etc/grub.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># grub.conf generated by anaconda</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that you do not have to rerun grub after making changes to this file</span></span><br><span class="line"><span class="comment"># NOTICE:  You do not have a /boot partition.  This means that</span></span><br><span class="line"><span class="comment">#          all kernel and initrd paths are relative to /, eg.</span></span><br><span class="line"><span class="comment">#          root (hd0,0)</span></span><br><span class="line"><span class="comment">#          kernel /boot/vmlinuz-version ro root=/dev/vda1</span></span><br><span class="line"><span class="comment">#          initrd /boot/initrd-[generic-]version.img</span></span><br><span class="line"><span class="comment">#boot=/dev/vda</span></span><br><span class="line">default=0</span><br><span class="line">timeout=5</span><br><span class="line">splashimage=(hd0,0)/boot/grub/splash.xpm.gz</span><br><span class="line">hiddenmenu</span><br><span class="line">title CentOS (3.10.105-1.el6.elrepo.x86_64)</span><br><span class="line">        root (hd0,0)</span><br><span class="line">        kernel /boot/vmlinuz-3.10.105-1.el6.elrepo.x86_64 ro root=UUID=55d851da-601d-440a-b119-4fcd9cde4d02 rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet</span><br><span class="line">        initrd /boot/initramfs-3.10.105-1.el6.elrepo.x86_64.img</span><br><span class="line">title CentOS (2.6.32-642.6.2.el6.x86_64)</span><br><span class="line">        root (hd0,0)</span><br><span class="line">        kernel /boot/vmlinuz-2.6.32-642.6.2.el6.x86_64 ro root=UUID=55d851da-601d-440a-b119-4fcd9cde4d02 rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet</span><br><span class="line">        initrd /boot/initramfs-2.6.32-642.6.2.el6.x86_64.img</span><br></pre></td></tr></table></figure>
<p><strong>重启系统</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ reboot</span><br></pre></td></tr></table></figure>
<p><strong>重启后查看版本</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ uname -r</span><br><span class="line">3.10.105-1.el6.elrepo.x86_64</span><br></pre></td></tr></table></figure>
<p><strong>安装docker 1.9.1</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ curl -sSL -O https://get.docker.com/builds/Linux/x86_64/docker-1.9.1 &amp;&amp; chmod +x docker-1.9.1 &amp;&amp; mv docker-1.9.1 /usr/<span class="built_in">local</span>/bin/docker</span><br><span class="line">$ cp /usr/<span class="built_in">local</span>/bin/docker /usr/bin/docker</span><br><span class="line">$ service docker start</span><br></pre></td></tr></table></figure>
<p><strong>重启后验证</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      1.9.1</span><br><span class="line"> API version:  1.21</span><br><span class="line"> Go version:   go1.4.3</span><br><span class="line"> Git commit:   a34a1d5</span><br><span class="line"> Built:        Fri Nov 20 17:56:04 UTC 2015</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      1.9.1</span><br><span class="line"> API version:  1.21</span><br><span class="line"> Go version:   go1.4.3</span><br><span class="line"> Git commit:   a34a1d5</span><br><span class="line"> Built:        Fri Nov 20 17:56:04 UTC 2015</span><br><span class="line"> OS/Arch:      linux/amd64</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>docker1.9.1</tag>
      </tags>
  </entry>
  <entry>
    <title>centos 6.8下安装docker1.7.1</title>
    <url>/posts/299.html</url>
    <content><![CDATA[<p><a href="https://www.docker.com/" target="_blank" rel="noopener">Docker</a>是一个能够把开发应用程序自动部署到容器的开源引擎。它由Docker公司的团队编写，基于Apache 2.0开源协议授权。它提供了一个简单、轻量的建模方式，使开发生命周期更高效快速，鼓励了面向服务的架构设计。</p>
<p><strong>前提条件</strong></p>
<p><strong>内核</strong></p>
<p>Docker运行对内核要求比较高，因此一般建议直接在Ubuntu这样的平台运行。但作为一个容器标准，Docker也是支持其他如CentOS, Mac OS X, Windows等平台。目前Docker支持以下版本CentOS:</p>
<p><em>CentOS 7(64位)</em><br><em>CentOS 6.5(64位)及以后</em></p>
<p>在运行CentOS 6.5及以后版本时，需要内核版本&gt;=2.6.32-431，因为这些内核包含了运行Docker的一些特定修改。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ uname -r</span><br><span class="line">2.6.32-573.22.1.el6.x86_64</span><br></pre></td></tr></table></figure>
<p><strong>Device Mapper</strong></p>
<p>Docker默认使用AUFS作为存储驱动，但是AUFS并没有被包括在Linux的主线内核中。CentOS中可以使用Device Mapper作为存储驱动，这是在2.6.9内核版本引入的新功能。我们需要先确认是否启用该功能:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ ls -l /sys/class/misc/device-mapper</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar 11 17:06 /sys/class/misc/device-mapper -&gt; ../../devices/virtual/misc/device-mapper</span><br></pre></td></tr></table></figure>
<p>如果没有检测到Device Mapper，需要安装device-mapper软件包:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install -y device-mapper</span><br></pre></td></tr></table></figure>
<p>然后重新加载dm_mod内核模块:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ modprobe dm_mod</span><br></pre></td></tr></table></figure>
<p><strong>第一步 Enable EPEL</strong></p>
<p>对于CentOS6.8, Docker可以在EPEL源里面找到，所以我们首先需要确保启用EPEL。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum -y install epel-release-6-8.noarch</span><br></pre></td></tr></table></figure>
<p><strong>第二步 Install Docker-IO</strong></p>
<p>最后需要安装docker-io的RPM包。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum -y install docker-io</span><br></pre></td></tr></table></figure>
<p>这样完成了Docker的安装。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker -v</span><br><span class="line">Docker version 1.7.1, build 786b29d/1.7.1</span><br></pre></td></tr></table></figure>
<p><strong>启动</strong></p>
<p><strong>第一步 启动服务</strong></p>
<p>一旦安装好Docker之后，我们需要启动Docker Deamon:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ service docker start</span><br></pre></td></tr></table></figure>
<p><strong>第二步 设置开机启动(可选)</strong></p>
<p>如果希望Docker Deamon开机运行，还需要做如下操作:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ chkconfig docker on</span><br></pre></td></tr></table></figure>
<p><strong>验证</strong></p>
<p><strong>验证Docker Deamon</strong></p>
<p>启动服务后，直接用docker info命令确认docker是否正确安装并运行:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker info</span><br><span class="line">Containers: 1</span><br><span class="line">Images: 4</span><br><span class="line">Storage Driver: devicemapper</span><br><span class="line"> Pool Name: docker-202:1-1835598-pool</span><br><span class="line"> Pool Blocksize: 65.54 kB</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Data file: /dev/loop0</span><br><span class="line"> Metadata file: /dev/loop1</span><br><span class="line"> Data Space Used: 541.8 MB</span><br><span class="line"> Data Space Total: 107.4 GB</span><br><span class="line"> Data Space Available: 28.89 GB</span><br><span class="line"> Metadata Space Used: 983 kB</span><br><span class="line"> Metadata Space Total: 2.147 GB</span><br><span class="line"> Metadata Space Available: 2.147 GB</span><br><span class="line"> Udev Sync Supported: <span class="literal">true</span></span><br><span class="line"> Deferred Removal Enabled: <span class="literal">false</span></span><br><span class="line"> Data loop file: /var/lib/docker/devicemapper/devicemapper/data</span><br><span class="line"> Metadata loop file: /var/lib/docker/devicemapper/devicemapper/metadata</span><br><span class="line"> Library Version: 1.02.117-RHEL6 (2016-08-15)</span><br><span class="line">Execution Driver: native-0.2</span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Kernel Version: 2.6.32-573.22.1.el6.x86_64</span><br><span class="line">Operating System: &lt;unknown&gt;</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 994.6 MiB</span><br><span class="line">Name: iZ23l4s2070Z</span><br><span class="line">ID: CGIV:KQ7V:LP5I:NF5V:ZMKG:4AK3:RMDZ:QLVL:BY6F:GQF3:V7E5:TDCA</span><br></pre></td></tr></table></figure>
<p><strong>验证Docker Client</strong></p>
<p>现在就让我们验证下Docker是否能正常运行，首先我们来获取centos6.8的镜像:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker pull daocloud.io/centos:6</span><br></pre></td></tr></table></figure>
<p>这里使用的是DaoCloud源，因为官方源在国内不稳定。国内其它源地址：1、<a href="https://c.163.com/hub" target="_blank" rel="noopener">https://c.163.com/hub</a> 2、<a href="http://hub.daocloud.io" target="_blank" rel="noopener">http://hub.daocloud.io</a>，但要求Docker版本&gt;=1.3.2。然后我们检查是否能看到镜像:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker images</span><br><span class="line">REPOSITORY           TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">daocloud.io/centos   6                   10611b26a8b9        4 months ago        194.6 MB</span><br></pre></td></tr></table></figure>
<p>激动的时刻到了，让我们运行一下:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ docker run -i -t daocloud.io/centos /bin/bash</span><br></pre></td></tr></table></figure>
<p>一切正常的话，你会看到一个终端提示符，然后你就可以像操作任何CentOS机器一样进行你的体验。</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>centos6.8</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS6 安装vsftpd</title>
    <url>/posts/290.html</url>
    <content><![CDATA[<p>CentOS配置vsftp服务器，特殊情况下方便快速管理文件。<br>1、安装vsftpd</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum -y install vsftpd</span><br></pre></td></tr></table></figure>
<p>2、配置vsftpd.conf文件（修改下面中文部分内容）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vi /etc/vsftpd/vsftpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example config file /etc/vsftpd/vsftpd.conf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The default compiled in settings are fairly paranoid. This sample file</span></span><br><span class="line"><span class="comment"># loosens things up a bit, to make the ftp daemon more usable.</span></span><br><span class="line"><span class="comment"># Please see vsftpd.conf.5 for all compiled in defaults.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</span></span><br><span class="line"><span class="comment"># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd's</span></span><br><span class="line"><span class="comment"># capabilities.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Allow anonymous FTP? (Beware - allowed by default if you comment this out).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否允许匿名登录（将其禁止）</span></span><br><span class="line"><span class="comment">#anonymous_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 允许使用本地帐户进行FTP用户登录验证</span></span><br><span class="line"><span class="comment"># Uncomment this to allow local users to log in.</span></span><br><span class="line">local_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Uncomment this to enable any form of FTP write command.</span></span><br><span class="line">write_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default umask for local users is 077. You may wish to change this to 022,</span></span><br><span class="line"><span class="comment"># if your users expect that (022 is used by most other ftpd's)</span></span><br><span class="line">local_umask=022</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Uncomment this to allow the anonymous FTP user to upload files. This only</span></span><br><span class="line"><span class="comment"># has an effect if the above global write enable is activated. Also, you will</span></span><br><span class="line"><span class="comment"># obviously need to create a directory writable by the FTP user.</span></span><br><span class="line"><span class="comment">#anon_upload_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Uncomment this if you want the anonymous FTP user to be able to create</span></span><br><span class="line"><span class="comment"># new directories.</span></span><br><span class="line"><span class="comment">#anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Activate directory messages - messages given to remote users when they</span></span><br><span class="line"><span class="comment"># go into a certain directory.</span></span><br><span class="line">dirmessage_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The target log file can be vsftpd_log_file or xferlog_file.</span></span><br><span class="line"><span class="comment"># This depends on setting xferlog_std_format parameter</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Make sure PORT transfer connections originate from port 20 (ftp-data).</span></span><br><span class="line">connect_from_port_20=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you want, you can arrange for uploaded anonymous files to be owned by</span></span><br><span class="line"><span class="comment"># a different user. Note! Using "root" for uploaded files is not</span></span><br><span class="line"><span class="comment"># recommended!</span></span><br><span class="line"><span class="comment">#chown_uploads=YES</span></span><br><span class="line"><span class="comment">#chown_username=whoever</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The name of log file when xferlog_enable=YES and xferlog_std_format=YES</span></span><br><span class="line"><span class="comment"># WARNING - changing this filename affects /etc/logrotate.d/vsftpd.log</span></span><br><span class="line"><span class="comment">#xferlog_file=/var/log/xferlog</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Switches between logging into vsftpd_log_file and xferlog_file files.</span></span><br><span class="line"><span class="comment"># NO writes to vsftpd_log_file, YES to xferlog_file</span></span><br><span class="line">xferlog_std_format=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may change the default value for timing out an idle session.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置连接超时时间（单位秒）</span></span><br><span class="line">idle_session_timeout=600</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may change the default value for timing out a data connection.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据传输超时时间（单位秒）</span></span><br><span class="line">data_connection_timeout=120</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is recommended that you define on your system a unique user which the</span></span><br><span class="line"><span class="comment"># ftp server can use as a totally isolated and unprivileged user.</span></span><br><span class="line"><span class="comment">#nopriv_user=ftpsecure</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Enable this and the server will recognise asynchronous ABOR requests. Not</span></span><br><span class="line"><span class="comment"># recommended for security (the code is non-trivial). Not enabling it,</span></span><br><span class="line"><span class="comment"># however, may confuse older FTP clients.</span></span><br><span class="line"><span class="comment">#async_abor_enable=YES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default the server will pretend to allow ASCII mode but in fact ignore</span></span><br><span class="line"><span class="comment"># the request. Turn on the below options to have the server actually do ASCII</span></span><br><span class="line"><span class="comment"># mangling on files when in ASCII mode.</span></span><br><span class="line"><span class="comment"># Beware that on some FTP servers, ASCII support allows a denial of service</span></span><br><span class="line"><span class="comment"># attack (DoS) via the command "SIZE /big/file" in ASCII mode. vsftpd</span></span><br><span class="line"><span class="comment"># predicted this attack and has always been safe, reporting the size of the</span></span><br><span class="line"><span class="comment"># raw file.</span></span><br><span class="line"><span class="comment"># ASCII mangling is a horrible feature of the protocol.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否允许上传/下载二进制文件</span></span><br><span class="line">ascii_upload_enable=YES</span><br><span class="line">ascii_download_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may fully customise the login banner string:</span></span><br><span class="line"><span class="comment">#ftpd_banner=Welcome to blah FTP service.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may specify a file of disallowed anonymous e-mail addresses. Apparently</span></span><br><span class="line"><span class="comment"># useful for combatting certain DoS attacks.</span></span><br><span class="line"><span class="comment">#deny_email_enable=YES</span></span><br><span class="line"><span class="comment"># (default follows)</span></span><br><span class="line"><span class="comment">#banned_email_file=/etc/vsftpd/banned_emails</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may specify an explicit list of local users to chroot() to their home</span></span><br><span class="line"><span class="comment"># directory. If chroot_local_user is YES, then this list becomes a list of</span></span><br><span class="line"><span class="comment"># users to NOT chroot().</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制所有的本地用户只能访问自己的目录</span></span><br><span class="line">chroot_local_user=YES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当chroot_list_enable=YES，chroot_local_user=YES时，在/etc/vsftpd/chroot_list文件中列出的用户，可以切换到其他目录；未在文件中列出的用户，不能切换到其他目录。</span></span><br><span class="line"><span class="comment">#chroot_list_enable=YES</span></span><br><span class="line"><span class="comment"># (default follows)</span></span><br><span class="line"><span class="comment">#chroot_list_file=/etc/vsftpd/chroot_list</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You may activate the "-R" option to the builtin ls. This is disabled by</span></span><br><span class="line"><span class="comment"># default to avoid remote users being able to cause excessive I/O on large</span></span><br><span class="line"><span class="comment"># sites. However, some broken FTP clients such as "ncftp" and "mirror" assume</span></span><br><span class="line"><span class="comment"># the presence of the "-R" option, so there is a strong case for enabling it.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否允许使用ls -R等命令</span></span><br><span class="line">ls_recurse_enable=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># When "listen" directive is enabled, vsftpd runs in standalone mode and</span></span><br><span class="line"><span class="comment"># listens on IPv4 sockets. This directive cannot be used in conjunction</span></span><br><span class="line"><span class="comment"># with the listen_ipv6 directive.</span></span><br><span class="line">listen=YES</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This directive enables listening on IPv6 sockets. To listen on IPv4 and IPv6</span></span><br><span class="line"><span class="comment"># sockets, you must run two copies of vsftpd with two configuration files.</span></span><br><span class="line"><span class="comment"># Make sure, that one of the listen options is commented !!</span></span><br><span class="line"><span class="comment">#listen_ipv6=YES</span></span><br><span class="line"></span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">userlist_enable=YES</span><br><span class="line">userlist_file=/etc/vsftpd/user_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># [新增]是否只允许userlist_file文件中的用户登录FTP服务器，userlist_enable为YES才生效</span></span><br><span class="line"><span class="comment"># YES，默认值，禁止文件中的用户登录，同时也不向这些用户发出输入密码的提示。NO，只允许在文件中的用户登录FTP服务器</span></span><br><span class="line">userlist_deny=NO</span><br><span class="line">tcp_wrappers=YES</span><br><span class="line"></span><br><span class="line"><span class="comment"># [新增]所有用户的根目录（对匿名用户无效，不设置时，默认为用户的家目录/home/ftpuser）</span></span><br><span class="line">local_root=/data</span><br></pre></td></tr></table></figure>
<p>3、新增ftp用户并为其设置密码</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">useradd -d /home/ftpuser -s /sbin/nologin ftpuser</span><br><span class="line">passwd ftpuser</span><br></pre></td></tr></table></figure>
<p>4、编辑user_list文件，给予ftpuser用户访问ftp权限</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim /etc/vsftpd/user_list</span><br></pre></td></tr></table></figure>

<p>在文件末尾加入ftpuser并保存</p>
<p>5、建立可访问目录并指定用户</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mkdir -p /data</span><br><span class="line">chown -R ftpuser /data/      <span class="comment">#注意后面有个/</span></span><br><span class="line">chmod -R 755 /data</span><br></pre></td></tr></table></figure>
<p>6、启动vsftpd服务</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">service vsftpd start</span><br></pre></td></tr></table></figure>
<p>7、开机启动vsftpd服务</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chkconfig vsftpd on</span><br></pre></td></tr></table></figure>
<p>至此完毕</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>vsftp</tag>
      </tags>
  </entry>
  <entry>
    <title>M3U8解析</title>
    <url>/posts/173.html</url>
    <content><![CDATA[<p>3.2 HLS标签说明</p>
<p>3.2.1 EXT-X-TARGETDURATION</p>
<p>该标签指定了媒体文件持续时间的最大值，播放文件列表中的媒体文件在EXTINF标签中定义的持续时间必须小于或者等于该标签指定的持续时间。该标签在播放列表文件中必须出现一次，其格式为：</p>
<p><code># EXT-X-TARGETDURATION：&lt;s&gt;</code>  s是一个以秒为单位的整数。</p>
<p>3.2.2 EXT-X-MEDIA-SEQUENCE</p>
<p>播放列表文件中每个媒体文件的URI都有一个唯一的序列号。URI的序列号等于它之前那个RUI的序列号加一。EXT-X-MEDIA-SEQUENCE指明了出现在播放列表文件中的第一个URI的序列号。其格式如下：</p>
<p><code>#EXT-X-MEDIA-SEQUENCE：&lt;Number&gt;</code>  播放列表文件中的EXT-X-MEDIA-SEQUENCE标签不能多于一个。如果播放列表文件中没有EXT-X-MEDIA-SEQUENCE标签，那么将会把播放列表中第一个URI的序列号当成0。</p>
<p><strong>注：</strong>媒体文件的序列号码不是必须出现在它的URI中的。见6.3.2和6.3.5。</p>
<p>3.2.3 EXT-X-KEY</p>
<p>媒体文件可能是被加密的，EXT-X-KEY提供了解密媒体文件的必要信息，它的格式如下：</p>
<p><code>#EXT-X-KEY：METHOD=&lt;method&gt; [,URI = &quot;&lt;uri&gt;&quot;] [,IV = &lt;iv&gt;]</code></p>
<p>Method属性指定了加密方法，定义了两种加密方法：NONE和AES-128。<br>加密方法NONE表示媒体文件不被加密，如果加密方法是NONE，那么URI和IV属性不允许存在。<br>加密方法AES-128表示媒体文件使用高级加密标准128位密钥和PKCS7 padding加密。如果加密方法是AES-128，那么对于URI属性，如果存在，则指定获取密钥的方法；对于IV属性，如果存在，则指定使用密钥的初始化向量。<br>IV属性出现在协议版本2中，新的EXT-X-KEY将会取代任何一个先前的EXT-X-KEY。<br>如果播放列表文件没有包含EXT-X-KEY标签，那么媒体文件将不会被加密。</p>
<p>密钥文件的格式见第五章，媒体文件加密信息见5.2、6.2.3、6.3.6。</p>
<p>3.2.4 EXT-X-PROGRAM-DATE-TIME</p>
<p>EXT-X-PROGRAM-DATE-TIME标签将下一个媒体文件的开头和绝对日期关联起来。日期/时间的表示基于ISO/IEC，并且要指明时区。例如：<br><code>#EXT-X-PROGRAM-DATE-TIME:&lt;YYYY–MM–DDThh:mm:ssZ&gt;</code></p>
<p>详见6.2.1和6.3.3</p>
<p>3.2.5 EXT-X-ALLOW-CATCH</p>
<p>EXT-X-ALLOW-CATCH标签指定客户端可以或者不准缓存下载的媒体文件用来重播。它可能会出现在播放列表文件的任何地方，但是不能出现两次或以上。该标签适用于播放列表中的所有分片。其格式如下：<br><code>#EXT-X-ALLOW-CACHE:&lt;YES|NO&gt;</code></p>
<p>详见6.3.3</p>
<p>3.2.6 EXT-X-ENDLIST</p>
<p>EXT-X-ENDLIST标签标示没有更多媒体文件将会加入到播放列表中，它可能会出现在播放列表文件的任何地方，但是不能出现两次或以上。其格式如下：<br><code>#EXT-X-ENDLIST</code></p>
<p>3.2.7 EXT-X-STREAM-INF</p>
<p>EXT-X-STREAM-INF标签表示在播放列表中的下一个URI标识另一个播放列表文件。格式如下：<br><code>#EXT-X-STREAM-INF:[attribute=value][,attribute=value]\* &lt;URI&gt;</code></p>
<p>在一个EXT-X-STREAM-INF标签中attribute不能出现两次或以上。其它属性定义：<br><code>BANDWIDTH = &lt;n&gt;</code><br>n为每秒比特数,它必须是每个媒体文件比特速率的上限，必须经过计算包含那些在播放列表中出现的或者将要出现的容器开销。<br><code>PROGRAM-ID=&lt;i&gt;</code><br>i是一个数字，在播放列表文件的范围内唯一的标识了一个特定的演示文稿。<br>一个播放列表文件可能包含多个具有相同PROGRAM-ID 的EXT-X-STREAM-INF标签来标识某个演示文稿的不同编码。这些变种的的播放列表可能包含额外的EXT-X-STREAM-INF标签。<br><code>CODECS=&quot;[format][,format]*&quot;</code><br>每一种格式都指定了存在于媒体文件中的媒体类型。合法的格式标示符都是那些在ISO文件格式名称空间被RFC4281定义的格式。<br>RESOLUTION=<N>x<M><br>N是流中视频水平编码分辨率的近似，以像素数表示，M是编码垂直分辨率的近似。</p>
<p>3.2.8 EXT-X-DISCONTINUITY</p>
<p>EXT-X-DISCONTINUITY标签表示该标签后边的媒体文件和之前的媒体文件之间的编码间断。特性可能改变的一组是：  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file format  </span><br><span class="line">number and type of tracks  </span><br><span class="line">encoding parameters  </span><br><span class="line">encoding sequence</span><br></pre></td></tr></table></figure>
<p>详见第四章，6.2.1、6.3.3。</p>
<p>3.2.9 EXT-X-VERSION</p>
<p>EXT-X-VERSION标签指出了播放列表版本的适应性。播放列表文件、其关联的媒体和服务器必须遵守最新版本的所有规定。</p>
<p>4 多媒体文件</p>
<p>每一个媒体文件资源定位符都必须标识一个媒体文件，该文件是整体数据的一个分片。每个媒体文件必须按照MPEG-2的传输流和MPEG-2音频流的格式。[ISO13818]<br>传输流文件必须包含一个MPEG-2节目。在每个文件的开始应该有一个节目关联表和一个节目映射表。包含视频的文件应该有至少一个密钥帧和足够的信息来完全初始化一个视频解码器。<br>播放列表中的媒体文件必须是编码流中媒体文件的末尾与先前的序列号的延续，除非它是播放列表中出现的第一个媒体文件，或者它前边有EXT-X-DISCONTINUITY标签。<br>客户端应该准备好处理一个特定类型（音频或视频等）的多个轨道。一个没有优先级的客户端应该选择它能播放的具有最小数字编号的音轨。<br>客户端应该忽略那些传输流的内部不能识别的流。<br>媒体文件内样本流和相应的多媒体流的编码参数应保持一致。然而客户端应该解决编码的变化问题，例如缩放视频内容以适应分辨率改变。</p>
<p>URI属性中EXT-X-KEY标签标识一个密钥文件。密钥文件包含解密播放列表中媒体文件的密钥。AES-128加密算法使用16字节的密钥。密钥文件的格式为16字节的二进制数数组。</p>
]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>ffmpeg</tag>
        <tag>hls</tag>
        <tag>m3u8</tag>
      </tags>
  </entry>
  <entry>
    <title>一张图掌握Git</title>
    <url>/posts/282.html</url>
    <content><![CDATA[<p><a href="https://upload.phpkoo.com/uploads/2017/02/4774497-dcb0ae305248e62d.png" target="_blank" rel="noopener"><img src="https://upload.phpkoo.com/uploads/2017/02/4774497-dcb0ae305248e62d.png" alt=""></a></p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下安装mysql5.7社区版</title>
    <url>/posts/272.html</url>
    <content><![CDATA[<p>mysql分社区版和企业版，其中社区版为免费使用并且开源。<br>1、下载mysql5.7社区版（64位）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.17-linux-glibc2.5-x86_64.tar</span><br><span class="line">tar -xvf mysql-5.7.17-linux-glibc2.5-x86_64.tar</span><br><span class="line">tar -zxvf mysql-5.7.17-linux-glibc2.5-x86_64.tar.gz</span><br></pre></td></tr></table></figure>
<p>2、解压拷贝</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mv mysql-5.7.17-linux-glibc2.5-x86_64 /usr/<span class="built_in">local</span>/mysql</span><br></pre></td></tr></table></figure>
<p>3、创建mysql用户</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql mysql</span><br></pre></td></tr></table></figure>
<p>4、创建mysql的数据目录，该目录在初始化数据库的时候会用到</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mkdir /usr/<span class="built_in">local</span>/mysql/data /usr/<span class="built_in">local</span>/mysql/<span class="built_in">log</span></span><br><span class="line">chown -R mysql:mysql /usr/<span class="built_in">local</span>/mysql</span><br></pre></td></tr></table></figure>
<p>5、创建my.cnf文件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/mysql/support-files/my-default.cnf /etc/my.cnf</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">server_id=1</span><br><span class="line">port = 3306</span><br><span class="line">user = mysql</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql</span><br><span class="line">datadir = /usr/<span class="built_in">local</span>/mysql/data</span><br><span class="line">pid-file = /usr/<span class="built_in">local</span>/mysql/data/mysql.pid</span><br><span class="line">max_connections = 1000</span><br><span class="line">max_connect_errors = 1000</span><br><span class="line">table_open_cache = 1024</span><br><span class="line">max_allowed_packet = 128M</span><br><span class="line">open_files_limit = 65535</span><br><span class="line"><span class="comment">#####====================================[innodb]==============================</span></span><br><span class="line">innodb_buffer_pool_size = 1024M</span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line">innodb_write_io_threads = 4</span><br><span class="line">innodb_read_io_threads = 4</span><br><span class="line">innodb_purge_threads = 2</span><br><span class="line">innodb_flush_log_at_trx_commit = 1</span><br><span class="line">innodb_log_file_size = 512M</span><br><span class="line">innodb_log_files_in_group = 2</span><br><span class="line">innodb_log_buffer_size = 16M</span><br><span class="line">innodb_max_dirty_pages_pct = 80</span><br><span class="line">innodb_lock_wait_timeout = 30</span><br><span class="line">innodb_data_file_path=ibdata1:1024M:autoextend</span><br><span class="line"></span><br><span class="line"><span class="comment">#####====================================[log]==============================</span></span><br><span class="line">log_error = /usr/<span class="built_in">local</span>/mysql/<span class="built_in">log</span>/mysql-error.log</span><br><span class="line">slow_query_log = 1</span><br><span class="line">long_query_time = 1</span><br><span class="line">slow_query_log_file = /usr/<span class="built_in">local</span>/mysql/<span class="built_in">log</span>/mysql-slow.log</span><br><span class="line"></span><br><span class="line">sql_mode=ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br></pre></td></tr></table></figure>
<p>6、初始化数据库</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/mysql/bin/mysql_install_db --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/usr/<span class="built_in">local</span>/mysql/data --user=mysql</span><br></pre></td></tr></table></figure>
<p>7、修改目录权限</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chown -R mysql:mysql /usr/<span class="built_in">local</span>/mysql</span><br></pre></td></tr></table></figure>
<p>8、配置启动文件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br></pre></td></tr></table></figure>
<p>9、启动mysql</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/etc/init.d/mysqld start</span><br></pre></td></tr></table></figure>
<p>10、获取初始密码</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat ~/.mysql_secret</span><br><span class="line">rm -rf ~/.mysql_secret</span><br></pre></td></tr></table></figure>
<p>11、重设初始密码</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/mysql/bin/mysql -uroot -p</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'********'</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges on *.* to root@<span class="string">'%'</span> identified by <span class="string">'123456'</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>
<p>ps:远程连接mysql，报can’t connect to mysql server on ‘localhost’ (10060)<br>请检查一下iptables，默认可能禁用了3306端口</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>重启iptables</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>
<p>PS:</p>
<p>1、创建用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'host'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'password'</span>;</span><br></pre></td></tr></table></figure>

<p>说明：<br>username：你将创建的用户名<br>host：指定该用户在哪个主机上可以登陆，如果是本地用户可用localhost，如果想让该用户可以从任意远程主机登陆，可以使用通配符%<br>password：该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器</p>
<p>2、授权</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'host'</span></span><br></pre></td></tr></table></figure>

<p>说明：<br>privileges：用户的操作权限，如SELECT，INSERT，UPDATE等，如果要授予所的权限则使用ALL<br>databasename：数据库名<br>tablename：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用<em>表示，如</em>.*</p>
<p>注意：<br>用以上命令授权的用户不能给其它用户授权，如果想让该用户可以授权，用以下命令:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'host'</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>;</span><br></pre></td></tr></table></figure>
<p>3、设置与更改用户密码</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">'username'</span>@<span class="string">'host'</span> = <span class="keyword">PASSWORD</span>(<span class="string">'newpassword'</span>);</span><br></pre></td></tr></table></figure>

<p>如果是当前登陆用户用</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> = <span class="keyword">PASSWORD</span>(<span class="string">"newpassword"</span>);</span><br></pre></td></tr></table></figure>
<p>4、撤销用户权限</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> privilege <span class="keyword">ON</span> databasename.tablename <span class="keyword">FROM</span> <span class="string">'username'</span>@<span class="string">'host'</span>;</span><br></pre></td></tr></table></figure>

<p>说明：<br>privilege, databasename, tablename：同授权部分</p>
<p>注意： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">假如你在给用户&#39;pig&#39;@&#39;%&#39;授权的时候是这样的（或类似的）：GRANT SELECT ON test.user TO &#39;pig&#39;@&#39;%&#39;，则在使用REVOKE SELECT ON *.* FROM &#39;pig&#39;@&#39;%&#39;;命令并不能撤销该用户对test数据库中user表的SELECT 操作。相反，如果授权使用的是GRANT SELECT ON *.* TO &#39;pig&#39;@&#39;%&#39;;则REVOKE SELECT ON test.user FROM &#39;pig&#39;@&#39;%&#39;;命令也不能撤销该用户对test数据库中user表的Select权限。</span><br><span class="line"></span><br><span class="line">具体信息可以用命令SHOW GRANTS FOR &#39;pig&#39;@&#39;%&#39;; 查看。</span><br></pre></td></tr></table></figure>
<p>5、删除用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'host'</span>;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下安装php7的mongodb模块</title>
    <url>/posts/267.html</url>
    <content><![CDATA[<p>php一共有两个模块分别为mongo和mongodb，其中php7只支持mongodb模块</p>
<p>1.安装依赖包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install autoconf</span><br></pre></td></tr></table></figure>
<p>2.下载mongodb模块</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget -O mongodb-1.1.9.tgz https://pecl.php.net/get/mongodb</span><br><span class="line">tar -zxvf mongodb-1.1.9.tgz</span><br><span class="line"><span class="built_in">cd</span> mongodb-1.1.9</span><br></pre></td></tr></table></figure>
<p>3.编译与安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>安装完成</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>centos</tag>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos下 Nginx安装与配置</title>
    <url>/posts/261.html</url>
    <content><![CDATA[<p>首先由于nginx的一些模块依赖一些lib库，所以在安装nginx之前，必须先安装这些lib库，这些依赖库主要有g++、gcc、openssl-devel、pcre-devel和zlib-devel 所以执行如下命令安装<br>1.安装依赖包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel ncurses-devel perl</span><br></pre></td></tr></table></figure>
<p>2.下载最新版的nginx</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.10.2.tar.gz</span><br><span class="line">tar -zxvf nginx-1.10.2.tar.gz</span><br></pre></td></tr></table></figure>
<p>3.编译与安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>4.查看nginx的安装目录</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure>
<p>5.启动</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/nginx</span><br></pre></td></tr></table></figure>
<p>安装完成</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下安装php7</title>
    <url>/posts/259.html</url>
    <content><![CDATA[<p>编译安装 php-fpm<br>1.下载php7</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget -O php7.tar.gz http://cn2.php.net/get/php-7.0.13.tar.gz/from/this/mirror</span><br><span class="line">tar -zxvf php7.tar.gz</span><br><span class="line"><span class="built_in">cd</span> php-7.0.13</span><br></pre></td></tr></table></figure>
<p>2.安装依赖包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install gcc gcc-c++ libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel</span><br></pre></td></tr></table></figure>
<p>3.编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）<br>可以从这一步起参考PHP官方安装说明：<a href="http://php.net/manual/zh/install.unix.nginx.php" target="_blank" rel="noopener">http://php.net/manual/zh/install.unix.nginx.php</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./configure \</span><br><span class="line">--prefix=/usr/<span class="built_in">local</span>/php \</span><br><span class="line">--with-config-file-path=/usr/<span class="built_in">local</span>/php/etc \</span><br><span class="line">--<span class="built_in">enable</span>-fpm \</span><br><span class="line">--<span class="built_in">enable</span>-inline-optimization \</span><br><span class="line">--<span class="built_in">disable</span>-debug \</span><br><span class="line">--<span class="built_in">disable</span>-rpath \</span><br><span class="line">--<span class="built_in">enable</span>-shared  \</span><br><span class="line">--<span class="built_in">enable</span>-soap \</span><br><span class="line">--with-libxml-dir \</span><br><span class="line">--with-xmlrpc \</span><br><span class="line">--with-openssl \</span><br><span class="line">--with-mhash \</span><br><span class="line">--with-pcre-regex \</span><br><span class="line">--with-sqlite3 \</span><br><span class="line">--with-zlib \</span><br><span class="line">--<span class="built_in">enable</span>-bcmath \</span><br><span class="line">--with-iconv \</span><br><span class="line">--with-bz2 \</span><br><span class="line">--<span class="built_in">enable</span>-calendar \</span><br><span class="line">--with-curl \</span><br><span class="line">--with-cdb \</span><br><span class="line">--<span class="built_in">enable</span>-dom \</span><br><span class="line">--<span class="built_in">enable</span>-exif \</span><br><span class="line">--<span class="built_in">enable</span>-fileinfo \</span><br><span class="line">--<span class="built_in">enable</span>-filter \</span><br><span class="line">--with-pcre-dir \</span><br><span class="line">--<span class="built_in">enable</span>-ftp \</span><br><span class="line">--with-gd \</span><br><span class="line">--with-openssl-dir \</span><br><span class="line">--with-jpeg-dir \</span><br><span class="line">--with-png-dir \</span><br><span class="line">--with-zlib-dir  \</span><br><span class="line">--with-freetype-dir \</span><br><span class="line">--with-gettext \</span><br><span class="line">--with-gmp \</span><br><span class="line">--with-mhash \</span><br><span class="line">--<span class="built_in">enable</span>-json \</span><br><span class="line">--<span class="built_in">enable</span>-mbstring \</span><br><span class="line">--<span class="built_in">enable</span>-mbregex \</span><br><span class="line">--<span class="built_in">enable</span>-mbregex-backtrack \</span><br><span class="line">--with-libmbfl \</span><br><span class="line">--with-onig \</span><br><span class="line">--<span class="built_in">enable</span>-pdo \</span><br><span class="line">--with-mysqli=mysqlnd \</span><br><span class="line">--with-pdo-mysql=mysqlnd \</span><br><span class="line">--with-zlib-dir \</span><br><span class="line">--with-pdo-sqlite \</span><br><span class="line">--with-readline \</span><br><span class="line">--<span class="built_in">enable</span>-session \</span><br><span class="line">--<span class="built_in">enable</span>-shmop \</span><br><span class="line">--<span class="built_in">enable</span>-simplexml \</span><br><span class="line">--<span class="built_in">enable</span>-sockets  \</span><br><span class="line">--<span class="built_in">enable</span>-sysvmsg \</span><br><span class="line">--<span class="built_in">enable</span>-sysvsem \</span><br><span class="line">--<span class="built_in">enable</span>-sysvshm \</span><br><span class="line">--<span class="built_in">enable</span>-wddx \</span><br><span class="line">--with-libxml-dir \</span><br><span class="line">--with-xsl \</span><br><span class="line">--<span class="built_in">enable</span>-zip \</span><br><span class="line">--<span class="built_in">enable</span>-mysqlnd-compression-support \</span><br><span class="line">--with-pear \</span><br><span class="line">--<span class="built_in">enable</span>-opcache</span><br></pre></td></tr></table></figure>
<p>4.正式安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>5.配置环境变量</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/profile&lt;&lt;EOF</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/php/bin</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>6.导入环境变量</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<p>7.配置php-fpm</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cp php.ini-production /usr/<span class="built_in">local</span>/php/etc/php.ini</span><br><span class="line">cp /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf.default /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf</span><br><span class="line">cp /usr/<span class="built_in">local</span>/php/etc/php-fpm.d/www.conf.default /usr/<span class="built_in">local</span>/php/etc/php-fpm.d/www.conf</span><br><span class="line">cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class="line">chmod +x /etc/init.d/php-fpm</span><br></pre></td></tr></table></figure>
<p>8.启动php-fpm</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/etc/init.d/php-fpm start</span><br></pre></td></tr></table></figure>
<p>安装完成</p>
<p>ps:<br>有2种方式可以找到之前的编译参数：<br>1.在源码 /lamp/php-5.4.11/中找到 config.nice，这个就是之前的编译参数<br>2.去掉enable-gd-jis-conv编译参数，引起imagettftext()中文乱码问题<br>3.在php.ini配置文件中找到Configure相关的配置 :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/php/bin/php -i |grep <span class="string">'Configure'</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>php7</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下php7支持memcached</title>
    <url>/posts/253.html</url>
    <content><![CDATA[<p>php7出了！性能提升一倍！<br>不过兼容性好像还不太好，我在php7下安装memcached扩展遇到了问题，记录一下。</p>
<ol>
<li>首先需要安装libmemcached支持：<br>官网在此，找到最新版的下载链接 <a href="https://launchpad.net/libmemcached，使用wget下载tar.gz压缩包，解压缩，进入目录，依次执行（prefix后为安装目录）：" target="_blank" rel="noopener">https://launchpad.net/libmemcached，使用wget下载tar.gz压缩包，解压缩，进入目录，依次执行（prefix后为安装目录）：</a><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/libmemcached  </span><br><span class="line">make  </span><br><span class="line">make install</span><br></pre></td></tr></table></figure></li>
<li>安装memcached<br>php使用memcache的扩展有两个，一个memcache，一个memcached，前者比较老，推荐使用第二个，我们这里以第二个为例：<br>在github上找到适用于php7的分支（<a href="https://github.com/php-memcached-dev/php-memcached/tree/php7），同样使用wget下载zip压缩包，解压缩，进入目录，依次执行下列命令（其中php-config和libmemcached目录根据具体情况设定，可以使用whereis或者find来查找）：" target="_blank" rel="noopener">https://github.com/php-memcached-dev/php-memcached/tree/php7），同样使用wget下载zip压缩包，解压缩，进入目录，依次执行下列命令（其中php-config和libmemcached目录根据具体情况设定，可以使用whereis或者find来查找）：</a><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/php/bin/phpize  </span><br><span class="line">./configure --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config --<span class="built_in">enable</span>-memcached-sasl  </span><br><span class="line">make  </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
安装成功</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>php-memcached</tag>
      </tags>
  </entry>
  <entry>
    <title>AAC编码基本说明</title>
    <url>/posts/218.html</url>
    <content><![CDATA[<p>Advanced Audio Coding (AAC) 是 MP3 的后继格式，它被定义於 MPEG-4 part 3 (ISO/IEC 14496-3)。它通常使用在 MP4 容器内；对于音乐习惯上使用 .m4a 副档名。第二常见使用是在 MKV (Matroska) 档内，因为它比 MP4 支援更多以文字为基础的软字幕 (例如 ass, ssa…)。本文中的范例将使用 MP4 与 M4A 副档名。<br>​<br>FFmpeg 可以支援 4 个 AAC-LC 编码器 (aac, libfaac, libfdk_aac, libvo_aacenc) 与两个 AAC-HE 编码器 (libaacplus, libfdk_aac)。libaacplus, libfaac, libfdk_aac 的授权不与 GPL 相容，所以当 GPU 授权源代码也包含在内时 GPU 不允许包含源代码授权依据这些授权的二进位档的发布。因此这些编码器被指定为 “non-free”，且你不能下载内建它们的 ffmpeg。这可以透过自行编译 ffmpeg 来解决。</p>
<p>对于 AAC-LC 品质而言，其答案可能是:<br>libfdk_aac &gt; libfaac &gt; Native FFmpeg AAC encoder (aac) &gt; libvo_aacenc<br><a href="https://trac.ffmpeg.org/wiki/Encode/HighQualityAudio#AudioencodersFFmpegcanuse" target="_blank" rel="noopener">https://trac.ffmpeg.org/wiki/Encode/HighQualityAudio#AudioencodersFFmpegcanuse</a></p>
<p><strong>libfdk_aac</strong></p>
<p>The Fraunhofer FDK AAC 编解码程式库。这是目前 ffmpeg 所能提供的最高品质 AAC 编码器。需要 ffmpeg 组态 (configuration) 中含有 –enable-libfdk-aac (如果也使用 –enable-gpl 则还需要 –enable-nonfree)。</p>
<p>详细资料: Fraunhofer FDK AAC - Hydrogenaud</p>
<p>Constant Bit Rate (CBR, 常数位元速率) 模式</p>
<p>指定一个目标位元速率。它可以让你精準控制输出档案大小 (= 位元率 * 时间长度)，且它与 HE-AAC profile 相容。由经验得知，双声道推荐 位元率 &gt;= 128kbps，6 声道则推荐位元率 &gt;= 384kbps (由 双声道位元率 * 声道数 / 2)。使用 -b 选项来控制输出位元速率。</p>
<p>范例:</p>
<p>转换一个音讯档为 AAC 并以 M4A (MP4) 容器来封装:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input.wav -c:a libfdk_aac -b:a 128k output.m4a</span><br></pre></td></tr></table></figure>
<p>转换一个影片的 5.1 生到音讯为 AAC，并复制其视讯串流:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -c:v copy -c:a libfdk_aac -b:a 384k output.mp4</span><br></pre></td></tr></table></figure>
<p>Variable Bit Rate (VBR, 可变位元速率) 模式</p>
<p>指定一个目标品质，而不是特定的位元速率。设定值范围为 1-5，较高的值会得到较高的位元率与品质。使用 -vbr 选项来设定 VBR 等级。</p>
<p>范例:</p>
<p>转换一个音讯档为 AAC 并以 M4A (MP4) 容器来封装:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input.wav -c:a libfdk_aac -vbr 3 output.m4a</span><br></pre></td></tr></table></figure>
<p>转换一个影片的 5.1 生到音讯为 AAC，并复制其视讯串流:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -c:v copy -c:a libfdk_aac -vbr 3 output.mp4</span><br></pre></td></tr></table></figure>
<p><strong>High-Efficiency AAC</strong></p>
<p>简称 AAC-HE 又名为 aacPlus，这是一对专门针对低位元速率的 AAC profiles (version 1 与 version 2)，AAC-HE v1。对于双声道而言 (如下图所示)，AAC-HE v1 适用于 96kbps 以下，而 AAC-HE v2 适用于 48kbps 以下。但大多数播放设备不支援播放任何版本的 AAC-HE 而只能播放 AAC-LC。</p>
<p><a href="https://upload.phpkoo.com/uploads/2015/09/mobile01-0aaa64dadec533c578cc87c6c1054e16.png" target="_blank" rel="noopener"><img src="https://upload.phpkoo.com/uploads/2015/09/mobile01-0aaa64dadec533c578cc87c6c1054e16.png" alt="mobile01-0aaa64dadec533c578cc87c6c1054e16"></a></p>
<p>x 轴为音质; y 轴为位元率</p>
<p>注意: AAC-HE v2 只能处理双声道。如果需要降混 (down-mix) 至 单声道，则使用 AAC-HE v1。</p>
<p>如果需要指定 Profile 则使用 -profile 选项。</p>
<p>Profiles:<br>aac_low<br>MPEG-4 AAC LC (default)<br>aac_he<br>MPEG-4 HE-AAC (SBR)<br>aac_he_v2<br>MPEG-4 HE-AAC v2 (SBR+PS)<br>aac_ld<br>MPEG-4 AAC LD<br>aac_eld<br>MPEG-4 AAC ELD</p>
<p>例如:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input.wav -ac 2 -c:a libfdk_aac -profile:a aac_he -vbr 3 output.m4a</span><br></pre></td></tr></table></figure>
<p><strong>Native FFmpeg AAC encoder</strong><br>原生 (Native) FFmpeg AAC 编码器是已包含在 ffmpeg 内，而且它不像本文中其它 AAC 编码器那样需要一个外部程式库。注意这将不会让你得到如同 libfdk_aac 一样的良好结果。这被认为是实验性的编码器，所以需要 “-strict experimental” 或 “-strict -2 is”。</p>
<p><strong>指定位元率</strong></p>
<p>使用 -b 选项来指定输出位元率为 240kbps:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input.wav -strict experimental -c:a aac -b:a 240k output.m4a</span><br></pre></td></tr></table></figure>
<p><strong>指定品质</strong></p>
<p>使用 -q 选项来指定输出品质等级为 6:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input.wav -strict experimental -c:a aac -q:a 6 output.m4a</span><br></pre></td></tr></table></figure>
<p>设定值有效范围为 0.1-10。比较高的设定值会得到较高的输出品质与位元率大小。<br>此 VBR 是实验性的并且有可能得到比 CBR 更差的结果。</p>
<p><strong>libvo_aacenc</strong></p>
<p>VisualOn AAC 编码程式库。需要 ffmpeg 组态 (configuration) 中含有 –enable-libvo-aacenc。它有非 non-free 的优点，但它是一个更差的编码器比起 libfdk_aac 甚至 原生的 FFmpeg AAC 编码器，根据 FFmpeg AACの音质评価。此编码器最多只支援 2 声道，并只有 CBR 模式，而且不支援 VBR 输出。</p>
<p><strong>CBR 128Kbps：</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ffmpeg -i input.wav -ac 2 -c:a libvo_aacenc -b:a 128k output.m4a</span><br></pre></td></tr></table></figure>
<p><strong>附：</strong></p>
<p>HE-AAC, HE-AAC v2<br>品质 高品质<br>比特率 HE-AAC：32至48kbit/s 单声道<br>HE-AAC v2：16至24kbit/s 单声道<br>高品质音频<br>采样率 24至96kHz<br>声道 单声道、立体声、多声道（如5.1、7.1）<br>应用 DVB（数 字视频广播）、ISDB（综合业务数字广播）、ARIB、ATSC-M/H、DAB+（数字音频广播）、DRM+（数字版权管理）、DRM、DVB- H（手持式数字视频广播）、DMB（数字多媒体广播）、MediaFLO、3GPP、XM广播、移动电话、音频和视频下载服务</p>
<p>AAC-LC<br>品质 达到统计学标准的清晰度<br>比特率 最高每通道256kbit/s<br>采样率 8至96kHz<br>声道 单声道、立体声、多声道（如5.1、7.1）<br>应用 苹果 iPod、 iTunes、QuickTime、 日本ISDB（综合业务数字广播）、 AV 接收器、汽车收音机、移动音乐播放器、移动电话</p>
]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>ffmpeg</tag>
        <tag>aac</tag>
      </tags>
  </entry>
  <entry>
    <title>对FFmpeg的X264预置比较</title>
    <url>/posts/207.html</url>
    <content><![CDATA[<p>对FFmpeg的X264质量预设测量性能，要知道哪个选项是最适合我的目的将MPEG2 TS到苹果电视的MP4。因素需要考虑是：<br>1）转换的速度<br>2）文件的大小<br>3）视频的质量<br>最重要的因素就是转换的速度，如果时间转换比录制短。同时对于文件的大小也是越小越好。</p>
<p>测试方法</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ultrafast superfast veryfast faster fast medium slow slower veryslow placebo</span><br><span class="line"><span class="keyword">do</span> ffmpeg -i sample.ts -vcodec libx264 \</span><br><span class="line">      -preset <span class="variable">$i</span> -profile:v baseline -level 3.0 -s 1280x720 \</span><br><span class="line">      -acodec libfaac -ab 160k \</span><br><span class="line">      -y <span class="variable">$i</span>.mp4</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>sample.ts是一个60秒的全高清（1440×1080），MPEG2视频</p>
<p>测试结果</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">preset used <span class="keyword">for</span> conversion</span><br><span class="line">Conversion speed (fps - frames per second) . The bigger the faster.</span><br><span class="line">Size of the output video file (<span class="keyword">in</span> bytes)</span><br><span class="line"></span><br><span class="line">ultrafast</span><br><span class="line">29.6</span><br><span class="line">81,046,858</span><br><span class="line"></span><br><span class="line">superfast</span><br><span class="line">27.9</span><br><span class="line">58,180,478</span><br><span class="line"></span><br><span class="line">veryfast</span><br><span class="line">20.6</span><br><span class="line">43,968,615</span><br><span class="line"></span><br><span class="line">faster</span><br><span class="line">13.0</span><br><span class="line">32,981,783</span><br><span class="line"></span><br><span class="line">fast</span><br><span class="line">9.1</span><br><span class="line">35,461,071</span><br><span class="line"></span><br><span class="line">medium</span><br><span class="line">8.0</span><br><span class="line">35,119,322</span><br><span class="line"></span><br><span class="line">slow</span><br><span class="line">5.6</span><br><span class="line">33,367,247</span><br><span class="line"></span><br><span class="line">slower</span><br><span class="line">2.1</span><br><span class="line">33,698,347</span><br><span class="line"></span><br><span class="line">veryslow</span><br><span class="line">1.3</span><br><span class="line">29,697,663</span><br><span class="line"></span><br><span class="line">placebo</span><br><span class="line">0.6</span><br><span class="line">29,395,288</span><br></pre></td></tr></table></figure>
<p><a href="https://upload.phpkoo.com/uploads/2015/09/ffmpeg-presets-comparison-results.png" target="_blank" rel="noopener"><img src="https://upload.phpkoo.com/uploads/2015/09/ffmpeg-presets-comparison-results.png" alt="ffmpeg-presets-comparison-results"></a></p>
]]></content>
      <categories>
        <category>FFmpeg</category>
      </categories>
      <tags>
        <tag>ffmpeg</tag>
        <tag>x264</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下安装lua环境</title>
    <url>/posts/198.html</url>
    <content><![CDATA[<p>到LUA官网下载安装包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget http://www.lua.org/ftp/lua-5.1.5.tar.gz</span><br><span class="line">$ tar zxvf lua-5.1.5.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> lua-5.1.5/</span><br><span class="line">$ yum install -y readline-devel ncurses-devel</span><br><span class="line">$ make linux</span><br></pre></td></tr></table></figure>
<p>如下提示：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> src &amp;&amp; make linux  </span><br><span class="line">make[1]: Entering directory <span class="string">'/usr/local/src/lua-5.1.5/src'</span></span><br><span class="line">make all MYCFLAGS=-DLUA_USE_LINUX MYLIBS=<span class="string">"-Wl,-E -ldl -lreadline -lhistory -lncurses"</span></span><br><span class="line">make[2]: Entering directory <span class="string">'/usr/local/src/lua-5.1.5/src'</span>  </span><br><span class="line">make[2]: Nothing to be <span class="keyword">done</span> <span class="keyword">for</span> <span class="string">'all'</span>.</span><br><span class="line">make[2]: Leaving directory <span class="string">'/usr/local/src/lua-5.1.5/src'</span></span><br><span class="line">make[1]: Leaving directory <span class="string">'/usr/local/src/lua-5.1.5/src'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> src &amp;&amp; mkdir -p /usr/<span class="built_in">local</span>/bin /usr/<span class="built_in">local</span>/include /usr/<span class="built_in">local</span>/lib /usr/<span class="built_in">local</span>/man/man1 /usr/<span class="built_in">local</span>/share/lua/5.1 /usr/<span class="built_in">local</span>/lib/lua/5.1  </span><br><span class="line"><span class="built_in">cd</span> src &amp;&amp; install -p -m 0755 lua luac /usr/<span class="built_in">local</span>/bin  </span><br><span class="line"><span class="built_in">cd</span> src &amp;&amp; install -p -m 0644 lua.h luaconf.h lualib.h lauxlib.h ../etc/lua.hpp /usr/<span class="built_in">local</span>/include  </span><br><span class="line"><span class="built_in">cd</span> src &amp;&amp; install -p -m 0644 liblua.a /usr/<span class="built_in">local</span>/lib  </span><br><span class="line"><span class="built_in">cd</span> doc &amp;&amp; install -p -m 0644 lua.1 luac.1 /usr/<span class="built_in">local</span>/man/man1</span><br><span class="line"></span><br><span class="line">$ whereis lua</span><br><span class="line">lua: /usr/bin/lua /usr/lib64/lua /usr/<span class="built_in">local</span>/bin/lua /usr/<span class="built_in">local</span>/lib/lua /usr/share/lua /usr/share/man/man1/lua.1.gz</span><br><span class="line"></span><br><span class="line">$ /usr/<span class="built_in">local</span>/bin/lua</span><br><span class="line">Lua 5.1.5 Copyright (C) 1994-2012 Lua.org, PUC-Rio</span><br></pre></td></tr></table></figure>
<p>安装完成。</p>
]]></content>
      <categories>
        <category>LUA</category>
      </categories>
      <tags>
        <tag>LUA</tag>
      </tags>
  </entry>
  <entry>
    <title>lua安装mongorover模块</title>
    <url>/posts/190.html</url>
    <content><![CDATA[<p>mongorover模块是mongodb官方提供的lua语言的驱动，官网API文档：<a href="http://api.mongodb.org/lua/0.1/index.html" target="_blank" rel="noopener">http://api.mongodb.org/lua/0.1/index.html</a></p>
<p>通过luarocks方式安装lua模块</p>
<p>一、安装luarocks工具</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget http://luarocks.org/releases/luarocks-2.2.2.tar.gz</span><br><span class="line">$ tar zxpf luarocks-2.2.2.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> luarocks-2.2.2</span><br><span class="line">$ ./configure</span><br><span class="line">$ make bootstrap</span><br></pre></td></tr></table></figure>
<p>二、安装mongorover模块</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ luarocks install mongorover</span><br></pre></td></tr></table></figure>
<p>安装时，报以下错误信息</p>
<p>Error: Could not find expected file libbson-1.0/bson.h, or libbson-1.0/bson.h for LIBMONGOC – you may have to install LIBMONGOC in your system and/or pass LIBMONGOC_DIR or LIBMONGOC_INCDIR to the luarocks command. Example: luarocks install mongorover LIBMONGOC_DIR=/usr/local</p>
<p>三、安装bson库</p>
<p>官方安装参照：<a href="http://api.mongodb.org/libbson/current/installing.html" target="_blank" rel="noopener">http://api.mongodb.org/libbson/current/installing.html</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget https://github.com/mongodb/libbson/releases/download/1.1.10/libbson-1.1.10.tar.gz</span><br><span class="line">$ tar -xzf libbson-1.1.10.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> libbson-1.1.10/</span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br><span class="line">$ ln -s /usr/include/libbson-1.0/ /usr/<span class="built_in">local</span>/libbson-1.0</span><br></pre></td></tr></table></figure>
<p>再执行,安装mongorover模块,又报以下错误</p>
<p>Error: Could not find expected file libmongoc-1.0/mongoc.h, or libmongoc-1.0/mongoc.h for LIBMONGOC – you may have to install LIBMONGOC in your system and/or pass LIBMONGOC_DIR or LIBMONGOC_INCDIR to the luarocks command. Example: luarocks install mongorover LIBMONGOC_DIR=/usr/local</p>
<p>四、安装libmongoc库</p>
<p>官方安装参照：<a href="http://api.mongodb.org/c/current/installing.html" target="_blank" rel="noopener">http://api.mongodb.org/c/current/installing.html</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ wget https://github.com/mongodb/mongo-c-driver/releases/download/1.1.10/mongo-c-driver-1.1.10.tar.gz</span><br><span class="line">$ tar -xzf mongo-c-driver-1.1.10.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> mongo-c-driver-1.1.10/</span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br><span class="line">$ ln -s /usr/include/libmongoc-1.0/ /usr/<span class="built_in">local</span>/libmongoc-1.0</span><br></pre></td></tr></table></figure>
<p>再执行,安装mongorover模块，安装成功</p>
]]></content>
      <categories>
        <category>LUA</category>
      </categories>
      <tags>
        <tag>LUA</tag>
        <tag>LUA-MongoDB模块</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下zeromq库安装</title>
    <url>/posts/180.html</url>
    <content><![CDATA[<p>zeromq是个类似于Socket的一系列接口，他跟Socket的区别是：普通的socket是端到端的（1:1的关系），而ZMQ却是可以N：M 的关系，人们对BSD套接字的了解较多的是点对点的连接，点对点连接需要显式地建立连接、销毁连接、选择协议（TCP/UDP）和处理错误等，而ZMQ屏蔽了这些细节，让你的网络编程更为简单。ZMQ用于node与node间的通信，node可以是主机或者是进程。</p>
<p><strong>安装</strong></p>
<p>ZeroMQ：<a href="http://download.zeromq.org/zeromq-4.1.3.tar.gz" target="_blank" rel="noopener">http://download.zeromq.org/zeromq-4.1.3.tar.gz</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar -xvzf zeromq-4.1.3.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> zeromq-4.1.3</span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br><span class="line"></span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line">checking <span class="keyword">for</span> sodium... no  </span><br><span class="line">configure: error: Package requirements (libsodium) were not met</span><br></pre></td></tr></table></figure>
<p>ibsodium 是一个流行、易于使用的软件库。主要用于加密、解密、签名和生成密码哈希等等。这是一个可移植的、跨编译器支持、可安装的，基于 <a href="http://nacl.cr.yp.to/" target="_blank" rel="noopener">NaCl</a> 开发，提供一个兼容 API。它的目标是为所有构建更高级别的加密工具提供所需要的核心操作。</p>
<p><strong>安装</strong></p>
<p>libsodium：<a href="https://github.com/jedisct1/libsodium/releases/download/1.0.3/libsodium-1.0.3.tar.gz" target="_blank" rel="noopener">https://github.com/jedisct1/libsodium/releases/download/1.0.3/libsodium-1.0.3.tar.gz</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar -xvzf libsodium-1.0.3.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> libsodium-1.0.3</span><br><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p><strong>设置环境变量</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">export</span> PKG_CONFIG_PATH=/usr/<span class="built_in">local</span>/lib/pkgconfig</span><br></pre></td></tr></table></figure>
<p>最后ldconfig一下，更新一下动态链接库。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ ldconfig</span><br></pre></td></tr></table></figure>
<p>再次安装ZeroMQ,安装成功。</p>
<p>同时需要将</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum remove zeromq</span><br><span class="line">$ yum remove zeromq-devel</span><br></pre></td></tr></table></figure>
<p>安装成功后，可安装nodejs或python等的zmq模块来验证一下刚安装的版本。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>zeroMQ</tag>
        <tag>zmq</tag>
      </tags>
  </entry>
  <entry>
    <title>nvm 快速切换 Node 版本</title>
    <url>/posts/168.html</url>
    <content><![CDATA[<p>nvm 默认是从 <a href="http://nodejs.org/dist/" target="_blank" rel="noopener">http://nodejs.org/dist/</a> 下载的, 国外服务器, 必然很慢, 好在 nvm 以及支持从镜像服务器下载包, 于是我们可以方便地从七牛的 node dist 镜像下载</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">NVM_NODEJS_ORG_MIRROR=https://npm.taobao.org/dist nvm install 0.11.11</span><br></pre></td></tr></table></figure>
<p>于是你就会看到一段非常快速进度条:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">Now using node v0.11.11</span><br></pre></td></tr></table></figure>
<p>如果你不想每次都输入环境变量 NVM_NODEJS_ORG_MIRROR, 那么我建议你加入到 .bashrc 文件中:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> NVM_NODEJS_ORG_MIRROR=https://npm.taobao.org/dist</span><br><span class="line"><span class="built_in">source</span> path/to/nvm/nvm.sh</span><br></pre></td></tr></table></figure>
<p>然后你可以继续非常方便地安装各个版本的 node 了, 你可以查看一下你当前已经安装的版本:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nvm ls</span><br><span class="line">nvm</span><br><span class="line">v0.8.26</span><br><span class="line">v0.10.26</span><br><span class="line">v0.11.11</span><br><span class="line">-&gt; v0.11.12</span><br></pre></td></tr></table></figure>
<p><strong>nrm 快速切换 NPM 源</strong></p>
<p><strong>安装</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install -g nrm</span><br></pre></td></tr></table></figure>
<p><strong>使用</strong></p>
<p>列出可选的源</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nrm ls</span><br><span class="line">* npm ---- https://registry.npmjs.org/</span><br><span class="line">cnpm --- http://r.cnpmjs.org/</span><br><span class="line">taobao - http://registry.npm.taobao.org/</span><br><span class="line">eu ----- http://registry.npmjs.eu/</span><br><span class="line">au ----- http://registry.npmjs.org.au/</span><br><span class="line">sl ----- http://npm.strongloop.com/</span><br><span class="line">nj ----- https://registry.nodejitsu.com/</span><br></pre></td></tr></table></figure>
<p>带*的是当前使用的源，上面的输出表明当前源是官方源。</p>
<p><strong>切换</strong></p>
<p>切换到taobao</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nrm use taobao</span><br></pre></td></tr></table></figure>
<p>增加源</p>
<p>你可以增加定制的源，特别适用于添加企业内部的私有源。 私有源可以使用cnpmjs架设 。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nrm add  &lt;registry&gt; &lt;url&gt; [home]</span><br></pre></td></tr></table></figure>
<p>删除源</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nrm del &lt;registry&gt;</span><br></pre></td></tr></table></figure>
<p>测试速度</p>
<p>你还可以通过 nrm test 测试相应源的响应时间。</p>
<p>例如，测试官方源的响应时间：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nrm <span class="built_in">test</span> npm</span><br><span class="line">npm ---- 1328ms</span><br></pre></td></tr></table></figure>
<p>测试所有源的响应时间：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nrm <span class="built_in">test</span></span><br><span class="line">npm ---- 891ms</span><br><span class="line">cnpm --- 1213ms</span><br><span class="line">* taobao - 460ms</span><br><span class="line">eu ----- 3859ms</span><br><span class="line">au ----- 1073ms</span><br><span class="line">sl ----- 4150ms</span><br><span class="line">nj ----- 8008ms</span><br></pre></td></tr></table></figure>
<p>注意，为了取得较准确的结果，可以考虑多次测试取平均值。</p>
<p>许可</p>
<p>nrm 为开源软件，使用 MIT 许可。</p>
<p>项目主页</p>
<p><a href="http://github.com/Pana/nrm" target="_blank" rel="noopener">github.com/Pana/nrm</a></p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>node多版本管理</tag>
        <tag>nvm</tag>
      </tags>
  </entry>
  <entry>
    <title>centos下安装nginx_lua_module模块</title>
    <url>/posts/157.html</url>
    <content><![CDATA[<p><a href="http://wiki.nginx.org/HttpLuaModule" target="_blank" rel="noopener">ngx_lua_module</a> 是一个nginx http模块，它把 lua 解析器内嵌到 nginx，用来解析并执行lua 语言编写的网页后台脚本。</p>
<p>特性：<br>支持Windows和Linux平台。<br>支持高并发高性能。<br>HTML网页中内嵌LUA脚本代码，类似于PHP。<br>支持非阻塞的数据库操作，目前只支持MYSQL。<br>支持异步的文件IO操作。<br>支持非阻塞的SOCKET IO操作。</p>
<p><strong>方式一：使用集成包安装</strong></p>
<p>下载 <a href="https://github.com/openresty/ngx_openresty" target="_blank" rel="noopener">ngx_openresty</a>，该集成包中有：Nginx，Lua或Luajit，ngx_lua，以及一些有用的Nginx第三方模块。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://github.com/openresty/ngx_openresty  </span><br><span class="line">./configure --with-luajit  </span><br><span class="line">make  </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p><strong>方式二：Ngx_lua可以手动编译进Nginx(或Tengine)</strong></p>
<p>假定nginx的安装路径为：/usr/local/nginx</p>
<p>所需要的模块如下：<br><a href="https://github.com/openresty/luajit2" target="_blank" rel="noopener">luajit2</a> <a href="https://github.com/openresty/luajit2" target="_blank" rel="noopener">https://github.com/openresty/luajit2</a><br><a href="https://github.com/simpl/ngx_devel_kit" target="_blank" rel="noopener">ngx_devel_kit</a> <a href="https://github.com/simpl/ngx_devel_kit" target="_blank" rel="noopener">https://github.com/simpl/ngx_devel_kit</a><br><a href="https://github.com/agentzh/echo-nginx-module" target="_blank" rel="noopener">echo-nginx-module</a> <a href="https://github.com/agentzh/echo-nginx-module" target="_blank" rel="noopener">https://github.com/agentzh/echo-nginx-module</a><br><a href="https://github.com/chaoslawful/lua-nginx-module" target="_blank" rel="noopener">lua-nginx-module</a> <a href="https://github.com/chaoslawful/lua-nginx-module" target="_blank" rel="noopener">https://github.com/chaoslawful/lua-nginx-module</a></p>
<p>安装步骤：</p>
<p>1、安装openresty提供的luajit2</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget -O luajit2.zip https://codeload.github.com/openresty/luajit2/zip/v2.1-agentzh  </span><br><span class="line">unzip luajit2.zip  </span><br><span class="line"><span class="built_in">cd</span> luajit2  </span><br><span class="line">make  </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>下面配置 luajit的环境变量(Nginx编译时需要)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> LUAJIT_LIB=/usr/<span class="built_in">local</span>/lib  </span><br><span class="line"><span class="built_in">export</span> LUAJIT_INC=/usr/<span class="built_in">local</span>/include/luajit-2.1</span><br></pre></td></tr></table></figure>
<p>2、安装 ngx_devel_kit (NDK) 模块</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget -O ngx_devel_kit.zip https://codeload.github.com/simplresty/ngx_devel_kit/zip/master  </span><br><span class="line">unzip ngx_devel_kit.zip -d /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<p>3、安装 lua-nginx-module 模块</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget -O lua-nginx-module.zip https://codeload.github.com/openresty/lua-nginx-module/zip/master  </span><br><span class="line">unzip lua-nginx-module.zip -d /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<p>4、重新编译Nginx，需要注意编译顺序</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx   </span><br><span class="line">--with-ld-opt=-Wl,-rpath,<span class="variable">$LUAJIT_LIB</span>   </span><br><span class="line">--add-module=/usr/<span class="built_in">local</span>/ngx_devel_kit   </span><br><span class="line">--add-module=/usr/<span class="built_in">local</span>/<span class="built_in">echo</span>-nginx-module   </span><br><span class="line">--add-module=/usr/<span class="built_in">local</span>/lua-nginx-module  </span><br><span class="line">make -j2  </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>重新编译 Nginx 二进制，Nginx 需要 quit 再启动。而普通配置更新则 reload 即可。</p>
<p>quit</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">kill</span> -HUP cat /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid</span><br></pre></td></tr></table></figure>
<p>reload</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>
<p>模块编译完成！</p>
<p>在编译安装 Nginx 的第三方模块时，碰到一个错误：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/ngxin -s reload  </span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx: error <span class="keyword">while</span> loading shared libraries: libluajit-5.1.so.2: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>
<p>解决办法。<br>在 Nginx 编译时，需要指定 RPATH，加入下面选项即可</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./configure --with-ld-opt=<span class="string">"-Wl,-rpath,<span class="variable">$LUAJIT_LIB</span>"</span></span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/lib/:<span class="variable">$LD_LIBRARY_PATH</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>ngx_lua_module安装</tag>
        <tag>tengine</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos安装golang环境</title>
    <url>/posts/154.html</url>
    <content><![CDATA[<p>在国内镜像下载二进制包  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget http://www.golangtc.com/static/go/go1.4.2.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<p>直接解压到目标目录即可</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -C /usr/<span class="built_in">local</span> -zxvf go1.4.2.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<p>把golang的bin目录加入全局环境变量  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/profile &lt;&lt; EOF  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/go/bin  </span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>让配置生效  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<p>检查下是否成功  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go version</span><br></pre></td></tr></table></figure>
<p>在当前用户目录下新建go目录作为项目目录  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mkdir -p <span class="variable">$HOME</span>/go</span><br></pre></td></tr></table></figure>
<p>用cat的方法在尾部增加配置配置golang的 GOROOT GOPATH  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; <span class="variable">$HOME</span>/.bash_profile &lt;&lt; EOF  </span><br><span class="line"><span class="built_in">export</span> GOROOT=/usr/<span class="built_in">local</span>/go  </span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/go  </span><br><span class="line"><span class="built_in">export</span> GOBIN=<span class="variable">$HOME</span>/go/bin  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOROOT</span>/bin</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>让配置生效  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> <span class="variable">$HOME</span>/.bash_profile</span><br></pre></td></tr></table></figure>
<p>检查下go的env环境变量  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go env</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>GoLang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>go</tag>
        <tag>go安装</tag>
      </tags>
  </entry>
  <entry>
    <title>python Image Library安装体验</title>
    <url>/posts/145.html</url>
    <content><![CDATA[<p>PIL是python理想的图片处理module，没安装该模块时会提示：ImportError: No module named Image，以下是PIL安装的依赖和步骤</p>
<p>我的环境：CentOS 6.5 / Python2.7</p>
<p><strong>第一步：安装zlib png</strong> <strong>freetype</strong> **  jpeg**</p>
<p>安装zlib：<a href="http://zlib.net/zlib-1.2.8.tar.gz" target="_blank" rel="noopener">http://zlib.net/zlib-1.2.8.tar.gz</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar -xvzf zlib-1.2.8.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> zlib-1.2.8</span><br><span class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p>安装png：<a href="ftp://ftp.simplesystems.org/pub/libpng/png/src/libpng15/libpng-1.5.23.tar.gz">ftp://ftp.simplesystems.org/pub/libpng/png/src/libpng15/libpng-1.5.23.tar.gz</a> (如果文件不存在就浏览 /src/目录查找一下最新版)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar -xvzf libpng-1.5.23.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> libpng-1.5.23</span><br><span class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p>安装freetype：<a href="http://nchc.dl.sourceforge.net/project/freetype/freetype2/2.4.7/freetype-2.4.7.tar.gz" target="_blank" rel="noopener">http://nchc.dl.sourceforge.net/project/freetype/freetype2/2.4.7/freetype-2.4.7.tar.gz</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar -xvzf freetype-2.4.7.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> freetype-2.4.7/</span><br><span class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p>安装jpeg：<a href="http://www.ijg.org/files/jpegsrc.v8c.tar.gz" target="_blank" rel="noopener">http://www.ijg.org/files/jpegsrc.v8c.tar.gz</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar -xvzf jpegsrc.v8c.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> jpeg-8c/</span><br><span class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<p><strong>第二步：安装需要的 devel库（该步视情况可忽略）</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ yum install libjpeg8-dev</span><br><span class="line">$ yum install libpng12-dev</span><br><span class="line">$ yum install libfreetype6-dev</span><br><span class="line">$ yum install zlib1g-dev</span><br></pre></td></tr></table></figure>
<p><strong>第三步：安装 PIL（ Python Imaging Library</strong> <strong>）</strong></p>
<p>安装Image Library：<a href="http://effbot.org/downloads/Imaging-1.1.7.tar.gz" target="_blank" rel="noopener">http://effbot.org/downloads/Imaging-1.1.7.tar.gz</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ tar -xvzf Imaging-1.1.7.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> Imaging-1.1.7/</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改setup.py文件</span></span><br><span class="line">vi setup.py</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改如下：</span></span><br><span class="line">JPEG_ROOT = <span class="string">"/usr/local/lib"</span></span><br><span class="line">ZLIB_ROOT = <span class="string">"/usr/local/lib"</span></span><br><span class="line">FREETYPE_ROOT = <span class="string">"/usr/local/lib"</span></span><br></pre></td></tr></table></figure>
<p>检查是否支持</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ python setup.py build_ext -i</span><br><span class="line"></span><br><span class="line"> running build_ext</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">PIL 1.1.7 SETUP SUMMARY</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">version       1.1.7</span><br><span class="line">platform      linux2 2.7.8 (default, Sep  5 2014, 10:24:17)</span><br><span class="line">              [GCC 4.4.7 20120313 (Red Hat 4.4.7-4)]</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">*** TKINTER support not available</span><br><span class="line">--- JPEG support available</span><br><span class="line">--- ZLIB (PNG/ZIP) support available</span><br><span class="line">--- FREETYPE2 support available</span><br><span class="line">*** LITTLECMS support not available</span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line">To add a missing option, make sure you have the required</span><br><span class="line">library, and <span class="built_in">set</span> the corresponding ROOT variable <span class="keyword">in</span> the</span><br><span class="line">setup.py script.</span><br><span class="line"></span><br><span class="line">To check the build, run the selftest.py script.</span><br></pre></td></tr></table></figure>
<p>开始安装Image Library</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ python setup.py build</span><br><span class="line">$ python setup.py install</span><br></pre></td></tr></table></figure>
<p>Python代码验证</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ python selftest.py</span><br><span class="line">*** The _imaging C module is not installed</span><br></pre></td></tr></table></figure>
<p>ps:<br>运行python selftest.py提示The _imaging C module is not installed</p>
<p>解决方法，实际根据自己的python PIL路径设置</p>
<p>$ echo ‘/usr/local/lib/python2.7/site-packages/PIL’ &gt;&gt; /etc/ld.so.conf<br>$ ldconfig</p>
<p>重新python selftest.py，一路安装完成。</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>PIL</tag>
        <tag>py</tag>
      </tags>
  </entry>
  <entry>
    <title>node多版本管理</title>
    <url>/posts/142.html</url>
    <content><![CDATA[<p>nvm与Python的virtualenv和Ruby的rvm类似。<br>NVM (Node Version Manager，Node多版本管理器)是一个通用的叫法,它目前有许多不同的实现。通常我们说的 nvm 是指 <a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">https://github.com/creationix/nvm</a> 或者 <a href="https://github.com/visionmedia/n" target="_blank" rel="noopener">https://github.com/visionmedia/n</a> 。这两个工具都是使用shell编写的。</p>
<p><strong>n</strong></p>
<p><strong>安装</strong></p>
<p>如果已经安装了npm的话，可以直接执行命令进行安装n :</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ npm install -g n</span><br></pre></td></tr></table></figure>
<p>或者是直接获取源代码安装：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/visionmedia/n.git</span><br><span class="line">$ <span class="built_in">cd</span> n</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>直接运行 n 命令查看所有已安装的版本。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ n</span><br></pre></td></tr></table></figure>
<p>运行命令 n 进行安装指定版本的node。 version 可以是 stable(最新稳定版)、latest(最新版)或者具体的版本数字。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ n stable</span><br><span class="line">install : v0.10.24</span><br><span class="line">mkdir : /usr/<span class="built_in">local</span>/n/versions/0.10.24</span><br><span class="line">fetch : http://nodejs.org/dist/v0.10.24/node-v0.10.24-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>
<p>指定的版本将会安装在 /usr/local/n/versions 目录下。<br>运行命令 n rm 删除已安装指定版本的node。<br>运行命令 n use 选择使用指定版本的node。</p>
<p><strong>nvm(推荐使用)</strong></p>
<p><a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">nvm</a>全称Node Version Manager，它与<code>n</code>的实现方式不同，其是通过shell脚本实现的。</p>
<p><strong>安装</strong></p>
<p>安装方式有两种：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#增外使用</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/creationix/nvm.git ~/.nvm</span><br><span class="line">$ <span class="built_in">source</span> ~/.nvm/nvm.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#墙内使用</span></span><br><span class="line">$ curl -fsSL https://gitee.com/sdq/nvm/raw/master/install.sh | bash</span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#增外使用</span></span><br><span class="line">$ wget -qO- https://raw.githubusercontent.com/creationix/nvm/master/install.sh | sh</span><br><span class="line">$ <span class="built_in">source</span> ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#墙内使用</span></span><br><span class="line">$ curl -fsSL https://gitee.com/sdq/nvm/raw/master/install.sh | bash</span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>以上脚本会把<code>nvm</code>库clone到<code>~/.nvm</code>，然后会在<code>~/.bash_profile</code>, <code>~/.zshrc</code>或<code>`~/.profile</code>末尾添加source，安装完成之后，你可以用以下命令来安装node</p>
<p><strong>使用</strong></p>
<p>查看已安装的版本：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ nvm ls</span><br></pre></td></tr></table></figure>
<p>查看可以安装的版本：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ nvm ls-remote</span><br></pre></td></tr></table></figure>
<p>安装指定的版本：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ nvm install &lt;version&gt;</span><br></pre></td></tr></table></figure>
<p>指定的版本将会直接安装在 nvm 程序所在的目录下。</p>
<p>删除指定的版本：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ nvm uninstall &lt;version&gt;</span><br></pre></td></tr></table></figure>
<p>使用选定的版本：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ nvm use &lt;version&gt;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
        <tag>多版本管理</tag>
      </tags>
  </entry>
  <entry>
    <title>Zero downtime Node.js reloads with clusters</title>
    <url>/posts/120.html</url>
    <content><![CDATA[<p>Unlike PHP and other more traditional web applications, a Node.js server is just that–the server itself. Which means when we write a web application in Node.js, we’re creating a server application that is loaded into memory, and handles requests from there. If the source files change, the application does not, because it’s already been loaded into memory. In order to update the application with new code, the server has to be restarted.</p>
<p>This becomes a little challenging when the goal is to run a server cleanly with no downtime. If we reboot the Node server, we kill all existing connections, have a period of downtime, and then a fresh instance starts, ready to handle connections. That’s not going to fly in production.</p>
<p>There are ways to prevent this, though. <a href="https://github.com/LearnBoost/up" target="_blank" rel="noopener">Up</a>, for example, acts as a intermediate between your application and the request, which allows changes to be gracefully reloaded. It’s nice, but a little heavier than I’d like, and doesn’t play nicely with <a href="http://nodejs.org/api/cluster.html" target="_blank" rel="noopener">Node clusters</a>. Besides, I thought figuring out how to handle this myself would make a good learning experience.</p>
<p>Fortunately, the cluster module has a <em>disconnect</em> event, which allows us to gracefully end the worker process. It will stop handling new requests, and the process will exit once the current requests are finished. That’s perfect.</p>
<p>Here’s an example of what I cooked up. We’ll start with a separate app.js file; it’s important that the application code and clustering code be separate.</p>
<p>app.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line">     http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,rep</span>) </span>&#123;</span><br><span class="line">     rep.writeHead(<span class="number">200</span>);</span><br><span class="line">     rep.write(<span class="string">"Hello, world!"</span>);</span><br><span class="line">     rep.end();</span><br><span class="line"> &#125;).listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure>
<p>This is our application. It can do whatever we want, but I’m keeping it simple for my testing purposes.</p>
<p>Next, we need a master process to handle the clustering and worker respawns.</p>
<p>runner.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// fork as many times as we have CPUs</span></span><br><span class="line"><span class="keyword">var</span> numCPUs = <span class="built_in">require</span>(<span class="string">"os"</span>).cpus().length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) &#123;</span><br><span class="line">    cluster.fork();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// handle unwanted worker exits</span></span><br><span class="line">cluster.on(<span class="string">"exit"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">worker, code</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (code != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Worker crashed! Spawning a replacement."</span>);</span><br><span class="line">        cluster.fork();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// I'm using the SIGUSR2 signal to listen for reload requests</span></span><br><span class="line"><span class="comment">// you could, instead, use file watcher logic, or anything else</span></span><br><span class="line">process.on(<span class="string">"SIGUSR2"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"SIGUSR2 received, reloading workers"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete the cached module, so we can reload the app</span></span><br><span class="line">    <span class="keyword">delete</span> <span class="built_in">require</span>.cache[<span class="built_in">require</span>.resolve(<span class="string">"./app"</span>)];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// only reload one worker at a time</span></span><br><span class="line">    <span class="comment">// otherwise, we'll have a time when no request handlers are running</span></span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> workers = <span class="built_in">Object</span>.keys(cluster.workers);</span><br><span class="line">    <span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i == workers.length) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Killing "</span> + workers[i]);</span><br><span class="line">        cluster.workers[workers[i]].disconnect();</span><br><span class="line">        cluster.workers[workers[i]].on(<span class="string">"disconnect"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Shutdown complete"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">var</span> newWorker = cluster.fork();</span><br><span class="line">        newWorker.on(<span class="string">"listening"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Replacement worker online."</span>);</span><br><span class="line">            i++;</span><br><span class="line">            f();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    f();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Make sense? I’ll break it down a little bit. We fork, per the <a href="http://nodejs.org/api/cluster.html" target="_blank" rel="noopener">cluster example</a>. In all the non-master threads (the forked children), we load our separate application. Then, if the master process receives a SIGUSR2 signal, we delete the cache of our application module, retrieve a list of active worker ids, and disconnect them one by one. We do this to ensure that there is never a situation where we go below the threshold of optimal worker threads, or worse, reach a point where no workers are running. We then load a replacement worker, and repeat the process until all of the old workers have been told to disconnect.</p>
<p>It’s a little rough, but it works. To test it, I run the application server, and hit it with an apachebench with 100,000 requests at 1000 concurrency to check for failed requests.</p>
<p>Beautiful. I can now integrate this into my post-update git hook for use in deployment.</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>graceful</tag>
        <tag>nodejs</tag>
        <tag>Zero downtime</tag>
      </tags>
  </entry>
  <entry>
    <title>利用Ffmpeg获得flv视频缩略图和视频长度时间</title>
    <url>/posts/119.html</url>
    <content><![CDATA[<p>获得flv视频的缩略图和视频时间长度，php代码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BigEndian2Int</span><span class="params">($byte_word, $signed = false)</span> </span>&#123;</span><br><span class="line">    $int_value = <span class="number">0</span>;</span><br><span class="line">    $byte_wordlen = strlen($byte_word);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $byte_wordlen; $i++) &#123;</span><br><span class="line">        $int_value += ord($byte_word&#123;$i&#125;) * pow(<span class="number">256</span>, ($byte_wordlen - <span class="number">1</span> - $i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($signed) &#123;</span><br><span class="line">        $sign_mask_bit = <span class="number">0x80</span> &lt;&lt; (<span class="number">8</span> * ($byte_wordlen - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span> ($int_value &amp; $sign_mask_bit) &#123;</span><br><span class="line">            $int_value = <span class="number">0</span> - ($int_value &amp; ($sign_mask_bit - <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $int_value;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//获得视频的数字时间</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTime</span><span class="params">($name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($name))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $flv_data_length=filesize($name);</span><br><span class="line">    $fp = @fopen($name, <span class="string">'rb'</span>);</span><br><span class="line">    $flv_header = fread($fp, <span class="number">5</span>);</span><br><span class="line">    fseek($fp, <span class="number">5</span>, SEEK_SET);</span><br><span class="line">    $frame_size_data_length =BigEndian2Int(fread($fp, <span class="number">4</span>));</span><br><span class="line">    $flv_header_frame_length = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">if</span> ($frame_size_data_length &gt; $flv_header_frame_length) &#123;</span><br><span class="line">        fseek($fp, $frame_size_data_length - $flv_header_frame_length, SEEK_CUR);</span><br><span class="line">    &#125;</span><br><span class="line">    $duration = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((ftell($fp) + <span class="number">1</span>) &lt; $flv_data_length) &#123;</span><br><span class="line">        $this_tag_header = fread($fp, <span class="number">16</span>);</span><br><span class="line">        $data_length = BigEndian2Int(substr($this_tag_header, <span class="number">5</span>, <span class="number">3</span>));</span><br><span class="line">        $timestamp = BigEndian2Int(substr($this_tag_header, <span class="number">8</span>, <span class="number">3</span>));</span><br><span class="line">        $next_offset = ftell($fp) - <span class="number">1</span> + $data_length;</span><br><span class="line">        <span class="keyword">if</span> ($timestamp &gt; $duration) &#123;</span><br><span class="line">            $duration = $timestamp;</span><br><span class="line">        &#125;</span><br><span class="line">        fseek($fp, $next_offset, SEEK_SET);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose($fp);</span><br><span class="line">    <span class="keyword">return</span> $duration;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//转化为0：03：56的时间格式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span><span class="params">($time)</span></span>&#123;</span><br><span class="line">    $num = $time;</span><br><span class="line">    $sec = intval($num/<span class="number">1000</span>);</span><br><span class="line">    $h = intval($sec/<span class="number">3600</span>);</span><br><span class="line">    $m = intval(($sec%<span class="number">3600</span>)/<span class="number">60</span>);</span><br><span class="line">    $s = intval(($sec%<span class="number">60</span>));</span><br><span class="line">    $tm = $h.<span class="string">':'</span>.$m.<span class="string">':'</span>.$s;</span><br><span class="line">    <span class="keyword">return</span> $tm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$t = getTime(<span class="string">"22.flv"</span>);<span class="comment">//显示数字时间如236722</span></span><br><span class="line"><span class="keyword">echo</span> fn($t);<span class="comment">//显示时间格式0:03:56</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>ffmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title>go语言的协程和通道通信</title>
    <url>/posts/117.html</url>
    <content><![CDATA[<p>许式伟的《go语言编程》，有一个简单的例子，描述go协程和通信通道chan。挺优美的。如下：  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]$ cat sum.go</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">func sum(values []int, myChan chan int) &#123;</span><br><span class="line"> sum := 0</span><br><span class="line"> <span class="keyword">for</span> _, value := range values &#123;</span><br><span class="line"> sum += value</span><br><span class="line"> &#125;</span><br><span class="line"> myChan &lt;- sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"> myChan := make(chan int, 2)</span><br><span class="line"></span><br><span class="line"> values := []int&#123;1, 2, 3, 5, 5, 4&#125;</span><br><span class="line"> go sum(values, myChan)     //协程1</span><br><span class="line"> go sum(values[:3], myChan) //协程2</span><br><span class="line"></span><br><span class="line"> sum1, sum2 := &lt;-myChan, &lt;-myChan</span><br><span class="line"> fmt.Println(<span class="string">"Result:"</span>, sum1, sum2, sum1+sum2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]$ go run sum.go</span><br><span class="line">Result: 6 20 26</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>GoLang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>go</tag>
        <tag>协程</tag>
      </tags>
  </entry>
  <entry>
    <title>SVN 无法通过windows installer服务安装此安装程序包</title>
    <url>/posts/116.html</url>
    <content><![CDATA[<p>xp sp3系统，当安装SVN客户端时出现问题</p>
<p>当安装 TortoiseSVN 1.8** 版本的时候</p>
<p>出现“无法通过 windows installer 服务安装此安装程序包。您必须安装带有更新版本 Windows Installer 服务的 Windows Service Pack ”提示如何解决？</p>
<p>在网上搜集了好久，有好多人出现了同样的问题，所以记录下来</p>
<p>点击下载： <a href="http://www.microsoft.com/zh-cn/download/confirmation.aspx?id=8483" target="_blank" rel="noopener">http://www.microsoft.com/zh-cn/download/confirmation.aspx?id=8483</a></p>
<p>下载补丁 WindowsXP-KB942288-v3-x86.exe ， 重启电脑就可以安装了</p>
]]></content>
      <categories>
        <category>开发工具</category>
      </categories>
      <tags>
        <tag>svn</tag>
      </tags>
  </entry>
  <entry>
    <title>对zeroMQ的认识</title>
    <url>/posts/115.html</url>
    <content><![CDATA[<p>今天正式的去了理了下zmq这个传说是史上最快的消息队列，之前一直认为是个“服务”程序，是个类似于Socket的一系列接口，他跟Socket的区别是：普通的socket是端到端的（1:1的关系），而ZMQ却是可以N：M 的关系可以任意组合。上一段nodejs中使用zmq的官方例子</p>
<p>1、producer.js  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> zmq = <span class="built_in">require</span>(<span class="string">'zmq'</span>)</span><br><span class="line">, sock = zmq.socket(<span class="string">'push'</span>);<span class="xml"><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">sock.bindSync(<span class="string">'tcp://127.0.0.1:3000'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Producer bound to port 3000'</span>);</span><br><span class="line"></span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'sending work'</span>);</span><br><span class="line">sock.send(<span class="string">'some work'</span>);</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
<p>2、worker.js  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> zmq = <span class="built_in">require</span>(<span class="string">'zmq'</span>)</span><br><span class="line">, sock = zmq.socket(<span class="string">'pull'</span>);<span class="xml"><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">sock.connect(<span class="string">'tcp://127.0.0.1:3000'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Worker connected to port 3000'</span>);</span><br><span class="line"></span><br><span class="line">sock.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'work: %s'</span>, msg.toString());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样worker就开始工作了，接收到producer发送的数据</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
        <tag>zeroMQ</tag>
        <tag>zmq</tag>
      </tags>
  </entry>
  <entry>
    <title>centos上安装php-memcached(v2.1.0)</title>
    <url>/posts/111.html</url>
    <content><![CDATA[<p>一、所需软件包</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz  </span><br><span class="line">wget http://pecl.php.net/get/memcached-2.2.0.tgz</span><br></pre></td></tr></table></figure>
<p>二、解压</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar xzf libmemcached-1.0.18.tar.gz  </span><br><span class="line">tar xzf memcached-2.2.0.tgz</span><br></pre></td></tr></table></figure>
<p>三、GCC升级</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install gcc44 gcc44-c++ libstdc++44-devel  </span><br><span class="line"><span class="built_in">export</span> CC=/wp-content/bin/gcc44  </span><br><span class="line"><span class="built_in">export</span> CXX=/wp-content/bin/g++44</span><br></pre></td></tr></table></figure>
<p>提示：yum源更新命令yum update</p>
<p>四、libmemcached安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/libmemcached --with-memcached  </span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>五、memcached扩展安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config --with-libmemcached-dir=/usr/<span class="built_in">local</span>/libmemcached --<span class="built_in">enable</span>-memcached-sasl</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>安装完成</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>libmemcached</tag>
        <tag>php-memcached</tag>
      </tags>
  </entry>
  <entry>
    <title>如何运行一个golang程序为守护进程？</title>
    <url>/posts/109.html</url>
    <content><![CDATA[<p>安装daemonize</p>
<p>1、安装git环境</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install git -y</span><br></pre></td></tr></table></figure>
<p>2、获取daemonize</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://github.com/bmc/daemonize.git</span><br></pre></td></tr></table></figure>
<p>3、安装daemonize</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> daemonize  </span><br><span class="line">./configure  </span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>4、查看是否安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">daemonize -v</span><br></pre></td></tr></table></figure>
<p>通过daemonize执行golang守护进程<br>你需要打包你的golang程序为可执行文件（go build），并通过daemonize来执行它来实现守护进程，如：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">daemonize -p /var/run/myapp.pid -l /var/lock/subsys/myapp -u nobody /path/to/myapp</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>GoLang</category>
      </categories>
      <tags>
        <tag>golang</tag>
        <tag>go</tag>
        <tag>守护进程</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS6.3升级Python到2.7.3版本</title>
    <url>/posts/108.html</url>
    <content><![CDATA[<p>查看python的版本</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python -V</span><br><span class="line">Python 2.6.6</span><br></pre></td></tr></table></figure>
<p>1.下载Python-2.7.3</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget http://python.org/ftp/python/2.7.3/Python-2.7.3.tar.bz2</span><br></pre></td></tr></table></figure>
<p>2.解压Python-2.7.3</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -jxvf Python-2.7.3.tar.bz2</span><br></pre></td></tr></table></figure>
<p>3.进入刚解压后的文件夹(可使用命令)</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> Python-2.7.3</span><br></pre></td></tr></table></figure>
<p>4.安装</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./configure</span><br><span class="line">make all</span><br><span class="line">make install</span><br><span class="line">make clean</span><br><span class="line">make distclean</span><br></pre></td></tr></table></figure>
<p>5.查看版本信息</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/wp-content/<span class="built_in">local</span>/bin/python2.7 -V</span><br></pre></td></tr></table></figure>
<p>6.建立软连接，使系统默认的python指向python2.7<br>正常情况下即使python2.7安装成功后，系统默认指向的python仍然是2.6.6版本，考虑到yum是基于python2.6.6才能正常工作，不敢轻易卸载。</p>
<p>如何实现将系统默认的python指向到2.7版本呢？</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mv /wp-content/bin/python /wp-content/bin/python2.6.6</span><br><span class="line">ln -s /wp-content/<span class="built_in">local</span>/bin/python2.7 /wp-content/bin/python</span><br></pre></td></tr></table></figure>
<p>检验python指向是否成功</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python -V</span><br></pre></td></tr></table></figure>
<p>7.解决系统python软链接指向python2.7版本后，yum不能正常工作</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vi /wp-content/bin/yum</span><br><span class="line">将文件头部的</span><br><span class="line"><span class="comment">#!/wp-content/bin/python</span></span><br><span class="line">改成</span><br><span class="line"><span class="comment">#!/wp-content/bin/python2.6.6</span></span><br></pre></td></tr></table></figure>
<p>整个升级过程完成，可以使用Python2.7.3版本了。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos 测试硬盘读写速度</title>
    <url>/posts/107.html</url>
    <content><![CDATA[<p>time有计时作用，dd用于复制，从if读出，写到of。if=/dev/zero不产生IO，因此可以用来测试纯写速度。同理of=/dev/null不产生IO，可以用来测试纯读速度。bs是每次读或写的大小，即一个块的大小，count是读写块的数量。</p>
<p>1.测/目录所在磁盘的纯写速度：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=1Gb.file bs=1k count=1000000</span><br><span class="line">time sh -c <span class="string">"dd if=/dev/zero of=1Gb.file bs=1k count=1000000; sync"</span></span><br></pre></td></tr></table></figure>
<p>2.测/目录所在磁盘的纯读速度：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=1Gb.file bs=64k |dd of=/dev/null</span><br><span class="line">time sh -c <span class="string">"dd if=1Gb.file bs=64k |dd of=/dev/null; sync"</span></span><br></pre></td></tr></table></figure>
<p>3.测读写速度：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=1Gb.file of=2Gb.file bs=64k</span><br><span class="line">time sh -c <span class="string">"dd if=1Gb.file of=2Gb.file bs=64k; sync"</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>linux</tag>
        <tag>测试硬盘读写</tag>
      </tags>
  </entry>
  <entry>
    <title>发布第一个github代码开源</title>
    <url>/posts/106.html</url>
    <content><![CDATA[<p>很久没写日志了，最近做一个公司项目，用到最近比较火的一门语言<a href="http://www.nodejs.org" target="_blank" rel="noopener">NodeJS</a>用该语言开发相关的功能，这里开源一个用nodejs写的mongodb库，闲话不多说，直接上项目地址。</p>
<p>项目地址：<a href="https://github.com/shideqin/mongodb-lib" target="_blank" rel="noopener">https://github.com/shideqin/mongodb-lib</a></p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
        <tag>github</tag>
        <tag>mongodb</tag>
        <tag>开源</tag>
      </tags>
  </entry>
  <entry>
    <title>php中获取本周/本月的第一天的日期</title>
    <url>/posts/105.html</url>
    <content><![CDATA[<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//本周第一天 </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">weekFirstDay</span>(<span class="params">$time=null</span>) </span>&#123;  </span><br><span class="line">    $time = ($time==<span class="literal">null</span>) ? time() : $time;  </span><br><span class="line">    <span class="keyword">return</span> date(<span class="string">'Y-m-d'</span>, $time<span class="number">-86400</span>*(date(<span class="string">'N'</span>,$time)<span class="number">-1</span>));  </span><br><span class="line">&#125;  </span><br><span class="line"> <span class="comment">//本月第一天  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">monthFirstDay</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> date(<span class="string">'Y-m-d'</span>, mktime(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,date(<span class="string">'n'</span>),<span class="number">1</span>,date(<span class="string">'Y'</span>)));  </span><br><span class="line">&#125;  </span><br><span class="line"> <span class="comment">//本季度第一天  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quarterFirstDay</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> date(<span class="string">'Y-m-d'</span>, mktime(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,date(<span class="string">'n'</span>)-(date(<span class="string">'n'</span>)<span class="number">-1</span>)%<span class="number">3</span>,<span class="number">1</span>,date(<span class="string">'Y'</span>)));  </span><br><span class="line">&#125;  </span><br><span class="line"> <span class="comment">//本年第一天  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yearFirstDay</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> date(<span class="string">'Y'</span>).<span class="string">'-01-01'</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>date</tag>
        <tag>php</tag>
        <tag>时间</tag>
        <tag>本周</tag>
        <tag>本月</tag>
      </tags>
  </entry>
  <entry>
    <title>可代替VI及Nodepad++的产物</title>
    <url>/posts/104.html</url>
    <content><![CDATA[<p>Sublime Text 2 一款优化的代码开发工具，可算是一款小型的IDE工具，支持WIN,MAC,LINUX等操作系统，有丰富的工具包，可以通过Package管理工具进行各种扩展包安装，类似Eclipse中的Plug-in，同时该工具免费使用，无须支持免费当然偶尔会有付费提示，可不理会继续使用。</p>
<p>下载地址：<a href="http://www.sublimetext.com/" target="_blank" rel="noopener">http://www.sublimetext.com/</a></p>
<p>汉化语言包：<a href="http://download.csdn.net/detail/shisdq/4398263" target="_blank" rel="noopener">http://download.csdn.net/detail/shisdq/4398263</a></p>
<p>注册补丁下载：<a href="http://download.csdn.net/detail/shisdq/4398223" target="_blank" rel="noopener">http://download.csdn.net/detail/shisdq/4398223</a></p>
<p>注：文章中提供相关的工具，如有涉及到版权等相关问题均与作者无关，只做测试使用，禁止传播！</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>开发工具</category>
      </categories>
      <tags>
        <tag>nodepad++</tag>
        <tag>Sublime Text 2</tag>
        <tag>text</tag>
        <tag>vi</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML中自定义属性,与自定义事件...</title>
    <url>/posts/103.html</url>
    <content><![CDATA[<p>此种技术一般使用在大型的UI系统开发中: 主要用于核心开发者了为了让 各类普通开发人员能方便调用自己的方法(事件).. 下面是相关示例: 核心开发者,负责拖动事件的JS书写.. 普通开发人员或者美工,只需制作HTML排版…并加上 核心开发者定义的自定义属性后,就能实现拖动. 微软IE中的document.attachEvent为我们提供了良好的自定义事件能力.. 本实例中的自定义属性为:eDrag 通过自定义属性来激活自定义事件.. </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> __DragId, __eDragSrc, __DragTop, __DragLeft;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__OnDrag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> _element = event.srcElement;</span><br><span class="line">	<span class="keyword">if</span>(_element.eDrag)&#123;</span><br><span class="line">		<span class="keyword">if</span>(event.type==<span class="string">"mousedown"</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(_element.eDragSrc)&#123;</span><br><span class="line">				__eDragSrc = <span class="built_in">document</span>.getElementById(_element.eDragSrc);</span><br><span class="line">				__eDragSrc.style.display = <span class="string">"block"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">document</span>.body.style.cursor = <span class="string">"default"</span>;</span><br><span class="line">			__DragId = <span class="built_in">document</span>.getElementById(_element.eDrag);</span><br><span class="line">			__DragLeft = <span class="built_in">parseInt</span>(__DragId.offsetWidth)-(<span class="built_in">parseInt</span>(__DragId.offsetWidth)-(event.x-<span class="built_in">parseInt</span>(__DragId.offsetLeft)));</span><br><span class="line">			__DragTop = <span class="built_in">parseInt</span>(__DragId.offsetHeight)-(<span class="built_in">parseInt</span>(__DragId.offsetHeight)-(event.y-<span class="built_in">parseInt</span>(__DragId.offsetTop)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(event.type==<span class="string">"mouseup"</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(__DragId)&#123;</span><br><span class="line">				__DragId = <span class="literal">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(__eDragSrc)&#123;</span><br><span class="line">				__eDragSrc.style.display = <span class="string">"none"</span>;</span><br><span class="line">				__eDragSrc = <span class="literal">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(event.type==<span class="string">"mousemove"</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(__DragId)&#123;</span><br><span class="line">			__DragId.style.top = event.y - __DragTop;</span><br><span class="line">			__DragId.style.left = event.x - __DragLeft;</span><br><span class="line">			__DragId.style.margin = <span class="string">"auto"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.attachEvent(<span class="string">"onmousedown"</span>, __OnDrag);</span><br><span class="line"><span class="built_in">document</span>.attachEvent(<span class="string">"onmousemove"</span>, __OnDrag);</span><br><span class="line"><span class="built_in">document</span>.attachEvent(<span class="string">"onmouseup"</span>, __OnDrag);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>event</tag>
        <tag>html</tag>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>那些相见恨晚的 JavaScript 技巧</title>
    <url>/posts/87.html</url>
    <content><![CDATA[<p>JavaScript 的成功让人津津乐道，为 Web 网页编写 JavaScript 代码已经是所有 Web 设计师的基本功，这门有趣的语言蕴藏着许多不为人熟知的东西，即使多年的 JavaScript 程序员，也未能完全吃透。本文从7个方面讲述 JavaScript 中那些你不很熟知但非常实用的技巧。</p>
<p>简略语句<br>JavaScript 可以使用简略语句快速创建对象和数组，比如下面的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> car = <span class="keyword">new</span> <span class="built_in">Object</span>();  </span><br><span class="line">car.colour = <span class="string">'red'</span>;  </span><br><span class="line">car.wheels = <span class="number">4</span>;  </span><br><span class="line">car.hubcaps = <span class="string">'spinning'</span>;  </span><br><span class="line">car.age = <span class="number">4</span>;</span><br></pre></td></tr></table></figure>
<p>可以使用简略语句如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> car = &#123;</span><br><span class="line">   colour:<span class="string">'red'</span>,</span><br><span class="line">   wheels:<span class="number">4</span>,</span><br><span class="line">   hubcaps:<span class="string">'spinning'</span>,</span><br><span class="line">   age:<span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对象 car 就此创建，不过需要特别注意，结束花括号前一定不要加 “;” 否则在 IE 会遇到很大麻烦。  </p>
<p>创建数组的传统方法是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> moviesThatNeedBetterWriters = <span class="keyword">new</span> <span class="built_in">Array</span>(</span><br><span class="line">  <span class="string">'Transformers'</span>,<span class="string">'Transformers2'</span>,<span class="string">'Avatar'</span>,<span class="string">'Indiana Jones 4'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>使用简略语句则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> moviesThatNeedBetterWriters = [</span><br><span class="line">  <span class="string">'Transformers'</span>,<span class="string">'Transformers2'</span>,<span class="string">'Avatar'</span>,<span class="string">'Indiana Jones 4'</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>另一个可以使用简略语句的地方是条件判断语句：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> direction;  </span><br><span class="line"><span class="keyword">if</span>(x &lt; <span class="number">200</span>)&#123;   direction = <span class="number">1</span>; &#125; <span class="keyword">else</span> &#123;   direction = <span class="number">-1</span>; &#125;</span><br></pre></td></tr></table></figure>
<p>可以简略为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> direction = x &lt; <span class="number">200</span> ? <span class="number">1</span> : <span class="number">-1</span>;</span><br></pre></td></tr></table></figure>
<p>JSON 数据格式<br>JSON 是 “JavaScript Object Notation” 的缩写，由 Douglas Crockford 设计，JSON 改变了 JavaScript 在缓存复杂数据格式方面的困境，如下例，假如你要描述一个乐队，可以这样写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> band = &#123;  </span><br><span class="line">   <span class="string">"name"</span>:<span class="string">"The Red Hot Chili Peppers"</span>,  </span><br><span class="line">   <span class="string">"members"</span>:[  </span><br><span class="line">     &#123;  </span><br><span class="line">       <span class="string">"name"</span>:<span class="string">"Anthony Kiedis"</span>,  </span><br><span class="line">       <span class="string">"role"</span>:<span class="string">"lead vocals"</span>  </span><br><span class="line">     &#125;,  </span><br><span class="line">     &#123;  </span><br><span class="line">       <span class="string">"name"</span>:<span class="string">"Michael 'Flea' Balzary"</span>,  </span><br><span class="line">       <span class="string">"role"</span>:<span class="string">"bass guitar, trumpet, backing vocals"</span>  </span><br><span class="line">     &#125;,  </span><br><span class="line">     &#123;  </span><br><span class="line">       <span class="string">"name"</span>:<span class="string">"Chad Smith"</span>,  </span><br><span class="line">       <span class="string">"role"</span>:<span class="string">"drums,percussion"</span>  </span><br><span class="line">     &#125;,  </span><br><span class="line">     &#123;  </span><br><span class="line">       <span class="string">"name"</span>:<span class="string">"John Frusciante"</span>,  </span><br><span class="line">       <span class="string">"role"</span>:<span class="string">"Lead Guitar"</span>  </span><br><span class="line">     &#125;  </span><br><span class="line">   ],  </span><br><span class="line">   <span class="string">"year"</span>:<span class="string">"2009"</span>  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>你可以在 JavaScript 中直接使用 JSON，甚至作为某些 API 的返回数据对象，以下代码调用著名书签网站 delicious.com 的一个 API，返回你在该网站的所有书签，并显示在你自己的网站：</p>
<p>JavaScript 本地函数 (Math, Array 和 String)<br>JavaScript 有很多内置函数，有效的使用，可以避免很多不必要的代码，比如，从一个数组中找出最大值，传统的方法是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">3</span>,<span class="number">342</span>,<span class="number">23</span>,<span class="number">22</span>,<span class="number">124</span>];  </span><br><span class="line"><span class="keyword">var</span> max = <span class="number">0</span>;  </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;numbers.length;i++)&#123;  </span><br><span class="line">  <span class="keyword">if</span>(numbers[i]=<span class="string">""</span>&gt; max)&#123;  </span><br><span class="line">    max = numbers[i];  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">alert(max);</span><br></pre></td></tr></table></figure>
<p>使用内置函数可以更容易实现：  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">3</span>,<span class="number">342</span>,<span class="number">23</span>,<span class="number">22</span>,<span class="number">124</span>];  </span><br><span class="line">numbers.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;<span class="keyword">return</span> b - a&#125;);  </span><br><span class="line">alert(numbers[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
<p>另一个方法是使用 Math.max() 方法：  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>.max(<span class="number">12</span>,<span class="number">123</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">433</span>,<span class="number">4</span>); <span class="comment">// returns 433</span></span><br></pre></td></tr></table></figure>
<p>你可以用这个方法帮助探测浏览器</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> scrollTop= <span class="built_in">Math</span>.max(  </span><br><span class="line"> doc.documentElement.scrollTop,  </span><br><span class="line"> doc.body.scrollTop  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>这解决了 IE 浏览器的一个问题，通过这种方法，你总是可以找到那个正确的值，因为浏览器不支持的那个值会返回 undefined。</p>
<p>还可以使用 JavaScript 内置的 split() 和 join() 函数处理 HTML 对象的 CSS 类名，如果 HTML 对象的类名是空格隔开的多个名字，你在为它追加或删除一个 CSS 类名的时候需要特别注意，如果该对象还没有类名属性，可以直接将新的类名赋予它，如果已经存在类名，新增的类名前必须有一个空格，用传统的 JavaScript 方法是这样实现的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addclass</span>(<span class="params">elm,newclass</span>)</span>&#123;  </span><br><span class="line">  <span class="keyword">var</span> c = elm.className;  </span><br><span class="line">  elm.className = (c === <span class="string">''</span>) ? newclass : c+<span class="string">' '</span>+newclass;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 split 和 join 方法则直观优雅得多：  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addclass</span>(<span class="params">elm,newclass</span>)</span>&#123;  </span><br><span class="line">  <span class="keyword">var</span> classes = elm.className.split(<span class="string">' '</span>);  </span><br><span class="line">  classes.push(newclass);  </span><br><span class="line">  elm.className = classes.join(<span class="string">' '</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事件代理<br>与其在 HTML 文档中设计一堆事件，不如直接设计一个事件代理，举例说明，假如你有一些链接，用户点击后不想打开链接，而是执行某个事件，HTML 代码如下：</p>
<h2 id="Great-Web-resources"><a href="#Great-Web-resources" class="headerlink" title="Great Web resources"></a>Great Web resources</h2><ul>
<li><a href="http://opera.com/wsc" target="_blank" rel="noopener">Opera Web Standards Curriculum</a></li>
<li><a href="http://sitepoint.com" target="_blank" rel="noopener">Sitepoint</a></li>
<li><a href="http://alistapart.com" target="_blank" rel="noopener">A List Apart</a></li>
<li><a href="http://yuiblog.com" target="_blank" rel="noopener">YUI Blog</a></li>
<li><a href="http://blameitonthevoices.com" target="_blank" rel="noopener">Blame it on the voices</a></li>
<li><a href="http://oddlyspecific.com" target="_blank" rel="noopener">Oddly specific</a></li>
</ul>
<p>使用事件代理，可以直接处理，无需遍历：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> resources = <span class="built_in">document</span>.getElementById(<span class="string">'resources'</span>);</span><br><span class="line">   resources.addEventListener(<span class="string">'click'</span>,handler,<span class="literal">false</span>);</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">var</span> x = e.target; <span class="comment">// get the link tha</span></span><br><span class="line">     <span class="keyword">if</span>(x.nodeName.toLowerCase() === <span class="string">'a'</span>)&#123;</span><br><span class="line">       alert(<span class="string">'Event delegation:'</span> + x);</span><br><span class="line">       e.preventDefault();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;;</span><br><span class="line"> &#125;)();</span><br></pre></td></tr></table></figure>
<p>匿名函数与 Module 模式<br>JavaScript 的一个问题是，任何变量，函数或是对象，除非是在某个函数内部定义，否则，就是全局的，意味着同一网页的别的代码可以访问并改写这个变量（ECMA 的 JavaScript 5 已经改变了这一状况 - 译者），使用匿名函数，你可以绕过这一问题。</p>
<p>比如，你有这样一段代码，很显然，变量 name, age, status 将成为全局变量</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'Chris'</span>;  </span><br><span class="line"><span class="keyword">var</span> age = <span class="string">'34'</span>;  </span><br><span class="line"><span class="keyword">var</span> status = <span class="string">'single'</span>;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMember</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">  <span class="comment">// [...]  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMemberDetails</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">  <span class="comment">// [...]  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了避免这一问题，你可以使用匿名函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">var</span> myApplication = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'Chris'</span>;  </span><br><span class="line">  <span class="keyword">var</span> age = <span class="string">'34'</span>;  </span><br><span class="line">  <span class="keyword">var</span> status = <span class="string">'single'</span>;  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createMember</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="comment">// [...]  </span></span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getMemberDetails</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="comment">// [...]  </span></span><br><span class="line">  &#125;  </span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>如果这个函数不会被调用，可以更直接为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'Chris'</span>;  </span><br><span class="line">  <span class="keyword">var</span> age = <span class="string">'34'</span>;  </span><br><span class="line">  <span class="keyword">var</span> status = <span class="string">'single'</span>;  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createMember</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="comment">// [...]  </span></span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getMemberDetails</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="comment">// [...]  </span></span><br><span class="line">  &#125;  </span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>如果要访问其中的对象或函数，可以：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myApplication = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> name = <span class="string">'Chris'</span>;</span><br><span class="line">   <span class="keyword">var</span> age = <span class="string">'34'</span>;</span><br><span class="line">   <span class="keyword">var</span> status = <span class="string">'single'</span>;</span><br><span class="line">   <span class="keyword">return</span>&#123;</span><br><span class="line">     createMember:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="comment">// […]</span></span><br><span class="line">     &#125;,</span><br><span class="line">     getMemberDetails:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="comment">// […]</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;();</span><br><span class="line"> <span class="comment">// myApplication.createMember() and</span></span><br><span class="line"> <span class="comment">// myApplication.getMemberDetails() now works.</span></span><br></pre></td></tr></table></figure>
<p>这就是所谓 Module 模式或单例模式（Singleton），该模式为 Douglas Crockford 所推崇，并被大量应用在 Yahoo User Interface Library YUI。</p>
<p>假如你想在别的地方调用里面的方法，又不想在调用前使用 myApplication 这个对象名，可以在匿名函数中返回这些方法，甚至用简称返回：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myApplication = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> name = <span class="string">'Chris'</span>;</span><br><span class="line">   <span class="keyword">var</span> age = <span class="string">'34'</span>;</span><br><span class="line">   <span class="keyword">var</span> status = <span class="string">'single'</span>;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">createMember</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="comment">// […]</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">getMemberDetails</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="comment">// […]</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span>&#123;</span><br><span class="line">     create:createMember,</span><br><span class="line">     <span class="keyword">get</span>:getMemberDetails</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;();</span><br><span class="line"> //myApplication.<span class="keyword">get</span>() and myApplication.create() now work.</span><br></pre></td></tr></table></figure>
<p>代码配置<br>别人使用你编写的 JavaScript 代码的时候，难免会更改某些代码，但这会很困难，因为不是每个人都很容易读懂别人的代码，与其这样，不如创建一个代码配置对象，别人只需要在这个对象中更改某些配置即可实现代码的更改。这里有一篇 JavaScript 配置对象详解的文章，简单说：</p>
<p>在代码中创建一个叫做 configuration 的对象<br>里面保存所有可以更改的配置，如 CSS ID 和类名，按钮的标签文字，描述性文字，本地化语言设置<br>将该对象设置为全局对象，以便别人直接访问并改写</p>
<p>你应当在最后一步做这项工作，这里有一个文章，交付代码前的5件事值的参考。<br>同后台交互<br>JavaScript 是一门前台语言，你需要别的语言同后台交互，并返回数据，使用 AJAX，你可以让 JavaScript 直接使用同后台的交互，将复杂的数据处理交由后台处理。<br>JavaScript 框架<br>自己编写适应各种浏览器的代码是完全浪费时间，应当选择一个 JavaScript 框架，让这些复杂的事情交给框架处理。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>javascript</tag>
        <tag>技巧</tag>
      </tags>
  </entry>
  <entry>
    <title>计算php运行时间（毫秒数）</title>
    <url>/posts/86.html</url>
    <content><![CDATA[<p>非常简单，记录一下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$begin= explode(<span class="string">' '</span>, microtime());</span><br><span class="line"></span><br><span class="line"><span class="comment">//php script here</span></span><br><span class="line"></span><br><span class="line">$end = explode(<span class="string">' '</span>, microtime());  </span><br><span class="line"><span class="keyword">echo</span> ($end[<span class="number">1</span>]-$begin[<span class="number">1</span>]).<span class="string">'s'</span>.($end[<span class="number">0</span>]-$begin[<span class="number">0</span>]).<span class="string">'ms'</span>;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>microtime()</tag>
        <tag>毫秒</tag>
      </tags>
  </entry>
  <entry>
    <title>通过PATH_INFO的方式来实现搜索引擎友好 隐藏index.php</title>
    <url>/posts/85.html</url>
    <content><![CDATA[<p>我习惯使用PATH_INFO的方式来实现搜索引擎友好，比如：</p>
<p><a href="http://www.xxx.com/index.php/module/xxx/action/xxx/id/xxx" target="_blank" rel="noopener">http://www.xxx.com/index.php/module/xxx/action/xxx/id/xxx</a></p>
<p>但是index.php能看到扩展名很不爽，解决方法如下：</p>
<p>如何隐蔽应用：例如 .php，的扩展名：</p>
<p>在APACHE中这样配置：</p>
<p>ForceType application/x-httpd-php</p>
<p>如何更像静态页面：app_name/my/app.html</p>
<p>解析的PATH_INFO参数的时候，把最后一个参数的最后5个字符“.html”截断即可。</p>
<p>注意：APACHE2中缺省是不允许PATH_INFO的，需要设置 AcceptPathInfo on</p>
<p><a href="http://www.xxx.com/index/module/xxx/action/xxx/id/xxx" target="_blank" rel="noopener">http://www.xxx.com/index/module/xxx/action/xxx/id/xxx</a></p>
]]></content>
      <categories>
        <category>Apache</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>path_info</tag>
        <tag>rewrite</tag>
        <tag>搜索引擎</tag>
      </tags>
  </entry>
  <entry>
    <title>小型关系型数据库 SQLite 3.7.3发布</title>
    <url>/posts/84.html</url>
    <content><![CDATA[<p>SQLite是遵守ACID的关联式数据库管理系统，它包含在一个相对小的C库中。它是D.RichardHipp建立的公有领域项目。</p>
<p>　　该版本增加了 sqlite3_create_function_v2() 接口，用以处理析构器(destructor)的回调;通过使用应用提供的回调函数来定义查询区域的边界以增加对自定义 r-tree 查询;默认的页缓存努力避免内存分配大于预设SQLITE_CONFIG_PAGECACHE的值等。</p>
<p>下载地址:<a href="http://www.sqlite.org/download.html" target="_blank" rel="noopener">http://www.sqlite.org/download.html</a></p>
]]></content>
      <categories>
        <category>PHP</category>
        <category>数据库篇</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>sql</tag>
        <tag>sqlite</tag>
      </tags>
  </entry>
  <entry>
    <title>Win下PHP支持Sqlite</title>
    <url>/posts/82.html</url>
    <content><![CDATA[<p>SQLite 是个使用档案方式存储的 Database,不需要另外安装如 MySQL 之类的 Server,而且 PHP 5 已经將 SQLite 內建了,相当好用,在某些方面效能比起其他 Database 系统有过之而无不及.目前国內很少人知道.<br>SQLite 在 windows 的安裝方式:<br>PHP 4 版本<br>1.下載 php_sqlite.dll(注意版本号),复制到 php/exetensions/ 下<br>2.php.ini 加上 extension=php_sqlite.dll<br>3.重新启动 Web Server 即可<br>PHP 5 版本<br>PHP 5 已经包含 SQLite 模组了,所以只需要载入模组即可<br>修改 php.ini 找到 ;extension=php_sqlite.dll 将前面的分号去掉<br>目前测试结果在 PHP 5.1.1 和 5.1.2 只有这样是运行不起來的,必須连 pdo 一起启动,所以在前<br>面增加兩行:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">extension</span>=php_pdo.dll  </span><br><span class="line"><span class="attr">extension</span>=php_pdo_sqlite.dll  </span><br><span class="line"><span class="attr">extension</span>=php_sqlite.dll</span><br></pre></td></tr></table></figure>
<p>重新启动 Web Server 即可<br>注明:PHP Version 5.1.6也有这样的问题.</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>php_sqlite.dll</tag>
        <tag>sqlite</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP 中 error_reporting(0) 详解</title>
    <url>/posts/81.html</url>
    <content><![CDATA[<p>error_reporting(255);</p>
<p>是列出所以提示</p>
<p>error_reporting(0);</p>
<p>是不显示所以提示<br>建议使用</p>
<p>error_reporting(7);</p>
<p>只显示严重错误，显示1，2，4 错误</p>
<p>1 E_ERROR 致命的运行时错误<br>2 E_WARNING 运行时警告(非致命性错误)<br>4 E_PARSE 编译时解析错误<br>8 E_NOTICE 运行时提醒(经常是bug，也可能是有意的)<br>16 E_CORE_ERROR PHP启动时初始化过程中的致命错误<br>32 E_CORE_WARNING PHP启动时初始化过程中的警告(非致命性错)<br>64 E_COMPILE_ERROR 编译时致命性错<br>128 E_COMPILE_WARNING 编译时警告(非致命性错)<br>256 E_USER_ERROR 用户自定义的致命错误<br>512 E_USER_WARNING 用户自定义的警告(非致命性错误)<br>1024 E_USER_NOTICE 用户自定义的提醒(经常是bug，也可能是有意的)<br>2048 E_STRICT 编码标准化警告(建议如何修改以向前兼容)<br>4096 E_RECOVERABLE_ERROR 接近致命的运行时错误，若未被捕获则视同E_ERROR<br>6143 E_ALL 除E_STRICT外的所有错误(PHP6中为8191,即包含所有)</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>error_reporting</tag>
        <tag>错误详解</tag>
      </tags>
  </entry>
  <entry>
    <title>php利用header函数实现文件下载时直接提示保存</title>
    <url>/posts/78.html</url>
    <content><![CDATA[<p>下面是网上常用的方法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($link)) &#123;</span><br><span class="line">    Header(<span class="string">"HTTP/1.1 303 See Other"</span>);</span><br><span class="line">    Header(<span class="string">"Location: $link"</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注：</strong><br>http响应码<br>http响应码的分布从1xx ~ 5xx, 比较熟悉的有200(OK), 500 (Internal Server Error), 503 (Service Unavailable)等。<br>3xx系列的响应码表示“重定向” (Redirection)， 这里特别分析303 (See Other)，303的rfc2616说明有几点值得我们注意：<br>服务器在返回303的同时，应该(SHOULD)返回一个不同的URI，并放到Location字段中。<br>客户端收到303后，可以使用这个URI获取新的资源（必须使用GET获取新资源）<br>303的响应不能被缓存，但是Get到的新资源是可以被缓存的</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>303</tag>
        <tag>header</tag>
        <tag>HTTP</tag>
        <tag>文件下载</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL大数据导出、导入</title>
    <url>/posts/75.html</url>
    <content><![CDATA[<p>使用MYSQL导入文本内容</p>
<p>使用LOAD DATA INFILE命令</p>
<p>例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">'date.dat'</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure>
<p>具体load data infile命令使用及参数请参考MYSQL手册</p>
<p>注：使用MYSQL导出数据写入文本方法如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'data.txt'</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> <span class="keyword">from</span> <span class="keyword">test</span> ;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>load data</tag>
        <tag>select</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP加密扩展库——Mcrypt扩展库</title>
    <url>/posts/74.html</url>
    <content><![CDATA[<p>PHP除了自带的几种加密函数外，还有功能更全面的加密扩展库Mcrypt和Mhash。其中，Mcrypt扩展库可以实现加密解密功能，就是既能将明文加密，也可以密文还原。<br>1.Mcrypt库安装</p>
<p>在标准的PHP安装过程中并没有把Mrcypt安装上，但PHP的主目录下包含了libmcrypt.dll和libmhash.dll文件(libmhash.dll是Mhash扩展库，这里可以一起装上)。首先，将这两个文件复制到系统目录windows\system32下，然后在PHP.ini文件中按Ctrl+F快捷键跳出查找框，并找到；extension=php-mcrypt.dll和;extension=php_mhash.dll这两个语句，接着将前面的“；”去掉；最后，保存并重启Apache服务器即可生效。</p>
<p>2.Mcrypt库的算法和加密模式</p>
<p>Mcrypt库支持20多种加密算法和8种加密模式，具体可以通过函数mcrypt_list_algorithms()和mcrypt_list_modes()来显示，结果如下：<br>Mcrypt支持的算法有：cast-128 gost rijndael-128 twofish arcfour cast-256 loki97 rijndael-192 saferplus wake blowfish-compat des rijndael-256 serpent xtea blowfish enigma rc2 tripledes<br>Mcrypt支持的加密模式有：cbc cfb ctr ecb ncfb nofb ofb stream<br>这些算法和模式在应用中要以常量来表示，写的时候加上前缀MCRYPT_和MCRYPT_来表示，如下面Mcrypt应用的例子：<br>DES算法表示为MCRYPT_DES;<br>ECB模式表示为MCRYPT_MODE_ECB；</p>
<p>3.Mcrypt应用</p>
<p>先看一个例子，了解Mcrypt的工作流程，再来看看部分流程使用的函数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> $str_encrypt = mcrypt_encrypt($cipher,$key,$str,$modes,$iv);<span class="comment">//加密函数</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"加密密文："</span>.$str_encrypt;</span><br><span class="line"> $str_decrypt = mcrypt_decrypt($cipher,$key,$str_encrypt,$modes,$iv);<span class="comment">//解密函数</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"还原："</span>.$str_decrypt;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p>加密明文：我的名字是？一般人我不告诉他！<br>加密密文： 锍盌?]鸴?q攦軄L 笑 郺葄”簻 黙<br>还原：我的名字是？一般人我不告诉他！</p>
<p>&lt;1&gt;由例子中可看到，使用Mcrypt对数据加密和解密之前，首先创建了一个初始化向量，简称为iv。由$iv = mcrypt_create_iv(mcrypt_get_iv_size($cipher,$modes),MCRYPT_RAND);可见创建初始化向量需要两个参数：size指定了iv的大小；source为iv的源，其中值MCRYPT_RAND为系统随机数。<br>&lt;2&gt;函数mcrypt_get_iv_size($cipher,$modes)返回初始化向量大小，参数cipher和mode分别指算法和加密模式。<br>&lt;3&gt;加密函数$str_encrypt = mcrypt_encrypt($cipher,$key,$str,$modes,$iv); 该函数的5个参数分别如下：cipher——加密算法、key——密钥、data(str)——需要加密的数据、mode——算法模式、iv——初始化向量<br>&lt;4&gt;解密函数mcrypt_decrypt($cipher,$key,$str_encrypt,$modes,$iv); 该函数和加密函数的参数几乎一样，唯一不同的是data，也就是说data为需要解密的数据$str_encrypt，而不是原始数据$str。<br>注：加密和解密函数中的参数cipher、key和mode必须一一对应，否则数据不能被还原。</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>mcrypt</tag>
        <tag>加密解密</tag>
      </tags>
  </entry>
  <entry>
    <title>通过file_get_contents来Post数据的实例[转载]</title>
    <url>/posts/73.html</url>
    <content><![CDATA[<p>原文：</p>
<p>file_get_contents.php: Post数据</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Post</span><span class="params">($url, $post = null)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $context = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">if</span> (is_array($post))</span><br><span class="line">    &#123;</span><br><span class="line">      ksort($post);</span><br><span class="line">      $context[<span class="string">'http'</span>] = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'method'</span> =&gt; <span class="string">'POST'</span>,</span><br><span class="line">        <span class="string">'content'</span> =&gt; http_build_query($post, <span class="string">''</span>, <span class="string">'&amp;'</span>),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> file_get_contents($url, <span class="keyword">false</span>, stream_context_create($context));</span><br><span class="line">&#125;</span><br><span class="line">$data = <span class="keyword">array</span>(</span><br><span class="line">  <span class="string">'name'</span> =&gt; <span class="string">'test'</span>,</span><br><span class="line">  <span class="string">'email'</span> =&gt; <span class="string">'test@gmail.com'</span>,</span><br><span class="line">  <span class="string">'submit'</span> =&gt; <span class="string">'submit'</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> Post(<span class="string">'http://localhost/5-5/request_post_result.php'</span>, $data);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>接收数据：<br>request_post_result.php 接收经过Post的数据：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> $_POST[<span class="string">'name'</span>];</span><br><span class="line"><span class="keyword">echo</span> $_POST[<span class="string">'email'</span>];</span><br><span class="line"><span class="keyword">echo</span> $_POST[<span class="string">'submit'</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"fdfd"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>看一下，里面有一个特别的函数：stream_context_create，翻开手册看了一下，也没说什么呀，只是说：Creates and returns a stream context with any options supplied in options preset.</p>
<p>而file_get_contents呢？它说：</p>
<p>Note: Context support was added with PHP 5.0.0. For a description of contexts, refer to Reference CLX, Stream Functions.</p>
<p>关于Stream Functions，手册上这么描述的。。。</p>
<p>A wrapper is additional code which tells the stream how to handle specific protocols/encodings. For example, the http wrapper knows how to translate a URL into an HTTP/1.0 request for a file on a remote server. There are many wrappers built into PHP by default (See Appendix O), and additional, custom wrappers may be added either within a PHP script using stream_wrapper_register(), or directly from an extension using the API Reference in Chapter 52. Because any variety of wrapper may be added to PHP, there is no set limit on what can be done with them. To access the list of currently registered wrappers, use stream_get_wrappers().</p>
<p>A stream is referenced as: scheme://target<br>scheme(string) - The name of the wrapper to be used. Examples include: file, http, https, ftp, ftps, compress.zlib, compress.bz2, and php. See Appendix O for a list of PHP built-in wrappers. If no wrapper is specified, the function default is used (typically file://).</p>
<p>target - Depends on the wrapper used. For filesystem related streams this is typically a path and filename of the desired file. For network related streams this is typically a hostname, often with a path appended. Again, see Appendix O for a description of targets for built-in streams.</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>file_get_contents</tag>
        <tag>post</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonic八荣八耻</title>
    <url>/posts/71.html</url>
    <content><![CDATA[<p><strong>Pythonic八荣八耻</strong></p>
<p>以动手实践为荣 , 以只看不练为耻;<br>以打印日志为荣 , 以单步跟踪为耻;<br>以空格缩进为荣 , 以制表缩进为耻;<br>以单元测试为荣 , 以人工测试为耻;</p>
<p>以模块复用为荣 , 以复制粘贴为耻;<br>以多态应用为荣 , 以分支判断为耻;<br>以Pythonic为荣 , 以冗余拖沓为耻;<br>以总结分享为荣 , 以跪求其解为耻;</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pythonic</tag>
        <tag>八荣八耻</tag>
      </tags>
  </entry>
  <entry>
    <title>MYSQL 复制表结构及数据</title>
    <url>/posts/70.html</url>
    <content><![CDATA[<p>第一种，适合复制表结构，但不会复制表内容  </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name <span class="keyword">LIKE</span> table_name2</span><br></pre></td></tr></table></figure>
<p>第二种，适合复制表内容，但也会复制表结构(与第一种相比会少一些原始表参数)  </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name <span class="keyword">LIKE</span> table_name2</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>sdq</tag>
        <tag>复制表结构及数据</tag>
      </tags>
  </entry>
  <entry>
    <title>apache下ab网站压力测试命令参数及输出结果的中文注解</title>
    <url>/posts/68.html</url>
    <content><![CDATA[<p>以前安装好APACHE总是不知道该如何测试APACHE的性能，现在总算找到一个测试工具了。就是APACHE自带的测试工具AB(apache benchmark).在APACHE的bin目录下。<br><code>格式： ./ab [options] [http://]hostname[:port]/path</code><br>参数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-n requests Number of requests to perform  </span><br><span class="line">&#x2F;&#x2F;在测试会话中所执行的请求个数。默认时，仅执行一个请求  </span><br><span class="line">-c concurrency Number of multiple requests to make  </span><br><span class="line">&#x2F;&#x2F;一次产生的请求个数。默认是一次一个。  </span><br><span class="line">-t timelimit Seconds to max. wait for responses  </span><br><span class="line">&#x2F;&#x2F;测试所进行的最大秒数。其内部隐含值是-n 50000。它可以使对服务器的测试限制在一个固定的总时间以内。默认时，没有时间限制。  </span><br><span class="line">-p postfile File containing data to POST  </span><br><span class="line">&#x2F;&#x2F;包含了需要POST的数据的文件.  </span><br><span class="line">-T content-type Content-type header for POSTing  </span><br><span class="line">&#x2F;&#x2F;POST数据所使用的Content-type头信息。  </span><br><span class="line">-v verbosity How much troubleshooting info to print  </span><br><span class="line">&#x2F;&#x2F;设置显示信息的详细程度 – 4或更大值会显示头信息， 3或更大值可以显示响应代码(404, 200等), 2或更大值可以显示警告和其他信息。 -V 显示版本号并退出。  </span><br><span class="line">-w Print out results in HTML tables  </span><br><span class="line">&#x2F;&#x2F;以HTML表的格式输出结果。默认时，它是白色背景的两列宽度的一张表。  </span><br><span class="line">-i Use HEAD instead of GET  </span><br><span class="line">&#x2F;&#x2F; 执行HEAD请求，而不是GET。  </span><br><span class="line">-x attributes String to insert as table attributes  </span><br><span class="line">&#x2F;&#x2F;  </span><br><span class="line">-y attributes String to insert as tr attributes  </span><br><span class="line">&#x2F;&#x2F;  </span><br><span class="line">-z attributes String to insert as td or th attributes  </span><br><span class="line">&#x2F;&#x2F;  </span><br><span class="line">-C attribute Add cookie, eg. ‘Apache&#x3D;1234. (repeatable)  </span><br><span class="line">&#x2F;&#x2F;-C cookie-name&#x3D;value 对请求附加一个Cookie:行。 其典型形式是name&#x3D;value的一个参数对。此参数可以重复。  </span><br><span class="line">-H attribute Add Arbitrary header line, eg. ‘Accept-Encoding: gzip’  </span><br><span class="line">Inserted after all normal header lines. (repeatable)  </span><br><span class="line">-A attribute Add Basic WWW Authentication, the attributes  </span><br><span class="line">are a colon separated username and password.  </span><br><span class="line">-P attribute Add Basic Proxy Authentication, the attributes  </span><br><span class="line">are a colon separated username and password.  </span><br><span class="line">&#x2F;&#x2F;-P proxy-auth-username:password 对一个中转代理提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形式发送。无论服务器是否需要(即, 是否发送了401认证需求代码)，此字符串都会被发送。  </span><br><span class="line">-X proxy:port Proxyserver and port number to use  </span><br><span class="line">-V Print version number and exit  </span><br><span class="line">-k Use HTTP KeepAlive feature  </span><br><span class="line">-d Do not show percentiles served table.  </span><br><span class="line">-S Do not show confidence estimators and warnings.  </span><br><span class="line">-g filename Output collected data to gnuplot format file.  </span><br><span class="line">-e filename Output CSV file with percentages served  </span><br><span class="line">-h Display usage information (this message)  </span><br><span class="line">&#x2F;&#x2F;-attributes 设置 属性的字符串. 缺陷程序中有各种静态声明的固定长度的缓冲区。另外，对命令行参数、服务器的响应头和其他外部输入的解析也很简单，这可能会有不良后果。它没有完整地实现 HTTP&#x2F;1.x; 仅接受某些’预想’的响应格式。 strstr(3)的频繁使用可能会带来性能问题，即, 你可能是在测试ab而不是服务器的性能。</span><br></pre></td></tr></table></figure>
<p>参数很多,一般我们用 -c 和 -n 参数就可以了. 例如:<br><code>./ab -c 1000 -n 1000 http://127.0.0.1/index.php</code></p>
<p>这个表示同时处理1000个请求并运行1000次index.php文件.  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;wp-content&#x2F;local&#x2F;xiaobai&#x2F;apache2054&#x2F;bin&#x2F;ab -c 1000 -n 1000 http:&#x2F;&#x2F;127.0.0.1&#x2F;index.html.zh-cn.gb2312  </span><br><span class="line">This is ApacheBench, Version 2.0.41-dev &lt;$Revision: 1.121.2.12 $&gt; apache-2.0  </span><br><span class="line">Copyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http:&#x2F;&#x2F;www.zeustech.net&#x2F;  </span><br><span class="line">Copyright (c) 1998-2002 The Apache Software Foundation, http:&#x2F;&#x2F;www.apache.org&#x2F;</span><br><span class="line"></span><br><span class="line">Benchmarking 127.0.0.1 (be patient)  </span><br><span class="line">Completed 100 requests  </span><br><span class="line">Completed 200 requests  </span><br><span class="line">Completed 300 requests  </span><br><span class="line">Completed 400 requests  </span><br><span class="line">Completed 500 requests  </span><br><span class="line">Completed 600 requests  </span><br><span class="line">Completed 700 requests  </span><br><span class="line">Completed 800 requests  </span><br><span class="line">Completed 900 requests  </span><br><span class="line">Finished 1000 requests</span><br><span class="line"></span><br><span class="line">Server Software: Apache&#x2F;2.0.54  </span><br><span class="line">&#x2F;&#x2F;平台apache 版本2.0.54  </span><br><span class="line">Server Hostname: 127.0.0.1  </span><br><span class="line">&#x2F;&#x2F;服务器主机名  </span><br><span class="line">Server Port: 80  </span><br><span class="line">&#x2F;&#x2F;服务器端口</span><br><span class="line"></span><br><span class="line">Document Path: &#x2F;index.html.zh-cn.gb2312  </span><br><span class="line">&#x2F;&#x2F;测试的页面文档  </span><br><span class="line">Document Length: 1018 bytes  </span><br><span class="line">&#x2F;&#x2F;文档大小</span><br><span class="line"></span><br><span class="line">Concurrency Level: 1000  </span><br><span class="line">&#x2F;&#x2F;并发数  </span><br><span class="line">Time taken for tests: 8.188731 seconds  </span><br><span class="line">&#x2F;&#x2F;整个测试持续的时间  </span><br><span class="line">Complete requests: 1000  </span><br><span class="line">&#x2F;&#x2F;完成的请求数量  </span><br><span class="line">Failed requests: 0  </span><br><span class="line">&#x2F;&#x2F;失败的请求数量  </span><br><span class="line">Write errors: 0</span><br><span class="line"></span><br><span class="line">Total transferred: 1361581 bytes  </span><br><span class="line">&#x2F;&#x2F;整个场景中的网络传输量  </span><br><span class="line">HTML transferred: 1055666 bytes  </span><br><span class="line">&#x2F;&#x2F;整个场景中的HTML内容传输量  </span><br><span class="line">Requests per second: 122.12 [#&#x2F;sec] (mean)  </span><br><span class="line">&#x2F;&#x2F;大家最关心的指标之一，相当于 LR 中的 每秒事务数 ，后面括号中的 mean 表示这是一个平均值  </span><br><span class="line">Time per request: 8188.731 [ms] (mean)  </span><br><span class="line">&#x2F;&#x2F;大家最关心的指标之二，相当于 LR 中的 平均事务响应时间 ，后面括号中的 mean 表示这是一个平均值  </span><br><span class="line">Time per request: 8.189 [ms] (mean, across all concurrent requests)  </span><br><span class="line">&#x2F;&#x2F;每个请求实际运行时间的平均值  </span><br><span class="line">Transfer rate: 162.30 [Kbytes&#x2F;sec] received  </span><br><span class="line">&#x2F;&#x2F;平均每秒网络上的流量，可以帮助排除是否存在网络流量过大导致响应时间延长的问题</span><br><span class="line"></span><br><span class="line">Connection Times (ms)  </span><br><span class="line">min mean[+&#x2F;-sd] median max  </span><br><span class="line">Connect: 4 646 1078.7 89 3291  </span><br><span class="line">Processing: 165 992 493.1 938 4712  </span><br><span class="line">Waiting: 118 934 480.6 882 4554  </span><br><span class="line">Total: 813 1638 1338.9 1093 7785  </span><br><span class="line">&#x2F;&#x2F;网络上消耗的时间的分解，各项数据的具体算法还不是很清楚</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)  </span><br><span class="line">50% 1093  </span><br><span class="line">66% 1247  </span><br><span class="line">75% 1373  </span><br><span class="line">80% 1493  </span><br><span class="line">90% 4061  </span><br><span class="line">95% 4398  </span><br><span class="line">98% 5608  </span><br><span class="line">99% 7368  </span><br><span class="line">100% 7785 (longest request)</span><br><span class="line">&#x2F;&#x2F;整个场景中所有请求的响应情况。在场景中每个请求都有一个响应时间，其中50％的用户响应时间小于1093 毫秒，60％ 的用户响应时间小于1247 毫秒，最大的响应时间小于7785 毫秒</span><br></pre></td></tr></table></figure>
<p>由于对于并发请求，cpu实际上并不是同时处理的，而是按照每个请求获得的时间片逐个轮转处理的，所以基本上第一个Time per request时间约等于第二个Time per request时间乘以并发请求数</p>
]]></content>
      <categories>
        <category>Apache</category>
      </categories>
      <tags>
        <tag>apache</tag>
        <tag>压力测试</tag>
      </tags>
  </entry>
  <entry>
    <title>php和asp.net的md5差别</title>
    <url>/posts/67.html</url>
    <content><![CDATA[<p>asp.net的md5加密貌似是16位的<br>而php的md5加密是32位的<br>这样解决</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> substr(md5(<span class="string">'admin'</span>),<span class="number">8</span>,<span class="number">16</span>); <span class="comment">// 16位MD5加密效果等同于asp.net的md5</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> md5(<span class="string">'admin'</span>); <span class="comment">// 32位MD5加密</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>asp.net</tag>
        <tag>md5</tag>
      </tags>
  </entry>
  <entry>
    <title>给有重复记录的表添加唯一索引</title>
    <url>/posts/76.html</url>
    <content><![CDATA[<p>不希望数据表中有重复记录的时候我们可以给表添加一个联合唯一索引<br>例如，user表中有user_id,user_name两个字段，如果不希望有两条一摸一样的的user_id和user_name，我们可以给user表添加两个字段的联合唯一索引：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">user</span> <span class="keyword">add</span> <span class="keyword">unique</span> <span class="keyword">index</span>(user_id,user_name);</span><br></pre></td></tr></table></figure>
<p>这样当向表中添加相同记录的时候，会返回1062的添加失败信息。<br>但是有一种情况是表中已经有n个重复的记录，这时候我们才想起来要添加唯一索引，再执行上面的操作时，数据库会告诉你已经有重复的记录了，建立索引失败，这时候，我们可以用下面的操作：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">ignore</span> <span class="keyword">table</span> <span class="keyword">user</span> <span class="keyword">add</span> <span class="keyword">unique</span> <span class="keyword">index</span>(user_id,user_name);</span><br></pre></td></tr></table></figure>
<p>它会删除重复的记录（别怕，会保留一条），然后建立唯一索引，高效而且人性化。<br>尤其是绿色的那条sql,在建立索引的同时删除了重复数据，相当有用。</p>
]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>唯一索引</tag>
      </tags>
  </entry>
  <entry>
    <title>关闭window.open的子窗口并且刷新父窗口</title>
    <url>/posts/65.html</url>
    <content><![CDATA[<p>在我们会在JS中用window.open来打开一个新窗口来处理一些操作，为了有更好的用户友好性，一般在关闭window.open打开的子窗口时，同时刷新父窗口来获取最新数据。代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">closeMeAndReloadParent</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     opener.location.reload();</span><br><span class="line">     <span class="built_in">window</span>.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>javascript</tag>
        <tag>window.open</tag>
        <tag>父窗口</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP Token(令牌)设计</title>
    <url>/posts/77.html</url>
    <content><![CDATA[<p>设计目标:<br>避免重复提交数据.<br>检查来路,是否是外部提交<br>匹配要执行的动作(如果有多个逻辑在同一个页面实现,比如新增,删除,修改放到一个PHP文件里操作)<br>这里所说的token是在页面显示的时候,写到FORM的一个隐藏表单项(type=hidden).<br>token不可明文,如果是明文,那就太危险了,所以要采用一定的加密方式.密文要可逆.俺算法很白痴,所以采用了网上一个现成的方法.</p>
<p>如何达到目的:<br>怎样避免重复提交?<br>在SESSION里要存一个数组,这个数组存放以经成功提交的token.在后台处理时,先判断这个token是否在这个数组里,如果存在,说明是重复提交.<br>如何检查来路?<br>可选项,这个token在生成的时候,加入了当前的session_id.如果别人copy你的html(token一迸copy),在提交时,理论上token里包含的session_id不等于当前session_id,就可以判断这次提交是外部提交.<br>如何匹配要执行的动作?<br>在token的时候,要把这个token的动作名称写进这个token里,这样,在处理的时候,把这个动作解出来进行比较就行了.</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>token</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL中同步两个表中的某些字段</title>
    <url>/posts/64.html</url>
    <content><![CDATA[<p>MySQL中同步两个表中的某些字段</p>
<p>以前我们在写update的时候往往是使用 update tablename set columnname ＝ value这样的简单语法，而今天遇到一个需求，根据一张表中的数据来更新另外一张表中的某些字段值，比如有个A表和B表，A中有字段id，name，email，phone，cno，这里的cno也是唯一的，B表中有id，othercloumn，email，phone，cno，这时候想通过B中的email和phone值来更新A中的email和phone值。我们可以使用一下语句实现这个功能：</p>
<p>语句1</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> A, B <span class="keyword">set</span> A.email= B.email <span class="keyword">where</span> A.cno=B.cno</span><br></pre></td></tr></table></figure>
<p>语句2</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> A <span class="keyword">set</span> A.email= (<span class="keyword">select</span> B.email <span class="keyword">from</span> B <span class="keyword">where</span> A.cno=B.cno)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>两个表同步</tag>
      </tags>
  </entry>
  <entry>
    <title>Javascript trim()函数实现</title>
    <url>/posts/63.html</url>
    <content><![CDATA[<p>在JavaScript中我们需要用到trim的地方很多，但是JavaScript又没有独立的trim函数或者方法可以使用，所以我们需要自己写个trim函数来实现我们的目的。<br>方案一： 以原型方式调用，即obj.trim()形式，此方式简单且使用方面广泛，定义方式如下： </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** * 删除左右两端的空格 */</span></span><br><span class="line"><span class="built_in">String</span>.prototype.trim=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/(^\s*)|(\s*$)/g</span>, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** * 删除左边的空格 */</span></span><br><span class="line"><span class="built_in">String</span>.prototype.ltrim=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/(^\s*)/g</span>,<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** * 删除右边的空格 */</span></span><br><span class="line"><span class="built_in">String</span>.prototype.rtrim=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/(\s*$)/g</span>,<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用示例如下：</span></span><br><span class="line">alert(<span class="built_in">document</span>.getElementById(<span class="string">'abc'</span>).value.trim());</span><br><span class="line">alert(<span class="built_in">document</span>.getElementById(<span class="string">'abc'</span>).value.ltrim());</span><br><span class="line">alert(<span class="built_in">document</span>.getElementById(<span class="string">'abc'</span>).value.rtrim());</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string">方案二： 以工具方式调用，即trim(obj)的形式，此方式可以用于特殊处理需要，定义方式如下： </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="comment">/** * 删除左右两端的空格 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trim</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> str.replace(<span class="regexp">/(^\s*)|(\s*$)/g</span>, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** * 删除左边的空格 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ltrim</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> str.replace(<span class="regexp">/(^\s*)/g</span>,<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** * 删除右边的空格 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rtrim</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> str.replace(<span class="regexp">/(\s*$)/g</span>,<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用示例如下：</span></span><br><span class="line">alert(trim(<span class="built_in">document</span>.getElementById(<span class="string">'abc'</span>).value));</span><br><span class="line">alert(ltrim(<span class="built_in">document</span>.getElementById(<span class="string">'abc'</span>).value));</span><br><span class="line">alert(rtrim(<span class="built_in">document</span>.getElementById(<span class="string">'abc'</span>).value));</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>函数</tag>
        <tag>javascript</tag>
        <tag>trime()</tag>
      </tags>
  </entry>
  <entry>
    <title>黑客声称Windows 7比Linux安全</title>
    <url>/posts/62.html</url>
    <content><![CDATA[<p>Charlie Miller是黑客大赛Pwn2Own连续两年的冠军，最近他在接受访问的时候爆出，微软的Windows 7操作系统比苹果的MacOS更难攻破，当被问及Linux是否更加安全的时候，Charlie说攻击Linux操作系统实际上更加容易，之所以针对Linux的攻击较少，主要是因为其普及规模不如Windows操作系统，看样子开源软件真的并非一定安全。</p>
<p>Charlie还提到，Flash插件实际上是一个巨大的安全威胁，安装了Flash的浏览器都是不安全的，很容易成为黑客攻击的目标。</p>
]]></content>
      <categories>
        <category>业界新闻</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>window7</tag>
        <tag>安全</tag>
        <tag>黑客</tag>
      </tags>
  </entry>
  <entry>
    <title>人人网的系统架构</title>
    <url>/posts/59.html</url>
    <content><![CDATA[<p><strong>人人网使用的开源软件列表</strong></p>
<p><strong>MySQL</strong><br>关系型数据库存储系统，我们的DBA团队很强大，每人管理上百台MySQL服务器，其他就不多说了，网上资料太多了</p>
<p><strong>Tokyo Cabinet</strong><br>一个key-value的存储引擎，日本人开发，国内很多公司也开始使用，我们内部很多地方也用它来代替MySQL来做存储，比如我们的搜索结果页的用户资料，就是用它来做一层MySQL外的冗余存储，目的是加快搜索结果页的显示。在key-value并需要持久存储的场景下，用它比MySQL更有效，Cabinet本身只是一个存储引擎，没有网络处理能力，你可以用它作为自己的某个系统的下层存储引擎，更好的是搭配Tokyo Tyrant使用。</p>
<p><strong>Tokyo Tyrant</strong><br>一个支持Memcached传输协议的网络接口，由Tokyo Cabinet的作者开发，目的是为Tokyo Cabinet提供网络接入能力，即Tokyo Tyrant处理网络连接，协议解析，然后调用Tokyo Cabinet的API来完成持久化存储。</p>
<p><strong>ICE</strong><br>一个跨语言的网络通讯框架，框架本身提供了强大的通讯能力，管理工具，负载均衡方案，其跨语言能力也是一个很大的亮点，基于这个框架之上，我们选用合适的语言来提供合适的服务，比如我们使用C++来开发Cache服务，使用Java来开发一些逻辑服务。框架本身可以很重，也可以很轻，具体要看你怎么用：）</p>
<p><strong>Memcached</strong><br>一个纯内存的key-value的cache系统，高效、稳定，使用广泛，如果你连它都没听说过就太out啦，memcached本身不具备分布式能力，需要依靠Client来实现分布，这里强调一点的是，你应该选择一致性Hash来做key的分布。各种语言的client都有，我们使用spymemcached作为java的Client，spymemcached是一个异步的NIO的memcached client，对网络IO的处理非常的精巧，也更加高效，同时因为提供异步操作方式，可以让你对Memcached的操作有更好的控制能力，Memcached到1.4.0版本之后，开始支持binary protocol，spymemcached对其也支持的比较好，使用binary protocol可以提高对协议的解析效率和网络IO的读写效率。<br>上面说到我们使用ICE自己开发了Cache服务，为什么我们还要用Memcached呢？主要在对Cache的操作粒度不一样，Memcached对Cache对象以binary byte作为一个整体来操作，需要频繁的序列化和反序列化，我们使用ICE提供的Cache服务，可以以Cache对象的一个或者多个字段来操作，比如一个用户对象，我们可以只更新它的姓名，而Memcached</p>
<p><strong>Nginx</strong><br>高效、稳定的Web Server，我们利用其代理能力，做跨IDC的请求代理，同时也将其和我们的Resin(Java Web 容器)搭配，放在Resin的前面来解决Resin的对网络连接处理能力弱的问题，在一些小地方也用它来做7层的负载均衡</p>
<p><strong>Resin</strong><br>一个Java Web Server，比Tomcat更高效，是我们主要的Java Web容器</p>
<p><strong>Squid</strong><br>代理服务器，我们用他来做图片文件的反向代理缓存</p>
<p><strong>LVS</strong><br>能提供4层的负载均衡，高效、高可用，高并发。我们用他替代了很多硬件的负载均衡设备</p>
<p><strong>Struts</strong><br>Java web框架，不过这个已经是历史了，我们开发了一套自己的Web框架替代了它，未来我们也会把我们的内部的这套Web框架开源出来</p>
<p><strong>Lucence</strong><br>基于Java的搜索引擎框架，用它我们构建了一个搜索集群来提供搜人的服务</p>
<p><strong>Netty</strong><br>一个Java的网络框架，和apache的mina类似，但比mina更高效，我们用来做一些小的服务</p>
<p><strong>Ganglia</strong><br>一个监控系统，帮组我们了解我们每台Server的资源利用情况</p>
]]></content>
      <categories>
        <category>WEB相关</category>
      </categories>
      <tags>
        <tag>人人网</tag>
        <tag>系统架构</tag>
      </tags>
  </entry>
  <entry>
    <title>如何计算域名过期时间？(转)</title>
    <url>/posts/58.html</url>
    <content><![CDATA[<p>首先我们先来了解一下域名的各种状态及域名注册与删除周期。</p>
<p><strong>国际域名注册与删除周期</strong></p>
<p>通常情况下，英文国际域名分为四种状态：活动期、注册商保留期、赎回期以及删除期。  </p>
<ol>
<li>Active：国际域名在活动状态，最少注册时长不少于1年，最多注册时长不超过10年。  </li>
<li>On Hold：注册商保留期，一般为30天（Oray所注册顶级域名的保留期大约为30天），此期间虽然域名过期了，但用户仍然可以通过Oray对域名进行续费。  </li>
<li>RGP：赎回期，为40天，此期间用户必须付出高昂的费用才能重新获得该域名的拥有权。  </li>
<li>Soon To Expire：删除期，为5天，此期间域名无法注册和赎回。  </li>
<li>四种状态过后，域名管理机构释放域名给公众注册。  </li>
</ol>
<p><strong>国内域名注册与删除周期</strong></p>
<p>通常情况下，国内域名分为三种状态  </p>
<ol>
<li>Active：国内域名在活动状态，最少注册时长不少于1年，最多注册时长不超过10年。  </li>
<li>On Hold：注册商保留期，一般为1-45天（Oray所注册顶级域名的保留期大约为30天），此期间虽然域名过期了，但用户仍然可以通过Oray对域名进行续费。  </li>
<li>RGP：赎回期，为15天，此期间用户必须付出高昂的费用才能重新获得该域名的拥有权。  </li>
<li>三种状态过后，域名管理机构释放域名给公众注册。<br>可以看到，相比之下，国内域名过期后，释放出来给公众注册的时间比国际域名快，因此要更加注意对域名进行及时的续费。</li>
</ol>
]]></content>
      <categories>
        <category>WEB相关</category>
      </categories>
      <tags>
        <tag>国内域名</tag>
        <tag>国际域名</tag>
        <tag>域名续费</tag>
      </tags>
  </entry>
  <entry>
    <title>在线Loading图标制作</title>
    <url>/posts/55.html</url>
    <content><![CDATA[<p>Load Info在线制作Loading图标的免费网站，目前网站提供了90多种（总有一种适合你）动态图标。 点击图片,可以自定义背景色和前景色，更有三种不同的尺寸可以选择，包括 16×16, 24×24, 48×46，很是方便实用。Ajax Load同样可以在线制作Loading图标, Ajax Load所提供的种类没有Load Info丰富，不是先看到Loading的样式,下拉菜单选择样式,点击生成才能看到具体的样式 点击进入 <a href="http://loadinfo.net/" target="_blank" rel="noopener" title="loadinfo">loadinfo</a> 点击进入 <a href="http://ajaxload.info/" target="_blank" rel="noopener" title="ajaxload">ajaxload</a></p>
]]></content>
      <categories>
        <category>WEB相关</category>
      </categories>
      <tags>
        <tag>ajax</tag>
        <tag>在线loading图标制作</tag>
      </tags>
  </entry>
  <entry>
    <title>Sql 查询Case使用</title>
    <url>/posts/52.html</url>
    <content><![CDATA[<p>sql代码</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,title,<span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">status</span>=<span class="string">'1'</span> <span class="keyword">THEN</span> <span class="string">'已审核'</span> <span class="keyword">ELSE</span> <span class="string">'未审核'</span> <span class="keyword">END</span> <span class="keyword">AS</span> <span class="keyword">status</span> <span class="keyword">FROM</span> <span class="keyword">table</span>  </span><br><span class="line"><span class="comment">#原表</span></span><br><span class="line"><span class="keyword">id</span> title <span class="keyword">status</span>  </span><br><span class="line"><span class="number">1</span>  我    <span class="number">1</span>  </span><br><span class="line"><span class="number">2</span>  我的  <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#最后显示 显示  </span></span><br><span class="line"><span class="keyword">id</span> title <span class="keyword">status</span>  </span><br><span class="line"><span class="number">1</span>  我    已审核  </span><br><span class="line"><span class="number">2</span>  我的  未审核</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>case</tag>
        <tag>sql</tag>
        <tag>查询</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql对自动编号字段(auto_increment)进行排序</title>
    <url>/posts/51.html</url>
    <content><![CDATA[<p>在一个数据表里面的id使用是用auto_increment，如果删除了中间某条信息会使用其id断序，从而使用以下语句可以对其重新排序。</p>
<p>SQL代码</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> @newid=<span class="number">0</span>;  </span><br><span class="line"><span class="keyword">update</span> table_name  </span><br><span class="line"><span class="keyword">set</span> <span class="keyword">id</span> = (<span class="keyword">SELECT</span> @newid:=@newid+ <span class="number">1</span>);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>排序</tag>
        <tag>自动编号</tag>
      </tags>
  </entry>
  <entry>
    <title>MySql自定义变量</title>
    <url>/posts/50.html</url>
    <content><![CDATA[<p>SQL代码</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> @<span class="keyword">name</span>=<span class="string">"abc"</span>; <span class="comment">/* 赋值 */</span></span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">name</span>:=<span class="string">"abc"</span>; <span class="comment">/* 赋值 */</span></span><br><span class="line"><span class="comment">/* 以上两句结果相同 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">name</span>=<span class="string">"abc"</span>; <span class="comment">/* 比较操作符 */</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">name</span>:=<span class="string">"abc"</span>; <span class="comment">/* 赋值 */</span></span><br><span class="line"><span class="comment">/* 以上两句结果不同 */</span></span><br></pre></td></tr></table></figure>
<p>这里定义了两个变量，@name和@id，后面进行相应的替换就可以了。以后，直接修改变量的值即可。其中，用“=”等号或者用“:=”冒号加等号，在SET命令里面都是一样的。<br>但不同的是，要在非SET命令中定义变量时，必须使用“:=”，因为“=”会被认为是比较操作符（这个是比较高级的内容了，暂时不深究）。<br>自定义变量可以用数字，字母，“.”点符号，“_”下划线，“$”美元符号。</p>
]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>自定义变量</tag>
      </tags>
  </entry>
  <entry>
    <title>12580内部邮件宣布李一男出任CEO兼总裁</title>
    <url>/posts/49.html</url>
    <content><![CDATA[<p>无限讯奇公司(中国移动12580独家合作伙伴)近日的一封内部邮件宣布，百度原首席技术官李一男加盟出任董事、CEO兼总裁，原CEO、创始人张志浩出 任联席董事长。 在百度1月18日宣布李一男离开的当天，业内既有消息称李一男将出任12580公司CEO。有媒体当时报道称，12580将于20日宣布李一男的加盟，但 最终这一天并未宣布。网易科技获悉，李一男是在次日(21日)到无线讯奇上班的，该公司的内部邮件近日宣布了李一男的加盟。 内部邮件显示，现任首席执行官张志浩将出任公司联席董事长。张志浩是12580的创始人之一。李一男被聘为无限讯奇公司董事、CEO 兼总裁。邮件称，李一男将从3月1日起正式上班，从1月20日起至2月底，张志浩继续代行CEO职权。 李一男在加盟百度出任首席技术官16个月后离职，这在一周前引发了业界的轩然大波。李一男是少年天才，曾担任华为副总裁，以卓越的技术闻名于业内；李一男也是继COO叶朋之后，百度10天之内离职的第二位核心高管，外界也由此开始担忧百度的未来。 以下为内部邮件全文： 自2010 年1 月20 日起，张志浩先生不再担任公司首席执行官（CEO）职务，出任公司联席董事长。李一男先生被聘任为公司董事、CEO 兼总裁。 在加入无限讯奇之前，李一男先生曾担任过华为公司副总裁，港湾网络公司总裁，百度公司首席技术官（CTO）。李先生具有卓越的技术背景、丰富的管理经验以及在业界的影响力。 让我们预祝公司在李一男先生的带领下，在未来将取得更大的成功。李一男先生将于2010年3 月1 日起正式上班。即日起至2010 年2月28 日之间，张志浩先生代行CEO 职权。 转载：phpchina</p>
]]></content>
      <categories>
        <category>业界新闻</category>
      </categories>
      <tags>
        <tag>12580</tag>
        <tag>CEO</tag>
        <tag>李一男</tag>
      </tags>
  </entry>
  <entry>
    <title>盖茨点评谷歌：谷歌退出美国 那才佩服它</title>
    <url>/posts/48.html</url>
    <content><![CDATA[<p>“你必须做出决定：如果你愿意遵守你所在国家的法律，你就可以留下做生意，不愿意遵守的话，你在那里做生意可能不会有好下场。”<br>　　微软公司创始人比尔·盖茨25日在谈及近期的谷歌中国事件时指出，如果跨国公司想在某一个国家做生意，就必须遵守这个国家的法律。</p>
<p>　　盖茨是在接受美国广播公司节目“早安美国”的采访时作此表示的。他说：“你必须做出决定：如果你愿意遵守你所在国家的法律，你就可以留下做生意，不愿意遵守的话，你在那里做生意可能不会有好下场。”</p>
<p>　　盖茨表示，虽然互联网上的内容受到了全世界各种标准不一的审查制度的影响，但是其在促进全世界互相开放与交流方面还是发挥了巨大的作用。</p>
<p>　　同时，据国外媒体报道，1月25日比尔·盖茨拜访了纽约时报。盖茨对微软和谷歌的互联网搜索工作表达了自己的看法，言辞时而敏锐严厉，时而嘲讽尖酸。</p>
<p>　　对于谷歌最近为抗议中国对搜索的审查制度，而威胁要放弃中国的搜索业务的事件，盖茨称自己并没什么印象，甚至有些困惑。他说：“他们什么都没做，却把功劳照单全收。”</p>
<p>　　他认为，一个人可能会也可能不同意中国的法律，但是几乎所有国家都有一些颇具争议性的法律或政策，包括美国。“他们想说明什么?”盖茨问道，“现在如果谷歌选择退出美国，那我才佩服它。”</p>
<p>　　谷歌逼盖茨表态</p>
<p>　　为什么奥巴马政府对谷歌支持?因为过去竞选的时候，它对奥巴马竞选的团队有过贡献，金钱的贡献。在很多状况之下，美国的民主政策基于两票，一票是选票，一票是钞票，钞票发挥功能进行各种游说，或者是有必要时获得政府支持。过去谷歌用钞票支持了奥巴马，现在奥巴马政府进行了回报。</p>
<p>　　十几天以来，谷歌事件在美国的媒体、美国的学术界引起不同的反应。《今日美国》最近就讲，谷歌事件是一种商业炒作，因为谷歌自己本身提不出来正确，而且可以信服的证据。</p>
<p>　　最近谷歌在这个事情上也打到了微软，因为微软在中国事业做得很大，它打到了微软。逼得微软的创始人比尔·盖茨表态，因为谷歌说中国政府是进行检查。比尔·盖茨说在全世界各地做生意，各国都有各种法律的限制。</p>
<p>　　比尔·盖茨这个言论，当然从业界的角度考虑，也是让美国的民间、美国的媒体进一步了解这个世界的真理不是只有你谷歌一个。(阮次山)</p>
<p>　　谷歌退出事件</p>
<p>　　1月13日，谷歌以遭到黑客攻击为由宣布考虑关闭中国办事处。1月21日美国国务卿希拉里在华盛顿发表关于”网络自由”的演讲，指责中国等国家的互联网管理政策，并表示要将”不受限制的互联网访问作为外交政策的首要任务”。针对各种无端指责，继中国外交部之后，中国工业和信息化部以及国务院新闻办公室日前相继作出回应，强调中国互联网发展取得了举世瞩目的成就，中国互联网的政策环境是好的，中国互联网发展和管理的方针政策符合中国国情和国际通行做法。</p>
<p>转载：phpchina</p>
]]></content>
      <categories>
        <category>业界新闻</category>
      </categories>
      <tags>
        <tag>盖茨</tag>
        <tag>谷歌</tag>
      </tags>
  </entry>
  <entry>
    <title>md5 结合 crypt ＝无敌密码</title>
    <url>/posts/28.html</url>
    <content><![CDATA[<p>PHP的内置函数crypt 很不错<br>配合MD5 更天下无敌</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//不安全</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"crypt加密后"</span>.crypt($pass);</span><br><span class="line"><span class="comment">// 比较乱的密码 刷新后还会变</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"crypt复杂加密后"</span>.crypt($pass,substr($pass,<span class="number">0</span>,<span class="number">2</span>));</span><br><span class="line"><span class="comment">//还是不爽</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"无敌加密后"</span>.md5(crypt($pass,substr($pass,<span class="number">0</span>,<span class="number">2</span>)));</span><br><span class="line"><span class="comment">// 现在让黑客如何破这个密码？</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后的密码 还是32位 初看 都以为是 MD5加密<br>可无论对方MD5的HASH值多么庞大 几个T的数据 都无法破解出来</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>crypt</tag>
        <tag>函数</tag>
      </tags>
  </entry>
  <entry>
    <title>一个必须得改的毛病</title>
    <url>/posts/27.html</url>
    <content><![CDATA[<p>最近在公司，做一个数据库更新的事，由于当时条件没有考虑周全，把部分VIP用户的标识给恢复了，当初购买时的会员标识，因为只有一小部分用户有此问题，所有公司没有及时发现，后来用户通知我们了，我们才发现，还是影响的数据量不大，发了大概半小时时间把它处理完，幸好有“历史数据”处理机制在，要不然完完了，，不知道数据从哪来恢复。<br>仔细想想自己的一些问题都出在真的太粗心了，以后真的得改掉这个毛病。记住这个教训。<br>ps:真的记得得改。</p>
]]></content>
      <categories>
        <category>本人唠叨</category>
      </categories>
      <tags>
        <tag>个人唠叨</tag>
      </tags>
  </entry>
  <entry>
    <title>博客再次迁移</title>
    <url>/posts/21.html</url>
    <content><![CDATA[<p>在国内架个个人博客真难，由于国内互联内“反黄”事件，全国各大机房都接连被封机房，本站之前放于广州地界的机房，也同样被封长于半个月的时间，机房也没有相应的补尝，由于主机也将至到期，心想干脆换个机房，换程序移到了杭州机房，本以为此次风波已经过去，没想到经过一周多时间，问题同上的发生，还好，最新数据本地都已存在（经上次的教训），在本地都已经备份了最新的数据和程序。CNNIC 真是太暴力了也没有点时间，直接说封就封。听说1月底还要对CN域名下手，今年刚续完费，不知道能不能撑不撑的过去。一直也想把之前一直用的SABLOG给换了，借此机会，就干脆把它也换成TYPECHO算了，个人认为TYPECHO比较适合做博客程序，较WORDPRESS相比没有其臃肿，在皮肤上跟WORDPRESS较接近，同时在插件的使用和开发都是相对比较简单，最重要的一点同时也是开源程序，而且就连数据库的注释也是非常的清楚，这点各大大博客包括WORDPRESS好像都没做到，TYPECHO还可以直接在GOOGLE的开源项目上直接获取其源码。SABLOG也是比较优秀但更新比较慢，皮肤也少,UI也做的不好。其综合比较个人还是觉得TYPECHO比较好，希望有越来越多的人会去使用它。<br>发布于，<a href="http://www.phpkoo.com" target="_blank" rel="noopener">站长实验室</a></p>
]]></content>
      <categories>
        <category>本人唠叨</category>
      </categories>
      <tags>
        <tag>博客迁移</tag>
        <tag>站长实验室</tag>
      </tags>
  </entry>
  <entry>
    <title>博客再次迁移</title>
    <url>/posts/21.html</url>
    <content><![CDATA[<p>在国内架个个人博客真难，由于国内互联内“反黄”事件，全国各大机房都接连被封机房，本站之前放于广州地界的机房，也同样被封长于半个月的时间，机房也没有相应的补尝，由于主机也将至到期，心想干脆换个机房，换程序移到了杭州机房，本以为此次风波已经过去，没想到经过一周多时间，问题同上的发生，还好，最新数据本地都已存在（经上次的教训），在本地都已经备案了最新的数据和程序。CNNIC 真是太暴力了也没有点时间，直接说封就封。听说1月底还要对CN域名下手，今年刚续完费，不知道能不能撑不撑的过去。一直也想把之前一直用的SABLOG给换了，借此机会，就干脆把它也换成TYPECHO算了，个人认为TYPECHO比较适合做博客程序，较WORDPRESS相比没有其臃肿，在皮肤上跟WORDPRESS较接近，同时在插件的使用和开发都是相对比较简单，最重要的一点同时也是开源程序，而且就连数据库的注释也是非常的清楚，这点各大大博客包括WORDPRESS好像都没做到，TYPECHO还可以直接在GOOGLE的开源项目上直接获取其源码。SABLOG也是比较优秀但更新比较慢，皮肤也少,UI也做的不好。其综合比较个人还是觉得TYPECHO比较好，希望有越来越多的人会去使用它。 发布于，<a href="http://www.phpkoo.com" target="_blank" rel="noopener" title="站长实验室">站长实验室</a></p>
]]></content>
      <categories>
        <category>本人唠叨</category>
      </categories>
      <tags>
        <tag>博客迁移</tag>
        <tag>站长实验室</tag>
      </tags>
  </entry>
  <entry>
    <title>网站架构策划方案</title>
    <url>/posts/9.html</url>
    <content><![CDATA[<p>这段时间一直都在为网站架构的事情所烦恼，前端，程序，服务器三个方面应该如何协调才能达到一个较为优化的网站架构呢？根据前辈的经验，我总结了以下文档，特分享。  </p>
<p><strong>1. UIC需要做的</strong><br>采用Css Sprite将背景图片，图标图片集成在一张图片内。<br>优点：减少用户代理对服务器的请求次数；加快用户载入页面时间。</p>
<p>Css &amp;&amp; Js 统一使用YUIcompressor进行代码压缩处理。<br>优点：加快服务器结束线程的时间；加快用户载入页面时间。</p>
<p>单个数据对象小于25K。<br>优点：部分用户代理（如iphone），无法载入25K以上的数据对象。</p>
<p>外部广告图片，宣传图片尽量防止在本站图片缓存服务器上。<br>优点：减少用户的DNS查询，加快页面载入速度。</p>
<p>色彩不超过256色的图片，不采用JPG格式存储。<br>优点：减少文件大小，加快页面载入速度。</p>
<p>使用PNG8格式的PNG图片代替Gif格式图片。<br>优点：具备比Gif更高的压缩比，有利于网络传塑，加快页面载入速度。</p>
<p>JPG图片采用interlaced模式存储。<br>优点：色彩复杂的图片大小更小，可让图片呈渐进状态显示，直至清晰。增强用户体验。</p>
<p><strong>2. UI 需要做的</strong><br>设计稿图片尽量减少一些渐变效果的使用<br>优点：减少JPG图片的数量，加快用户载入页面时间。</p>
<p><strong>3. 开发需要做的</strong><br>如果出现Ajax 方式，采用Ajax缓存<br>可考虑</p>
<p><strong>4. SA 需要做的</strong><br>负载均衡<br>优点：减小Web服务器压力。</p>
<p>Gzip压缩输出<br>优点：减小输出的用户数据大小，加快页面载入时间。</p>
<p>图片与Web服务器分离<br>优点：减小Web服务器压力。</p>
<p>增加Squid缓存<br>优点：避免2次刷新带来的重复请求。减少服务器压力。</p>
<p>架构SVN测试服务器并与公网服务器的同步<br>优点：避免公网页面出现错误，增强用户体验。</p>
]]></content>
      <categories>
        <category>本人唠叨</category>
      </categories>
      <tags>
        <tag>方案</tag>
        <tag>策划</tag>
        <tag>网站架构</tag>
      </tags>
  </entry>
  <entry>
    <title>网站架构策划方案</title>
    <url>/posts/9.html</url>
    <content><![CDATA[<p>这段时间一直都在为网站架构的事情所烦恼，前端，程序，服务器三个方面应该如何协调才能达到一个较为优化的网站架构呢？根据前辈的经验，我总结了以下文档，特分享。<br><strong>1. UIC需要做的</strong><br>采用Css Sprite将背景图片，图标图片集成在一张图片内。<br>优点：减少用户代理对服务器的请求次数；加快用户载入页面时间。 Css &amp;&amp; Js 统一使用YUIcompressor进行代码压缩处理。<br>优点：加快服务器结束线程的时间；加快用户载入页面时间。 单个数据对象小于25K。<br>优点：部分用户代理（如iphone），无法载入25K以上的数据对象。 外部广告图片，宣传图片尽量防止在本站图片缓存服务器上。<br>优点：减少用户的DNS查询，加快页面载入速度。 色彩不超过256色的图片，不采用JPG格式存储。<br>优点：减少文件大小，加快页面载入速度。 使用PNG8格式的PNG图片代替Gif格式图片。<br>优点：具备比Gif更高的压缩比，有利于网络传塑，加快页面载入速度。 JPG图片采用interlaced模式存储。<br>优点：色彩复杂的图片大小更小，可让图片呈渐进状态显示，直至清晰。增强用户体验。<br><strong>2. UI 需要做的</strong><br>设计稿图片尽量减少一些渐变效果的使用<br>优点：减少JPG图片的数量，加快用户载入页面时间。<br><strong>3. 开发需要做的</strong><br>如果出现Ajax 方式，采用Ajax缓存 可考虑<br><strong>4. SA 需要做的</strong><br>负载均衡 优点：减小Web服务器压力。 Gzip压缩输出<br>优点：减小输出的用户数据大小，加快页面载入时间。 图片与Web服务器分离<br>优点：减小Web服务器压力。 增加Squid缓存<br>优点：避免2次刷新带来的重复请求。减少服务器压力。 架构SVN测试服务器并与公网服务器的同步<br>优点：避免公网页面出现错误，增强用户体验。</p>
]]></content>
      <categories>
        <category>本人唠叨</category>
      </categories>
      <tags>
        <tag>方案</tag>
        <tag>策划</tag>
        <tag>网站架构</tag>
      </tags>
  </entry>
  <entry>
    <title>二级域名的完美实现</title>
    <url>/posts/13.html</url>
    <content><![CDATA[<p>首先，你的拥有一个有泛域名解析的顶级域名，例如： domain.com<br>其次，在 httpd.conf 中打开 mod_rewrite</p>
<p>之后，在 httpd.conf 的最后，添加以下内容：  </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">RewriteEngine on  </span><br><span class="line">RewriteMap lowercase int:tolower  </span><br><span class="line">RewriteMap vhost txt:/wp-content/<span class="built_in">local</span>/etc/apache/vhost.map  </span><br><span class="line">RewriteCond <span class="variable">$&#123;lowercase:%&#123;SERVER_NAME&#125;</span>&#125; ^(.+)$  </span><br><span class="line">RewriteCond <span class="variable">$&#123;vhost:%1&#125;</span> ^(/.*)$  </span><br><span class="line">RewriteRule ^/(.*)$ %1/<span class="variable">$1</span></span><br></pre></td></tr></table></figure>
<p>其中的 /wp-content/local/etc/apache 是你的 apache 服务器配置文件所在路径，根据实际情况更改。<br>然后，在这个所在路径的目录下创建一个文件： vhost.map<br>内容为： </p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">www.domain.com /wp-content/<span class="built_in">local</span>/www/data-dist/domain  </span><br><span class="line">bbs.domain.com /wp-content/<span class="built_in">local</span>/www/data-dist/bbs  </span><br><span class="line">anyname.domain.com /wp-content/<span class="built_in">local</span>/www/data-dist/anyname`</span><br></pre></td></tr></table></figure>
<p>以上部分都是：” 域名+空格+绝对路径” 的形式。</p>
<p>最后，在你的网站根目录 /wp-content/local/www/data-dist 下，创建对应目录：<br>domain , bbs , anyname 等等，理论上可以无限。</p>
<p>这样，通过浏览器，访问 <a href="http://www.domain.com" target="_blank" rel="noopener">www.domain.com</a> 时，实际上访问的就是 /wp-content/local/www/data-dist/domain目录下的文件。同理，访问 bbs.domain.com 实际上访问的就是 /wp-content/local/www/data-dist/bbs 目录下的文件。而且，你可以<br>随时更改 vhost.map 来增加、删除、修改你的二级域名和所指向的实际路径，不用重启 apache。</p>
]]></content>
      <categories>
        <category>Apache</category>
      </categories>
      <tags>
        <tag>apache</tag>
        <tag>二级域名</tag>
        <tag>泛域名</tag>
      </tags>
  </entry>
  <entry>
    <title>二级域名的完美实现</title>
    <url>/posts/13.html</url>
    <content><![CDATA[<p>首先，你的拥有一个有泛域名解析的顶级域名，例如： domain.com 其次，在 httpd.conf 中打开 mod_rewrite 之后，在 httpd.conf 的最后，添加以下内容： <code>RewriteEngine on RewriteMap lowercase int:tolower RewriteMap vhost txt:/wp-content/local/etc/apache/vhost.map RewriteCond ${lowercase:%{SERVER_NAME}} ^(.+)$ RewriteCond ${vhost:%1} ^(/.*)$ RewriteRule ^/(.*)$ %1/$1</code> 其中的 /wp-content/local/etc/apache 是你的 apache 服务器配置文件所在路径，根据实际情况更改。 然后，在这个所在路径的目录下创建一个文件： vhost.map 内容为： <code>www.domain.com /wp-content/local/www/data-dist/domain bbs.domain.com /wp-content/local/www/data-dist/bbs anyname.domain.com /wp-content/local/www/data-dist/anyname</code> 以上部分都是：” 域名+空格+绝对路径” 的形式。 最后，在你的网站根目录 /wp-content/local/www/data-dist 下，创建对应目录： domain , bbs , anyname 等等，理论上可以无限。 这样，通过浏览器，访问 <a href="http://www.domain.com" target="_blank" rel="noopener">www.domain.com</a> 时，实际上访问的就是 /wp-content/local/www/data-dist/domain目录下的文件。同理，访问 bbs.domain.com 实际上访问的就是 /wp-content/local/www/data-dist/bbs 目录下的文件。而且，你可以 随时更改 vhost.map 来增加、删除、修改你的二级域名和所指向的实际路径，不用重启 apache。</p>
]]></content>
      <categories>
        <category>Apache</category>
      </categories>
      <tags>
        <tag>apache</tag>
        <tag>二级域名</tag>
        <tag>泛域名</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP各加速利器</title>
    <url>/posts/7.html</url>
    <content><![CDATA[<p>在一些较大项目中如牵涉到要整合用PHP开发的OA办公等系统，可以使用以下PHP的资源，特整理以供大家学习参考<br>加速器/缓存  </p>
<p><strong>afterBurner Cache</strong><br>早期的 PHP Cache 之一。缓存编译后（第一次执行以后）的PHP 代码。宣称节省40%的运行时间。但是目前开发进度比较慢,兼容PHP 4.1系列。支持操作系统：Linux。<br>国家:意大利<br>网址：<a href="http://afterburner.bware.it/" target="_blank" rel="noopener">http://afterburner.bware.it/</a><br>价格：Free</p>
<p><strong>APC</strong><br>早期的 PHP Cache 之一。曾经是communityconnect的东西，现在是 PECL 中的一部分。<br>国家:美国<br>网址：<a href="http://pecl.php.net/package/APC" target="_blank" rel="noopener">http://pecl.php.net/package/APC</a><br>价格：Free</p>
<p><strong>PHP Accelerator</strong><br>Zend 引擎扩展，由ionCube 公司开发 宣称可将脚本运行速度提高5倍。目前兼容PHP 4.3 系列。Yahoo 采用它作为PHP 缓存。支持操作系统：Linux, OpenBSD, FreeBSD, BSDi。Apache 服务器。不兼容Zend Optimizer。<br>国家:英国<br>网址：<a href="http://www.php-accelerator.co.uk/" target="_blank" rel="noopener">http://www.php-accelerator.co.uk/</a><br>价格：Free</p>
<p><strong>Zend Performance Suite</strong><br>不用我多介绍了 Zend 公司出品。兼容Zend Optimizer。支持最新的PHP和Apache服务器。 服务器吞吐量提高25倍。价格昂贵。众多商业用户包括著名搜索网站alltheweb.com。支持操作系统：Linux，新近推出windows测试版本。<br>国家：美国<br>网址：<a href="http://www.zend.com/store/products/zend-performance-suite.php" target="_blank" rel="noopener">http://www.zend.com/store/products/zend-performance-suite.php</a><br>价格：$1875起</p>
<p>编码器</p>
<p><strong>SourceGuardian Pro for PHP</strong><br>为PHP脚本提供基于时间, IP and 域名 限制保护，需要一个Loader才能执行。Loader可以免费下载。和Zend Optimizer， PHPAccelerator 加速器兼容。支持虚拟主机甚至PHP 安全模式，无需服务器特殊设定。<br>国家：美国<br>网址：<a href="http://sourceguardian.com/products/phppro.htm" target="_blank" rel="noopener">http://sourceguardian.com/products/phppro.htm</a><br>价格：$250</p>
<p><strong>Zend Encoder</strong><br>Zend 公司出品。将PHP 脚本预编译成中间码格式通过Zend Optimizer运行，速度快，但是价格昂贵。<br>国家：美国<br>网址：<a href="http://www.zend.com/store/products/zend-performance-suite.php" target="_blank" rel="noopener">http://www.zend.com/store/products/zend-performance-suite.php</a><br>价格：$960</p>
<p><strong>ionCube Standalone PHP Encoder 3.0</strong><br>将PHP 脚本预编译成二进制代码， 并提供通过多种方式保护PHP程序， 通过IP加服务器名保护， 时间过期保护， 甚至MAC地址的保护。 经过编码的PHP 程序需要一个Loader才能执行。Loader可以免费下载。支持多种操作系统：Intel Linux, FreeBSD,<br>Windows 同时还提供在线编码服务。<br>国家：美国<br>网址：<a href="http://www.ioncube.com/sa_encoder.php" target="_blank" rel="noopener">http://www.ioncube.com/sa_encoder.php</a><br>价格：$199-$348</p>
<p>shukebeita的隆重推荐<br><strong>MMCache</strong><br>如果想同时拥有加速和编码功能而且免费？没有问题，MMCache 是你唯一的选择。它功能强大甚至击败Zend 公司的Performance suite<br>而且完全免费。保护php源码。<br>国家：德国/俄罗斯<br>网址：<a href="http://turck-mmcache.sourceforge.net/" target="_blank" rel="noopener">http://turck-mmcache.sourceforge.net/</a><br>价格：free</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>cache</tag>
        <tag>加速</tag>
        <tag>缓存</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql异常</title>
    <url>/posts/12.html</url>
    <content><![CDATA[<p>SQLWARNING是对所有以01开头的SQLSTATE代码的速记。</p>
<p>NOT FOUND是对所有以02开头的SQLSTATE代码的速记。</p>
<p>SQLEXCEPTION是对所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE代码的速记。</p>
]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>异常</tag>
      </tags>
  </entry>
  <entry>
    <title>JS-AJAX类</title>
    <url>/posts/8.html</url>
    <content><![CDATA[<p>随着WEB2.0的到来，AJAX技术成为了网站首选的靓点技术，从表单提交到“无刷新”体验，从而在给用户带来友好体验的同时又提高与数据库的快速交互。为方便“新手”更方便的让网站使用AJAX技术，本人特封装一个小型的AJAX类如下代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* @package Ajax类</span></span><br><span class="line"><span class="comment"> * @author 阿德</span></span><br><span class="line"><span class="comment"> * @version 0.1</span></span><br><span class="line"><span class="comment"> * @dependence 09.12</span></span><br><span class="line"><span class="comment"> * @link http://www.zzlabs.com.cn</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * domId       = 'result';</span></span><br><span class="line"><span class="comment"> * url            = 'result.php';</span></span><br><span class="line"><span class="comment"> * parameter  = 'id='+id;</span></span><br><span class="line"><span class="comment"> * method      = 'get';    //传输方式</span></span><br><span class="line"><span class="comment"> * asynchronism = true      //是否异步</span></span><br><span class="line"><span class="comment"> * new Ajax().ajaxRequest(domId,url,parameter,method,asynchronism,function callBack(result)&#123;$('result').innerHTML = result.responseText;&#125;);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> ($ == <span class="literal">undefined</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> $ = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;<span class="keyword">return</span> <span class="built_in">document</span>.getElementById(id);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Ajax</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _domId = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> _xmlHttp = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> _isAsynchronism = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">var</span> _successFunction = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.createXMLHttpRequest = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">window</span>.ActiveXObject)&#123;</span><br><span class="line">                _xmlHttp = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">                    _xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">                &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                    _xmlHttp = <span class="keyword">new</span> ActiveXObject(<span class="string">"Msxml2.XMLHTTP"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            alert(e.name + <span class="string">" : "</span> + e.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.doPost = <span class="function"><span class="keyword">function</span>(<span class="params">_url, _parameter</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            _xmlHttp.open(<span class="string">"POST"</span>, _url, _isAsynchronism);</span><br><span class="line">            _xmlHttp.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line">            _xmlHttp.send(_parameter);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            alert(e.name + <span class="string">" : "</span> + e.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.doGet = <span class="function"><span class="keyword">function</span>(<span class="params">_url, _parameter</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _random = <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * <span class="number">10000</span>);</span><br><span class="line">            <span class="keyword">var</span> _getParameter = (_url + <span class="string">"?random="</span> + _random + <span class="string">"&amp;"</span> + _parameter);</span><br><span class="line">            <span class="keyword">if</span>(_getParameter.length &gt; <span class="number">255</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.doPost(_url, _parameter);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                _xmlHttp.open(<span class="string">"GET"</span>, _getParameter,_isAsynchronism);</span><br><span class="line">                _xmlHttp.send(<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            alert(e.name + <span class="string">" : "</span> + e.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.backFunction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(_successFunction == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(_isAsynchronism)&#123;</span><br><span class="line">            <span class="keyword">if</span>(_domId)&#123;</span><br><span class="line">                <span class="keyword">switch</span>(_xmlHttp.readyState)&#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                        $(_domId).innerHTML = <span class="string">'请稍候，正在建立连接...'</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                        $(_domId).innerHTML = <span class="string">'请稍候，正在发送数据...'</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                        $(_domId).innerHTML = <span class="string">'请稍候，正在接收数据...'</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>((_xmlHttp.readyState == <span class="number">4</span>) &amp;&amp; (_xmlHttp.status == <span class="number">200</span>))&#123;</span><br><span class="line">                _successFunction(_xmlHttp);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.ajaxRequest = <span class="function"><span class="keyword">function</span>(<span class="params">_id, _url, _parameter, _method, _asynchronism, _backFunction</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createXMLHttpRequest();</span><br><span class="line">        _domId = _id;</span><br><span class="line">        _isAsynchronism = _asynchronism;</span><br><span class="line">        _successFunction = _backFunction;</span><br><span class="line">        _xmlHttp.onreadystatechange = <span class="keyword">this</span>.backFunction;</span><br><span class="line">        <span class="keyword">if</span>(_method.toLowerCase() == <span class="string">"post"</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.doPost(_url, _parameter);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(_method.toLowerCase() == <span class="string">"get"</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.doGet(_url, _parameter);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用说明：<br>1、加载JS文件（在网站的任何位置加入）  </p>
<p>2、实例化JS类</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Ajax().ajaxRequest(domId,url,parameter,method,asynchronism,<span class="function"><span class="keyword">function</span> <span class="title">callBack</span>(<span class="params">result</span>)</span>&#123;$(<span class="string">'result'</span>).innerHTML = result.responseText;&#125;);</span><br></pre></td></tr></table></figure>
<p>3、参数说明<br>(1)domId：表示需要显示结果的容器ID号，如domId = ‘logining’，如果没有指定可以为domId=’’或domId=null<br>(2)url：表示服务端接收的页面地址，如url = ‘send.ph’<br>(3)parameter：表示服务羰接收页面的参数，如parameter = ‘type=’+type，如果该页面无需参数可以为parameter = null<br>(4)method：表示AJAX的请求方法为method = ‘get’或method=’post’<br>(5)asnchronism：表示是否同步，如asnchronism = true为同步,asnchronism=false为不同步，默认为同步即可<br>(6)function callBack()：表示是回调函数把从服务端返回的结果返回，只要在该函数中处理即可。</p>
<p>注：该函数只是简单的实现AJAX的基本功能，主要特点是小巧，同时可自由扩展，如果网站只需要调用AJAX功能而不需要其它复杂的功能时可以考虑使用本AJAX类。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>ajax</tag>
        <tag>类</tag>
      </tags>
  </entry>
  <entry>
    <title>禁止Apache列出目录内容</title>
    <url>/posts/14.html</url>
    <content><![CDATA[<p>默认情况下，如果你的网站下有一个a的文件夹，如果些文件夹下没有默认页面，当用户http://你的网址/a/ 即apache会把此文件夹角的内容全列出来。如果想禁止此功能，修改httpd.conf<br>找到下面这一句把它注释掉即可<code>Options Indexes FollowSymLinks</code>建议默认情况下，设置APACHE禁止用户浏览目录内容。</p>
]]></content>
      <categories>
        <category>Apache</category>
      </categories>
      <tags>
        <tag>apache</tag>
        <tag>禁止目录</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP生成静态页类</title>
    <url>/posts/5.html</url>
    <content><![CDATA[<p>对 HTML 页面地抓取和收录都比动态页面更及时更全面，世界各大搜索引擎例如百度、 Google等。使用静态化 HTML 页面极大地增加网站被搜索到几率。让您有更多地机会展现自己。 以下提供使用PHP来静态化的类： </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shtml</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($url, $fileBag, $folderRoot, $folderName, $fileid)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;url = $url;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;fileBag = $fileBag;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;fileRoot = $folderRoot;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;fileName = $folderName;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;fileid = $fileid;</span><br><span class="line">		Shtml::useFolder ();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*************获取数据*******************/</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadcontent</span> <span class="params">($folder)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ob_start();</span><br><span class="line">		<span class="keyword">require_once</span> <span class="keyword">$this</span>-&gt;url;</span><br><span class="line">		Shtml::writehtml ($folder,ob_get_contents());</span><br><span class="line">		ob_clean();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/********** 指定文件夹*****************/</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">usefolder</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;fileBag==<span class="number">1</span>) &#123;</span><br><span class="line">			$folder=<span class="keyword">$this</span>-&gt;fileName;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;fileBag==<span class="number">2</span>) &#123;</span><br><span class="line">			$folder=date(<span class="string">'Ymd'</span>,time());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">exit</span>(<span class="keyword">$this</span>-&gt;message1);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!is_dir(<span class="keyword">$this</span>-&gt;fileRoot.$folder))&#123;</span><br><span class="line">			mkdir(<span class="keyword">$this</span>-&gt;fileRoot.$folder,<span class="number">0700</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Shtml::loadcontent ($folder);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/********** 生成静态页面*****************/</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writehtml</span> <span class="params">($folder,$cache_value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$file = fopen(<span class="keyword">$this</span>-&gt;fileRoot.$folder.<span class="string">'/'</span>.<span class="keyword">$this</span>-&gt;fileid.<span class="string">'.html'</span>,<span class="string">'w+'</span>);</span><br><span class="line">		fwrite($file,$cache_value);</span><br><span class="line">		fclose($file);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$shtml = <span class="keyword">new</span> Shtml(<span class="string">'http://www.zzlabs.com.cn'</span>,<span class="number">1</span>,<span class="string">''</span>,<span class="string">'cc'</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>类</tag>
        <tag>生成静态</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP会话(Session)使用入门</title>
    <url>/posts/1.html</url>
    <content><![CDATA[<p>对比起 Cookie，Session 是存储在服务器端的会话，相对安全，并且不像 Cookie 那样有存储长度限制，本文简单介绍 Session 的使用。<br>由于 Session 是以文本文件形式存储在服务器端的，所以不怕客户端修改 Session 内容。实际上在服务器端的 Session 文件，PHP 自动修改 Session 文件的权限，只保留了系统读和写权限，而且不能通过 ftp 修改，所以安全得多。<br>对于 Cookie 来说，假设我们要验证用户是否登陆，就必须在 Cookie 中保存用户名和密码（可能是 md5 加密后字符串），并在每次请求页面的时候进行验证。如果用户名和密码存储在数据库，每次都要执行一次数据库查询，给数据库造成多余的负担。因为我们并不能只做一次验证。为什么呢？因为客户端 Cookie 中的信息是有可能被修改的。假如你存储 $admin 变量来表示用户是否登陆，<code>$admin</code> 为 true 的时候表示登陆，为 false 的时候表示未登录，在第一次通过验证后将 <code>$admin</code> 等于 true 存储在 Cookie，下次就不用验证了，这样对么？错了，假如有人伪造一个值为 true 的 <code>$admin</code> 变量那不是就立即取的了管理权限么？非常的不安全。<br>而 Session 就不同了，Session 是存储在服务器端的，远程用户没办法修改 Session 文件的内容，因此我们可以单纯存储一个 <code>$admin</code> 变量来判断是否登陆，首次验证通过后设置 <code>$admin</code> 值为 true，以后判断该值是否为 true，假如不是，转入登陆界面，这样就可以减少很多数据库操作了。而且可以减少每次为了验证 Cookie 而传递密码的不安全性了（Session 验证只需要传递一次，假如你没有使用 SSL 安全协议的话）。即使密码进行了 md5 加密，也是很容易被截获的。<br>当然使用 Session 还有很多优点，比如控制容易，可以按照用户自定义存储等（存储于数据库）。我这里就不多说了。<br>Session 在 php.ini 是否需要设置呢？一般不需要的，因为并不是每个人都有修改 php.ini 的权限，默认 Session 的存放路径是服务器的系统临时文件夹，我们可以自定义存放在自己的文件夹里，这个稍后我会介绍。<br>开始介绍如何创建 Session。非常简单，真的。<br>启动 Session 会话，并创建一个 <code>$admin</code> 变量： </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//启动 Session </span></span><br><span class="line">session_start(); </span><br><span class="line"></span><br><span class="line"><span class="comment">//声明一个名为 admin 的变量，并赋空值。 </span></span><br><span class="line">$_SESSION[<span class="string">"admin"</span>] = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
<p>如果你使用了 Seesion，或者该 PHP 文件要调用 Session 变量，那么就必须在调用 Session 之前启动它，使用 session_start() 函数。其它都不需要你设置了，PHP 自动完成 Session 文件的创建。<br>执行完这个程序后，我们可以到系统临时文件夹找到这个 Session 文件，一般文件名形如：sess_4c83638b3b0dbf65583181c2f89168ec，后面是 32 位编码后的随机字符串。用编辑器打开它，看一下它的内容： <code>admin|N;</code> 一般该内容是这样的结构： <code>变量名|类型:长度:值;</code> 并用分号隔开每个变量。有些是可以省略的，比如长度和类型。<br>我们来看一下验证程序，假设数据库存储的是用户名和 md5 加密后的密码：<br><strong>login.php</strong> </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  表单提交后...</span></span><br><span class="line">$posts = $_POST;</span><br><span class="line"><span class="comment">//  清除一些空白符号</span></span><br><span class="line"><span class="keyword">foreach</span> ($posts <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">	$posts[$key] = trim($value);</span><br><span class="line">&#125;</span><br><span class="line">$password = md5($posts[<span class="string">"password"</span>]);</span><br><span class="line">$username = $posts[<span class="string">"username"</span>];</span><br><span class="line">$query = <span class="string">"SELECT `username` FROM `user` WHERE `password` = '$password' AND `username` = '$username'"</span>;</span><br><span class="line"><span class="comment">// 取得查询结果</span></span><br><span class="line">$userInfo = $DB-&gt;getRow($query);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($userInfo)) &#123;</span><br><span class="line">	<span class="comment">// 当验证通过后，启动 Session</span></span><br><span class="line">	session_start(); <span class="comment">// 注册登陆成功的 admin 变量，并赋值 true</span></span><br><span class="line">	$_SESSION[<span class="string">"admin"</span>] = <span class="keyword">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">"用户名密码错误"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在需要用户验证的页面启动 Session，判断是否登陆： </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  防止全局变量造成安全隐患</span></span><br><span class="line">$admin = <span class="keyword">false</span>;</span><br><span class="line"><span class="comment">//  启动会话，这步必不可少 </span></span><br><span class="line">session_start(); </span><br><span class="line"><span class="comment">//  判断是否登陆 </span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">"admin"</span>]) &amp;&amp; $_SESSION[<span class="string">"admin"</span>] === <span class="keyword">true</span>) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"您已经成功登陆"</span>; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="comment">//  验证失败，将 $_SESSION["admin"] 置为 false</span></span><br><span class="line">	$_SESSION[<span class="string">"admin"</span>] = <span class="keyword">false</span>; </span><br><span class="line">	<span class="keyword">die</span>(<span class="string">"您无权访问"</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是不是很简单呢？将 <code>$_SESSION</code> 看成是存储在服务器端的数组即可，我们注册的每一个变量都是数组的键，跟使用数组没有什么分别。<br>如果要登出系统怎么办？销毁 Session 即可。 </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">session_start(); </span><br><span class="line"><span class="comment">//  这种方法是将原来注册的某个变量销毁</span></span><br><span class="line"><span class="keyword">unset</span>($_SESSION[<span class="string">'admin'</span>]); </span><br><span class="line"><span class="comment">//  这种方法是销毁整个 Session 文件</span></span><br><span class="line">session_destroy();</span><br></pre></td></tr></table></figure>
<p>Session 能否像 Cookie 那样设置生存周期呢？有了 Session 是否就完全抛弃 Cookie 呢？我想说，结合 Cookie 来使用 Session 才是最方便的。<br>Session 是如何来判断客户端用户的呢？它是通过 Session ID 来判断的，什么是 Session ID，就是那个 Session 文件的文件名，Session ID 是随机生成的，因此能保证唯一性和随机性，确保 Session 的安全。一般如果没有设置 Session 的生存周期，则 Session ID 存储在内存中，关闭浏览器后该 ID 自动注销，重新请求该页面后，重新注册一个 Session ID。<br>如果客户端没有禁用 Cookie，则 Cookie 在启动 Session 会话的时候扮演的是存储 Session ID 和 Session 生存期的角色。<br>我们来手动设置 Session 的生存期：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">session_start(); </span><br><span class="line"><span class="comment">//  保存一天 </span></span><br><span class="line">$lifeTime = <span class="number">24</span> * <span class="number">3600</span>; </span><br><span class="line">setcookie(session_name(), session_id(), time() + $lifeTime, <span class="string">"/"</span>);</span><br></pre></td></tr></table></figure>
<p>其实 Session 还提供了一个函数 <code>session_set_cookie_params();</code> 来设置 Session 的生存期的，该函数必须在 <code>session_start()</code> 函数调用之前调用： </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  保存一天 </span></span><br><span class="line">$lifeTime = <span class="number">24</span> * <span class="number">3600</span>; </span><br><span class="line">session_set_cookie_params($lifeTime); </span><br><span class="line">session_start(); </span><br><span class="line">$_SESSION[<span class="string">"admin"</span>] = <span class="keyword">true</span>;</span><br></pre></td></tr></table></figure>
<p>如果客户端使用 IE 6.0 ， <code>session_set_cookie_params();</code> 函数设置 Cookie 会有些问题，所以我们还是手动调用 setcookie 函数来创建 cookie。<br>假设客户端禁用 Cookie 怎么办？没办法，所有生存周期都是浏览器进程了，只要关闭浏览器，再次请求页面又得重新注册 Session。那么怎么传递 Session ID 呢？通过 URL 或者通过隐藏表单来传递，PHP 会自动将 Session ID 发送到 URL 上，URL 形如：<a href="http://www.openphp.cn/index.php?PHPSESSID=bba5b2a240a77e5b44cfa01d49cf9669，其中" target="_blank" rel="noopener">http://www.openphp.cn/index.php?PHPSESSID=bba5b2a240a77e5b44cfa01d49cf9669，其中</a> URL 中的参数 PHPSESSID 就是 Session ID了，我们可以使用 $_GET 来获取该值，从而实现 Session ID 页面间传递。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  保存一天 </span></span><br><span class="line">$lifeTime = <span class="number">24</span> * <span class="number">3600</span>; </span><br><span class="line"><span class="comment">//  取得当前 Session 名，默认为 PHPSESSID </span></span><br><span class="line">$sessionName = session_name(); </span><br><span class="line"><span class="comment">//  取得 Session ID </span></span><br><span class="line">$sessionID = $_GET[$sessionName]; </span><br><span class="line"><span class="comment">//  使用 session_id() 设置获得的 Session ID </span></span><br><span class="line">session_id($sessionID); </span><br><span class="line">session_set_cookie_params($lifeTime); </span><br><span class="line">session_start(); </span><br><span class="line">$_SESSION[<span class="string">'admin'</span>] = <span class="keyword">true</span>;</span><br></pre></td></tr></table></figure>
<p>对于虚拟主机来说，如果所有用户的 Session 都保存在系统临时文件夹里，将给维护造成困难，而且降低了安全性，我们可以手动设置 Session 文件的保存路径，<code>session_save_path()</code> 就提供了这样一个功能。我们可以将 Session 存放目录指向一个不能通过 Web 方式访问的文件夹，当然，该文件夹必须具备可读写属性。 </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  设置一个存放目录 </span></span><br><span class="line">$savePath = <span class="string">'./session_save_dir/'</span>; </span><br><span class="line"><span class="comment">//  保存一天 </span></span><br><span class="line">$lifeTime = <span class="number">24</span> * <span class="number">3600</span>; </span><br><span class="line">session_save_path($savePath); </span><br><span class="line">session_set_cookie_params($lifeTime); </span><br><span class="line">session_start(); </span><br><span class="line">$_SESSION[<span class="string">'admin'</span>] = <span class="keyword">true</span>;</span><br></pre></td></tr></table></figure>
<p>同 <code>session_set_cookie_params();</code> 函数一样，<code>session_save_path()</code> 函数也必须在 <code>session_start()</code> 函数调用之前调用。<br>我们还可以将数组，对象存储在 Session 中。操作数组和操作一般变量没有什么区别，而保存对象的话，PHP 会自动对对象进行序列化（也叫串行化），然后保存于 Session 中。下面例子说明了这一点：<br><strong>person.php</strong> </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> $age; </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;age; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">setAge</span><span class="params">($age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;age = $age; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>setage.php</strong> </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">session_start(); </span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'person.php'</span>; </span><br><span class="line">$person = <span class="keyword">new</span> person(); </span><br><span class="line">$person-&gt;setAge(<span class="number">21</span>); </span><br><span class="line">$_SESSION[<span class="string">'person'</span>] = $person; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;a href='</span>output.php<span class="string">'&gt;check here to output age&lt;/a&gt;'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>output.php</strong> </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置回调函数，确保重新构建对象。 </span></span><br><span class="line">ini_set(<span class="string">'unserialize_callback_func'</span>, <span class="string">'mycallback'</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mycallback</span><span class="params">($classname)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">include_once</span> $classname . <span class="string">'.php'</span>; </span><br><span class="line">	session_start(); </span><br><span class="line">	$person = $_SESSION[<span class="string">'person'</span>]; </span><br><span class="line">	<span class="comment">//  输出 21 </span></span><br><span class="line">	$person-&gt;output(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们执行 setage.php 文件的时候，调用了 setage() 方法，设置了年龄为 21，并将该状态序列化后保存在 Session 中（PHP 将自动完成这一转换），当转到 output.php 后，要输出这个值，就必须反序列化刚才保存的对象，又因为在解序列化的时候需要实例化一个未定义类，所以我们定义了以后回调函数，自动包含 person.php 这个类文件，因此对象被重构，并取得当前 age 的值为 21，然后调用 output() 方法输出该值。<br>另外，我们还可以使用 session_set_save_handler 函数来自定义 Session 的调用方式。</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>php会话</tag>
        <tag>session</tag>
        <tag>使用入门</tag>
      </tags>
  </entry>
  <entry>
    <title>利用 QQWry.Dat 实现 IP 地址高效检索（PHP）</title>
    <url>/posts/10.html</url>
    <content><![CDATA[<p>根据 LumaQQ 开发者文档中的纯真 IP 数据库格式详解，我编写了一个 PHP 的查询 IP 所在地区信息的类。在编写过程中发现纯真 IP 数据库格式详解中关于记录区的描述不是很全面，不过出入也不是很大，所以我没必要再写一份纯真 IP 数据库的格式说明了，大家感兴趣的话，读一读下面的代码应该就能看出来了。代码中加了很详细的注释，应该很容易读懂的。</p>
<p>在创建这个类的一个实例后，实例中就保存了打开的文件指针和一些查询需要的信息，每次查询时不需要重新打开文件，直到页面执行结束后，打开的文件才会自动关闭。这样。在一个页面内进行多次查询时，效率是很高的。并且此类不仅可以直接查询 IP，还可以自动将域名解析为 IP 进行查询。<br>下面是程序代码： </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * IP 地理位置查询类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@copyright</span> 2005 phpkoo.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IpLocation</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * QQWry.Dat文件指针</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> resource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> $fp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第一条IP记录的偏移地址</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> $firstip;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后一条IP记录的偏移地址</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> $lastip;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * IP记录的总条数（不包含版本信息记录）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> $totalip;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回读取的长整型数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@access</span> private</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getlong</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将读取的little-endian编码的4个字节转化为长整型数</span></span><br><span class="line">        $result = unpack(<span class="string">'Vlong'</span>, fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">4</span>));</span><br><span class="line">        <span class="keyword">return</span> $result[<span class="string">'long'</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回读取的3个字节的长整型数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@access</span> private</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getlong3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将读取的little-endian编码的3个字节转化为长整型数</span></span><br><span class="line">        $result = unpack(<span class="string">'Vlong'</span>, fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">3</span>).chr(<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">return</span> $result[<span class="string">'long'</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回压缩后可进行比较的IP地址</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@access</span> private</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $ip</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">packip</span><span class="params">($ip)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 将IP地址转化为长整型数，如果在PHP5中，IP地址错误，则返回False，</span></span><br><span class="line">        <span class="comment">// 这时intval将Flase转化为整数-1，之后压缩成big-endian编码的字符串</span></span><br><span class="line">        <span class="keyword">return</span> pack(<span class="string">'N'</span>, intval(ip2long($ip)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回读取的字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@access</span> private</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getstring</span><span class="params">($data = <span class="string">""</span>)</span> </span>&#123;</span><br><span class="line">        $char = fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span> (ord($char) &gt; <span class="number">0</span>) &#123;        <span class="comment">// 字符串按照C格式保存，以�结束</span></span><br><span class="line">            $data .= $char;             <span class="comment">// 将读取的字符连接到给定字符串之后</span></span><br><span class="line">            $char = fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回地区信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@access</span> private</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getarea</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $byte = fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">1</span>);    <span class="comment">// 标志字节</span></span><br><span class="line">        <span class="keyword">switch</span> (ord($byte)) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:                     <span class="comment">// 没有区域信息</span></span><br><span class="line">                $area = <span class="string">""</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:                     <span class="comment">// 标志字节为1或2，表示区域信息被重定向</span></span><br><span class="line">                fseek(<span class="keyword">$this</span>-&gt;fp, <span class="keyword">$this</span>-&gt;getlong3());</span><br><span class="line">                $area = <span class="keyword">$this</span>-&gt;getstring();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:                    <span class="comment">// 否则，表示区域信息没有被重定向</span></span><br><span class="line">                $area = <span class="keyword">$this</span>-&gt;getstring($byte);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $area;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据所给 IP 地址或域名返回所在地区信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@access</span> public</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $ip</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getlocation</span><span class="params">($ip)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;fp) <span class="keyword">return</span> <span class="keyword">null</span>;            <span class="comment">// 如果数据文件没有被正确打开，则直接返回空</span></span><br><span class="line">        $location[<span class="string">'ip'</span>] = gethostbyname($ip);   <span class="comment">// 将输入的域名转化为IP地址</span></span><br><span class="line">        $ip = <span class="keyword">$this</span>-&gt;packip($location[<span class="string">'ip'</span>]);   <span class="comment">// 将输入的IP地址转化为可比较的IP地址</span></span><br><span class="line">                                                <span class="comment">// 不合法的IP地址会被转化为255.255.255.255</span></span><br><span class="line">        <span class="comment">// 对分搜索</span></span><br><span class="line">        $l = <span class="number">0</span>;                         <span class="comment">// 搜索的下边界</span></span><br><span class="line">        $u = <span class="keyword">$this</span>-&gt;totalip;            <span class="comment">// 搜索的上边界</span></span><br><span class="line">        $findip = <span class="keyword">$this</span>-&gt;lastip;        <span class="comment">// 如果没有找到就返回最后一条IP记录（QQWry.Dat的版本信息）</span></span><br><span class="line">        <span class="keyword">while</span> ($l &lt;= $u) &#123;              <span class="comment">// 当上边界小于下边界时，查找失败</span></span><br><span class="line">            $i = floor(($l + $u) / <span class="number">2</span>);  <span class="comment">// 计算近似中间记录</span></span><br><span class="line">            fseek(<span class="keyword">$this</span>-&gt;fp, <span class="keyword">$this</span>-&gt;firstip + $i * <span class="number">7</span>);</span><br><span class="line">            $beginip = strrev(fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">4</span>));     <span class="comment">// 获取中间记录的开始IP地址</span></span><br><span class="line">            <span class="comment">// strrev函数在这里的作用是将little-endian的压缩IP地址转化为big-endian的格式</span></span><br><span class="line">            <span class="comment">// 以便用于比较，后面相同。</span></span><br><span class="line">            <span class="keyword">if</span> ($ip &lt; $beginip) &#123;       <span class="comment">// 用户的IP小于中间记录的开始IP地址时</span></span><br><span class="line">                $u = $i - <span class="number">1</span>;            <span class="comment">// 将搜索的上边界修改为中间记录减一</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                fseek(<span class="keyword">$this</span>-&gt;fp, <span class="keyword">$this</span>-&gt;getlong3());</span><br><span class="line">                $endip = strrev(fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">4</span>));   <span class="comment">// 获取中间记录的结束IP地址</span></span><br><span class="line">                <span class="keyword">if</span> ($ip &gt; $endip) &#123;     <span class="comment">// 用户的IP大于中间记录的结束IP地址时</span></span><br><span class="line">                    $l = $i + <span class="number">1</span>;        <span class="comment">// 将搜索的下边界修改为中间记录加一</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;                  <span class="comment">// 用户的IP在中间记录的IP范围内时</span></span><br><span class="line">                    $findip = <span class="keyword">$this</span>-&gt;firstip + $i * <span class="number">7</span>;</span><br><span class="line">                    <span class="keyword">break</span>;              <span class="comment">// 则表示找到结果，退出循环</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取查找到的IP地理位置信息</span></span><br><span class="line">        fseek(<span class="keyword">$this</span>-&gt;fp, $findip);</span><br><span class="line">        $location[<span class="string">'beginip'</span>] = long2ip(<span class="keyword">$this</span>-&gt;getlong());   <span class="comment">// 用户IP所在范围的开始地址</span></span><br><span class="line">        $offset = <span class="keyword">$this</span>-&gt;getlong3();</span><br><span class="line">        fseek(<span class="keyword">$this</span>-&gt;fp, $offset);</span><br><span class="line">        $location[<span class="string">'endip'</span>] = long2ip(<span class="keyword">$this</span>-&gt;getlong());     <span class="comment">// 用户IP所在范围的结束地址</span></span><br><span class="line">        $byte = fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">1</span>);    <span class="comment">// 标志字节</span></span><br><span class="line">        <span class="keyword">switch</span> (ord($byte)) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:                     <span class="comment">// 标志字节为1，表示国家和区域信息都被同时重定向</span></span><br><span class="line">                $countryOffset = <span class="keyword">$this</span>-&gt;getlong3();         <span class="comment">// 重定向地址</span></span><br><span class="line">                fseek(<span class="keyword">$this</span>-&gt;fp, $countryOffset);</span><br><span class="line">                $byte = fread(<span class="keyword">$this</span>-&gt;fp, <span class="number">1</span>);    <span class="comment">// 标志字节</span></span><br><span class="line">                <span class="keyword">switch</span> (ord($byte)) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">2</span>:             <span class="comment">// 标志字节为2，表示国家信息又被重定向</span></span><br><span class="line">                        fseek(<span class="keyword">$this</span>-&gt;fp, <span class="keyword">$this</span>-&gt;getlong3());</span><br><span class="line">                        $location[<span class="string">'country'</span>] = <span class="keyword">$this</span>-&gt;getstring();</span><br><span class="line">                        fseek(<span class="keyword">$this</span>-&gt;fp, $countryOffset + <span class="number">4</span>);</span><br><span class="line">                        $location[<span class="string">'area'</span>] = <span class="keyword">$this</span>-&gt;getarea();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:            <span class="comment">// 否则，表示国家信息没有被重定向</span></span><br><span class="line">                        $location[<span class="string">'country'</span>] = <span class="keyword">$this</span>-&gt;getstring($byte);</span><br><span class="line">                        $location[<span class="string">'area'</span>] = <span class="keyword">$this</span>-&gt;getarea();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:                     <span class="comment">// 标志字节为2，表示国家信息被重定向</span></span><br><span class="line">                fseek(<span class="keyword">$this</span>-&gt;fp, <span class="keyword">$this</span>-&gt;getlong3());</span><br><span class="line">                $location[<span class="string">'country'</span>] = <span class="keyword">$this</span>-&gt;getstring();</span><br><span class="line">                fseek(<span class="keyword">$this</span>-&gt;fp, $offset + <span class="number">8</span>);</span><br><span class="line">                $location[<span class="string">'area'</span>] = <span class="keyword">$this</span>-&gt;getarea();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:                    <span class="comment">// 否则，表示国家信息没有被重定向</span></span><br><span class="line">                $location[<span class="string">'country'</span>] = <span class="keyword">$this</span>-&gt;getstring($byte);</span><br><span class="line">                $location[<span class="string">'area'</span>] = <span class="keyword">$this</span>-&gt;getarea();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($location[<span class="string">'country'</span>] == <span class="string">" CZ88.NET"</span>) &#123;  <span class="comment">// CZ88.NET表示没有有效信息</span></span><br><span class="line">            $location[<span class="string">'country'</span>] = <span class="string">"未知"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($location[<span class="string">'area'</span>] == <span class="string">" CZ88.NET"</span>) &#123;</span><br><span class="line">            $location[<span class="string">'area'</span>] = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数，打开 QQWry.Dat 文件并初始化类中的信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $filename</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> IpLocation</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename = <span class="string">"QQWry.Dat"</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;fp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">$this</span>-&gt;fp = @fopen($filename, <span class="string">'rb'</span>)) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;firstip = <span class="keyword">$this</span>-&gt;getlong();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;lastip = <span class="keyword">$this</span>-&gt;getlong();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;totalip = (<span class="keyword">$this</span>-&gt;lastip - <span class="keyword">$this</span>-&gt;firstip) / <span class="number">7</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 析构函数，用于在页面执行结束后自动关闭打开的文件。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;fp) &#123;</span><br><span class="line">            fclose(<span class="keyword">$this</span>-&gt;fp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;fp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>类</tag>
        <tag>class</tag>
        <tag>ip查询</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux 常用命令</title>
    <url>/posts/4.html</url>
    <content><![CDATA[<p>Linux 系统常用命令格式：<br>command [option] [argument1] [argument2] …</p>
<p>其中option以“-”开始，多个option可用一个“-”连起来，如“ls -l -a” 与“ls -la”的效果是一样的。根据命令的不同，参数分为可选</p>
<p>的或必须的；所有的命令从标准输入接受输入，输出结果显示在标准输出，而错误信息则显示在标准错误输出设备。可使用重定向功能对这些设备进行重定向。</p>
<p>命令在正常执行结果后返回一个0值，如果命令出错可未完全完成，则返回一个非零值(在shell中可用变量$?查看)。 在shell script中可用此</p>
<p>返回值作为控制逻辑的一部分。</p>
<p>帮助命令:<br>man 获取相关命令的帮助信息<br>例如：man dir 可以获取关于dir的使用信息。</p>
<p>info 获取相关命令的详细使用方法<br>例如：info info 可以获取如何使用info的详细信息。</p>
<p>文件操作：<br>cat 显示文件内容和合并多个文件<br>clear 清屏<br>chattr 改变文件属性<br>chgrp 改变文件组权<br>chmod 改变文件或目录的权限<br>chown 改变文件的属权<br>comm 比较两个已排过序的文件<br>cp 将文件拷贝至另一文件<br>dd 从指定文件读取数据写到指定文件<br>df 报告磁盘空间使用情况<br>diff 比较两个文本文件，列出行不同之处<br>du 统计目录／文件所占磁盘空间的大小<br>file 辨识文件类型<br>emacs 功能强大的编辑环境<br>find 搜索文件并执行指定操作(find2)<br>grep 按给定模式搜索文件内容<br>head 显示指定文件的前若干行<br>less 按页显示文件<br>ln 创建文件链接<br>locate 查找符合条件的文件<br>more 在终端屏幕按帧显示文本文件<br>mv 文件或目录的移动或更名<br>rm/rmdir 删除文件／目录<br>sed 利用script来处理文本文件<br>sort 对指定文件按行进行排序<br>tail 显示指定文件的最后部分<br>touch 创建文件<br>tr 转换字符<br>vi 全屏编辑器<br>wc 显示指定文件中的行数，词数或字符数<br>which 在环境变量 $PATH 设置的目录里查找符合条件的文件</p>
<p>压缩与备份:<br>bzip2/bunzip2 .bz2文件的压缩/解压缩程序<br>cpio 备份文件<br>dump 备份文件系统<br>gzip/gunzip .gz文件的压缩/解压缩程序<br>gzexe 压缩可执行文件<br>restore 还原由倾倒(Dump)操作所备份下来的文件或整个文件系统(一个分区)<br>tar 将若干文件存档或读取存档文件<br>unarj 解压缩.arj文件<br>zip/unzip 压缩/解压缩 zip文件<br>zipinfo 列出zip压缩文件的详细信息</p>
<p>磁盘操作:<br>cd/pwd 切换目录/显示当前工作目录<br>df 显示磁盘的相关信息<br>du 显示目录或文件的大小<br>e2fsck 检查ext2/ext3文件系统的正确性<br>fdisk 对硬盘进行分区<br>fsck 检查文件系统并尝试修复错误<br>losetup 设置循环设备<br>ls 列出目录内容<br>mkdir 创建目录<br>mformat 对MS-DOS文件系统的磁盘进行格式化<br>mkbootdisk 建立目前系统的启动盘<br>mke2fs 建立ext2文件系统<br>mkisofs 制作iso光盘映像文件<br>mount/umount 加载文件系统/卸载文件系统<br>quota 显示磁盘已使用的空间与限制<br>sync 将内存缓冲区内的数据写入磁盘<br>tree 以树状图列出目录的内容</p>
<p>系统操作:<br>alias 设置指令的别名<br>chkconfig 检查，设置系统的各种服务<br>clock 调整 RTC 时间<br>date 显示或设置系统时间与日期<br>dmesg 显示开机信息<br>eval 重新运算求出参数的内容<br>exit 退出目前的shell<br>export 设置或显示环境变量<br>finger 查找并显示用户信息<br>free 显示内存状态<br>hostid 显示主机标识<br>hostname 显示主机名<br>id 显示用户标识<br>kill 删除执行中的程序或工作<br>last 列出目前与过去登入系统的用户相关信息<br>logout 退出系统<br>lsmod 显示已载入系统的模块<br>modprobe 自动处理可载入模块<br>passwd 设置用户密码<br>ps process status 报告程序状况<br>reboot 重启计算机<br>rhwo 查看系统用户<br>rlogin 远程登入<br>rpm 管理Linux各项套件的程序<br>shutdown 关机<br>su switch user 变更用户身份<br>top 显示，管理执行中的程序<br>uname 显示系统信息<br>useradd/userdel 添加用户 / 删除用户<br>userinfo 图形界面的修改工具<br>usermod 修改用户属性，包括用户的shell类型，用户组等，甚至还能改登录名<br>w 显示目前注册的用户及用户正运行的命令<br>whereis 确定一个命令的二进制执行码，源码及帮助所在的位置<br>who 列出正在使用系统的用户<br>whois 查找并显示用户信息</p>
<p>网络通信:<br>arp 网地址的显示及控制<br>ftp 文件传输<br>lftp 文件传输<br>mail 发送／接收电子邮件<br>mesg 允许或拒绝其他用户向自己所用的终端发送信息<br>mutt E-mail管理程序<br>ncftp 文件传输<br>netstat 显示网络连接、路由表和网络接口信息<br>pine 收发电子邮件，浏览新闻组<br>ping 向网络上的主机发送 icmp echo request 包<br>ssh 安全模式下的远程登录<br>telnet 远程登录<br>talk 与另一用户对话<br>traceroute 显示到达某一主机所经由的路径及所使用的时间<br>wget 从网络上自动下载文件<br>write 向其他用户的终</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>常用命令</tag>
        <tag>管理员命令</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP中判断空变量empty(),is_null(),isset()的区别</title>
    <url>/posts/16.html</url>
    <content><![CDATA[<p><a href="http://www.php.net" target="_blank" rel="noopener" title="php">PHP</a> 中判断变量类型及是否为空主要涉及到的函数有gettype(),isEmpty(),isset(),is_null(),下表详细说</p>
<p><img src="https://upload.phpkoo.com/uploads/2020/01/20200115222148-1024x677.png" alt=""></p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>gettype()</tag>
        <tag>isempty()</tag>
        <tag>isset()</tag>
        <tag>is_null()</tag>
      </tags>
  </entry>
</search>
